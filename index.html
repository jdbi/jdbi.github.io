<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<title>Jdbi 3 Developer Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Jdbi 3 Developer Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction_to_jdbi">1. Introduction to Jdbi</a>
<ul class="sectlevel2">
<li><a href="#_fluent_api">1.1. Fluent API</a></li>
<li><a href="#_declarative_api">1.2. Declarative API</a></li>
</ul>
</li>
<li><a href="#_getting_started">2. Getting Started</a></li>
<li><a href="#_core_api">3. Core API</a>
<ul class="sectlevel2">
<li><a href="#_jdbi">3.1. Jdbi</a></li>
<li><a href="#_handle">3.2. Handle</a></li>
<li><a href="#_arguments">3.3. Arguments</a>
<ul class="sectlevel3">
<li><a href="#_positional_arguments">3.3.1. Positional Arguments</a></li>
<li><a href="#_named_arguments">3.3.2. Named Arguments</a></li>
<li><a href="#_supported_argument_types">3.3.3. Supported Argument Types</a></li>
<li><a href="#_binding_arguments">3.3.4. Binding Arguments</a></li>
<li><a href="#_custom_arguments">3.3.5. Custom Arguments</a></li>
</ul>
</li>
<li><a href="#_queries">3.4. Queries</a></li>
<li><a href="#_mappers">3.5. Mappers</a>
<ul class="sectlevel3">
<li><a href="#_row_mappers">3.5.1. Row Mappers</a></li>
<li><a href="#_column_mappers">3.5.2. Column Mappers</a></li>
<li><a href="#_reflection_mappers">3.5.3. Reflection Mappers</a></li>
</ul>
</li>
<li><a href="#_sql_arrays">3.6. SQL Arrays</a></li>
<li><a href="#_results">3.7. Results</a>
<ul class="sectlevel3">
<li><a href="#_resultbearing">3.7.1. ResultBearing</a></li>
<li><a href="#_resultiterable">3.7.2. ResultIterable</a></li>
<li><a href="#_joins">3.7.3. Joins</a></li>
</ul>
</li>
<li><a href="#_updates">3.8. Updates</a></li>
<li><a href="#_batches">3.9. Batches</a></li>
<li><a href="#_prepared_batches">3.10. Prepared Batches</a>
<ul class="sectlevel3">
<li><a href="#_exception_rewriting">3.10.1. Exception Rewriting</a></li>
</ul>
</li>
<li><a href="#_generated_keys">3.11. Generated Keys</a></li>
<li><a href="#_stored_procedure_calls">3.12. Stored Procedure Calls</a></li>
<li><a href="#_scripts">3.13. Scripts</a></li>
<li><a href="#_transactions">3.14. Transactions</a>
<ul class="sectlevel3">
<li><a href="#_serializable_transactions">3.14.1. Serializable Transactions</a></li>
</ul>
</li>
<li><a href="#_classpathsqllocator">3.15. ClasspathSqlLocator</a></li>
<li><a href="#_statementcontext">3.16. StatementContext</a></li>
</ul>
</li>
<li><a href="#_sql_objects">4. SQL Objects</a>
<ul class="sectlevel2">
<li><a href="#_annotated_methods">4.1. Annotated Methods</a>
<ul class="sectlevel3">
<li><a href="#__sqlupdate">4.1.1. @SqlUpdate</a></li>
<li><a href="#_binding_arguments_2">4.1.2. Binding Arguments</a></li>
<li><a href="#__sqlquery">4.1.3. @SqlQuery</a></li>
<li><a href="#__sqlbatch">4.1.4. @SqlBatch</a></li>
<li><a href="#__sqlcall">4.1.5. @SqlCall</a></li>
<li><a href="#__getgeneratedkeys_3">4.1.6. @GetGeneratedKeys</a></li>
<li><a href="#_sqllocator">4.1.7. SqlLocator</a></li>
<li><a href="#__createsqlobject">4.1.8. @CreateSqlObject</a></li>
</ul>
</li>
<li><a href="#_consumer_methods">4.2. Consumer Methods</a></li>
<li><a href="#_default_methods">4.3. Default Methods</a></li>
<li><a href="#_transaction_management">4.4. Transaction Management</a></li>
<li><a href="#_using_sql_objects">4.5. Using SQL Objects</a>
<ul class="sectlevel3">
<li><a href="#_attached_to_handle">4.5.1. Attached to Handle</a></li>
<li><a href="#_temporary_sql_objects">4.5.2. Temporary SQL Objects</a></li>
<li><a href="#_on_demand">4.5.3. On-Demand</a></li>
</ul>
</li>
<li><a href="#_additional_annotations">4.6. Additional Annotations</a></li>
<li><a href="#_annotations_and_inheritance">4.7. Annotations and Inheritance</a></li>
</ul>
</li>
<li><a href="#_third_party_integration">5. Third-Party Integration</a>
<ul class="sectlevel2">
<li><a href="#_google_guava">5.1. Google Guava</a></li>
<li><a href="#_h2_database">5.2. H2 Database</a></li>
<li><a href="#_jodatime">5.3. JodaTime</a></li>
<li><a href="#_jpa">5.4. JPA</a></li>
<li><a href="#_kotlin">5.5. Kotlin</a>
<ul class="sectlevel3">
<li><a href="#_resultset_mapping">5.5.1. ResultSet mapping</a></li>
<li><a href="#_sqlobject">5.5.2. SqlObject</a></li>
</ul>
</li>
<li><a href="#_oracle_12">5.6. Oracle 12</a></li>
<li><a href="#_postgresql">5.7. PostgreSQL</a>
<ul class="sectlevel3">
<li><a href="#_hstore">5.7.1. hstore</a></li>
<li><a href="#__getgeneratedkeys_4">5.7.2. @GetGeneratedKeys</a></li>
</ul>
</li>
<li><a href="#_spring">5.8. Spring</a>
<ul class="sectlevel3">
<li><a href="#_installing_plugins">5.8.1. Installing plugins</a></li>
<li><a href="#_global_attributes">5.8.2. Global Attributes</a></li>
</ul>
</li>
<li><a href="#_sqlite">5.9. SQLite</a></li>
<li><a href="#_stringtemplate_4">5.10. StringTemplate 4</a></li>
<li><a href="#_vavr">5.11. Vavr</a></li>
</ul>
</li>
<li><a href="#_advanced_topics">6. Advanced Topics</a>
<ul class="sectlevel2">
<li><a href="#_compiling_with_parameter_names">6.1. Compiling with Parameter Names</a>
<ul class="sectlevel3">
<li><a href="#_maven_setup">6.1.1. Maven setup</a></li>
<li><a href="#_intellij_idea_setup">6.1.2. IntelliJ IDEA setup</a></li>
<li><a href="#_eclipse_setup">6.1.3. Eclipse setup</a></li>
</ul>
</li>
<li><a href="#_working_with_generic_types">6.2. Working with Generic Types</a>
<ul class="sectlevel3">
<li><a href="#_generictype">6.2.1. GenericType</a></li>
<li><a href="#_generictypes">6.2.2. GenericTypes</a></li>
</ul>
</li>
<li><a href="#_namedargumentfinder">6.3. NamedArgumentFinder</a></li>
<li><a href="#_jdbiconfig">6.4. JdbiConfig</a>
<ul class="sectlevel3">
<li><a href="#_creating_a_custom_jdbiconfig_type">6.4.1. Creating a custom JdbiConfig type</a></li>
</ul>
</li>
<li><a href="#_jdbiplugin">6.5. JdbiPlugin</a></li>
<li><a href="#_user_defined_annotations">6.6. User-Defined Annotations</a>
<ul class="sectlevel3">
<li><a href="#_statement_customizing_annotations">6.6.1. Statement Customizing Annotations</a></li>
<li><a href="#_configuration_annotations">6.6.2. Configuration Annotations</a></li>
<li><a href="#_method_decorating_annotations">6.6.3. Method Decorating Annotations</a></li>
</ul>
</li>
<li><a href="#_templateengine">6.7. TemplateEngine</a></li>
<li><a href="#_sqlparser">6.8. SqlParser</a></li>
<li><a href="#_timingcollector">6.9. TimingCollector</a></li>
<li><a href="#_resultproducer">6.10. ResultProducer</a></li>
</ul>
</li>
<li><a href="#_appendix">7. Appendix</a>
<ul class="sectlevel2">
<li><a href="#_best_practices">7.1. Best Practices</a></li>
<li><a href="#_api_reference">7.2. API Reference</a></li>
<li><a href="#_related_projects">7.3. Related Projects</a></li>
<li><a href="#_contributing">7.4. Contributing</a></li>
<li><a href="#_upgrading_from_v2_to_v3">7.5. Upgrading from v2 to v3</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/logo.svg" alt="Jdbi logo">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction_to_jdbi"><a class="anchor" href="#_introduction_to_jdbi"></a>1. Introduction to Jdbi</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jdbi provides convenient, idiomatic access to relational data in Java. Jdbi 3
is the third major release which introduces enhanced support for Java 8,
countless refinements to the design and implementation, and enhanced support
for modular plugins.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Not upgrading yet? The <a href="/jdbi2">v2 documentation</a> is still available.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Jdbi is built on top of JDBC. If your database has a JDBC driver, you can use
Jdbi with it.  Jdbi improves JDBC&#8217;s rough interface, providing a more natural
Java database interface that is easy to bind to your domain data types.  Unlike
an ORM, we do not aim to provide a complete object relational mapping framework -
instead of that hidden complexity, we provide building blocks that allow you to
construct the mapping between relations and objects as appropriate for your application.</p>
</div>
<div class="paragraph">
<p>Jdbi&#8217;s API comes in two flavors:</p>
</div>
<div class="sect2">
<h3 id="_fluent_api"><a class="anchor" href="#_fluent_api"></a>1.1. Fluent API</h3>
<div class="paragraph">
<p>The Core API provides a fluent, imperative interface.  Use Builder style objects
to wire up your SQL to rich Java data types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Jdbi jdbi = Jdbi.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:test</span><span class="delimiter">&quot;</span></span>); <span class="comment">// (H2 in-memory database)</span>

<span class="predefined-type">List</span>&lt;User&gt; users = jdbi.withHandle(handle -&gt; {
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE user (id INTEGER PRIMARY KEY, name VARCHAR)</span><span class="delimiter">&quot;</span></span>);

    <span class="comment">// Inline positional parameters</span>
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (?, ?)</span><span class="delimiter">&quot;</span></span>, <span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>);

    <span class="comment">// Positional parameters</span>
    handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (?, ?)</span><span class="delimiter">&quot;</span></span>)
            .bind(<span class="integer">0</span>, <span class="integer">1</span>) <span class="comment">// 0-based parameter indexes</span>
            .bind(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>)
            .execute();

    <span class="comment">// Named parameters</span>
    handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (:id, :name)</span><span class="delimiter">&quot;</span></span>)
            .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
            .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Clarice</span><span class="delimiter">&quot;</span></span>)
            .execute();

    <span class="comment">// Named parameters from bean properties</span>
    handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (:id, :name)</span><span class="delimiter">&quot;</span></span>)
            .bindBean(<span class="keyword">new</span> User(<span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">David</span><span class="delimiter">&quot;</span></span>))
            .execute();

    <span class="comment">// Easy mapping to any type</span>
    <span class="keyword">return</span> handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user ORDER BY name</span><span class="delimiter">&quot;</span></span>)
            .mapToBean(User.class)
            .list();
});

assertThat(users).containsExactly(
        <span class="keyword">new</span> User(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>),
        <span class="keyword">new</span> User(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>),
        <span class="keyword">new</span> User(<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Clarice</span><span class="delimiter">&quot;</span></span>),
        <span class="keyword">new</span> User(<span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">David</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_declarative_api"><a class="anchor" href="#_declarative_api"></a>1.2. Declarative API</h3>
<div class="paragraph">
<p>The SQL Object extension sits atop Core, and provides a declarative interface.
Tell Jdbi what SQL to execute and the shape of the results you like by declaring
an annotated Java <code>interface</code>, and it will provide the implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Define your own declarative interface</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE user (id INTEGER PRIMARY KEY, name VARCHAR)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">void</span> createTable();

    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (?, ?)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">void</span> insertPositional(<span class="type">int</span> id, <span class="predefined-type">String</span> name);

    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (:id, :name)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">void</span> insertNamed(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> id, <span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name);

    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES (:id, :name)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">void</span> insertBean(<span class="annotation">@BindBean</span> User user);

    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user ORDER BY name</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@RegisterBeanMapper</span>(User.class)
    <span class="predefined-type">List</span>&lt;User&gt; listUsers();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Jdbi jdbi = Jdbi.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:test</span><span class="delimiter">&quot;</span></span>);
jdbi.installPlugin(<span class="keyword">new</span> SqlObjectPlugin());

<span class="comment">// Jdbi implements your interface based on annotations</span>
<span class="predefined-type">List</span>&lt;User&gt; userNames = jdbi.withExtension(UserDao.class, dao -&gt; {
    dao.createTable();

    dao.insertPositional(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>);
    dao.insertPositional(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>);
    dao.insertNamed(<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Clarice</span><span class="delimiter">&quot;</span></span>);
    dao.insertBean(<span class="keyword">new</span> User(<span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">David</span><span class="delimiter">&quot;</span></span>));

    <span class="keyword">return</span> dao.listUsers();
});

assertThat(userNames).containsExactly(
        <span class="keyword">new</span> User(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>),
        <span class="keyword">new</span> User(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>),
        <span class="keyword">new</span> User(<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Clarice</span><span class="delimiter">&quot;</span></span>),
        <span class="keyword">new</span> User(<span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">David</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Jdbi has a flexible plugin architecture which makes it easy to fold in support
for your favorite libraries (Guava, JodaTime, Spring, Vavr) or database vendor
(H2, Oracle, Postgres).</p>
</div>
<div class="paragraph">
<p>Jdbi is not an ORM. There is no session cache, change tracking, "open session
in view", or cajoling the library to understand your schema.</p>
</div>
<div class="paragraph">
<p>Instead, Jdbi provides straightforward mapping between SQL and simple tabular
data structures.</p>
</div>
<div class="paragraph">
<p>You bring your own SQL, and Jdbi only runs the commands you tell it to&#8212;&#8203;the way
God intended.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Already using Jdbi v2? See <a href="#_upgrading_from_v2_to_v3">Upgrading from v2 to v3</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>2. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jdbi is easy to include in your Java project - with an
<a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank">Apache 2.0</a> license, few
external dependencies, and JARs distributed through
<a href="http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22org.jdbi%22%20AND%20v%3A%223.1.0%22" target="_blank">Maven Central</a>,
you can just include the relevant artifacts in your POM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencyManagement&gt;</span>
  <span class="tag">&lt;dependencies&gt;</span>
    <span class="tag">&lt;dependency&gt;</span>
      <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
      <span class="tag">&lt;artifactId&gt;</span>jdbi3-bom<span class="tag">&lt;/artifactId&gt;</span>
      <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
      <span class="tag">&lt;version&gt;</span>3.1.0<span class="tag">&lt;/version&gt;</span>
      <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;/dependency&gt;</span>
  <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, in your <code>&lt;dependencies&gt;</code> section, declare a dependency for each Jdbi
module you want to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependencies&gt;</span>
  <span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>jdbi3-core<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;/dependency&gt;</span>
<span class="tag">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Jdbi provides several other modules, which enhance the core API with additional
features.</p>
</div>
<div class="dlist glossary">
<dl>
<dt>jdbi3-sqlobject</dt>
<dd>
<p>The SQL Object extension. Most Jdbi users use this.</p>
</dd>
<dt>jdbi3-guava</dt>
<dd>
<p>Support for Guava&#8217;s collection and Optional types.</p>
</dd>
<dt>jdbi3-jodatime2</dt>
<dd>
<p>Support for JodaTime v2&#8217;s DateTime type.</p>
</dd>
<dt>jdbi3-jpa</dt>
<dd>
<p>Minimal support for JPA annotations.</p>
</dd>
<dt>jdbi3-kotlin</dt>
<dd>
<p>Automatically map kotlin data classes.</p>
</dd>
<dt>jdbi3-kotlin-sqlobject</dt>
<dd>
<p>Enhance the SQL Object extension to support Kotlin default methods and
method default parameters.</p>
</dd>
<dt>jdbi3-oracle12</dt>
<dd>
<p>Support Oracle returning DML statements.</p>
</dd>
<dt>jdbi3-postgres</dt>
<dd>
<p>Support for most data types supported by Postgres driver.</p>
</dd>
<dt>jdbi3-spring4</dt>
<dd>
<p>Provides a factory bean to set up Jdbi singleton.</p>
</dd>
<dt>jdbi3-stringtemplate4</dt>
<dd>
<p>Use the StringTemplate4 template engine, instead of JDBI&#8217;s built in engine.</p>
</dd>
<dt>jdbi3-vavr</dt>
<dd>
<p>Support for Vavr Tuples, Collections and Value arguments</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_core_api"><a class="anchor" href="#_core_api"></a>3. Core API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_jdbi"><a class="anchor" href="#_jdbi"></a>3.1. Jdbi</h3>
<div class="paragraph">
<p>The <a href="./apidocs/org/jdbi/v3/core/Jdbi.html" target="_blank">Jdbi</a> class is the main entry point into
the library.</p>
</div>
<div class="paragraph">
<p>Each <code>Jdbi</code> instance wraps a JDBC
<a href="https://docs.oracle.com/javase/8/docs/api/javax/sql/DataSource.html" target="_blank">DataSource</a>.
It is also a repository of configuration for your database session.</p>
</div>
<div class="paragraph">
<p>There are a few ways to create a <code>Jdbi</code> instance. You can use a JDBC URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// H2 in-memory database</span>
Jdbi jdbi = Jdbi.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:test</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have a <code>DataSource</code> object, you can use that directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">DataSource</span> ds = ...
Jdbi jdbi = Jdbi.create(ds);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Jdbi</code> instances are thread-safe and do not own any database resources.</p>
</div>
<div class="paragraph">
<p>Typically applications create a single, shared <code>Jdbi</code> instance, and set up
any common configuration there.</p>
</div>
<div class="paragraph">
<p>In a more limited scope (such as an HTTP request, or event callback),
you would then request a <code>Handle</code> object from your <code>Jdbi</code> instance.</p>
</div>
</div>
<div class="sect2">
<h3 id="_handle"><a class="anchor" href="#_handle"></a>3.2. Handle</h3>
<div class="paragraph">
<p>Handles represent an active
<a href="https://docs.oracle.com/javase/8/docs/api/java/sql/Connection.html" target="_blank">database connection</a>.</p>
</div>
<div class="paragraph">
<p><a href="./apidocs/org/jdbi/v3/core/Handle.html" target="_blank">Handle</a> is used to prepare and run SQL
statements against the database, and manage database transactions. It provides
access to fluent statement APIs that can bind arguments, execute the statement,
and then map any results into Java objects.</p>
</div>
<div class="paragraph">
<p>A <code>Handle</code> inherits configuration from the <code>Jdbi</code> at the time it is created.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
Because <code>Handle</code> holds an open connection, care must be taken to ensure
that each handle is closed when you are done with it. Failure to close
Handles will eventually overwhelm your database with open connections, or
drain your connection pool.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are a few ways to obtain a <code>Handle</code> instance at runtime.</p>
</div>
<div class="paragraph">
<p>If your operation will return some result, use
<a href="./apidocs/org/jdbi/v3/core/Jdbi.html#withHandle-org.jdbi.v3.core.HandleCallback-" target="_blank">jdbi.withHandle()</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; names = jdbi.withHandle(handle -&gt;
    handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from contacts</span><span class="delimiter">&quot;</span></span>)
          .mapTo(<span class="predefined-type">String</span>.class)
          .list());
assertThat(names).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your operation does not need to return a result,
use <code>Jdbi.useHandle(HandleConsumer)</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.useHandle(handle -&gt; {
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">create table contacts (id int primary key, name varchar(100))</span><span class="delimiter">&quot;</span></span>);
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (?, ?)</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>);
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (?, ?)</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both <code>withHandle</code> and <code>useHandle</code> open a temporary handle, call your callback,
and immediately release the handle when your callback returns.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You may notice the "consumer" vs "callback" naming pattern in a few
places in Jdbi. Callbacks return a value, and are coupled to <code>with-</code> methods.
Consumers do not return a value, and are coupled to <code>use-</code> methods.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, if you want to manage the lifecycle of the handle yourself,
use <code>jdbi.open()</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (Handle handle = jdbi.open()) {
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (?, ?)</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Chuck</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
</div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
When using <code>jdbi.open()</code>, you should always use try-with-resources or a
try-finally block to ensure the database connection is released. Failing to
release the handle will leak connections. We recommend using <code>withHandle</code>
or <code>useHandle</code> over <code>open</code> whenever possible.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_arguments"><a class="anchor" href="#_arguments"></a>3.3. Arguments</h3>
<div class="paragraph">
<p>You have two choices when binding arguments to a SQL statement: positional,
or named.</p>
</div>
<div class="paragraph">
<p>Any statement can use either position or named arguments, but they can never
be mixed in the same SQL statement. In this case, Jdbi can&#8217;t be sure it&#8217;s
binding the right arguments, and will throw an exception.</p>
</div>
<div class="sect3">
<h4 id="_positional_arguments"><a class="anchor" href="#_positional_arguments"></a>3.3.1. Positional Arguments</h4>
<div class="paragraph">
<p>When a SQL statement uses <code>?</code> tokens, Jdbi can bind a values to parameters
at the corresponding index (0-based):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (?, ?)</span><span class="delimiter">&quot;</span></span>)
      .bind(<span class="integer">0</span>, <span class="integer">3</span>)
      .bind(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Chuck</span><span class="delimiter">&quot;</span></span>)
      .execute();

<span class="predefined-type">String</span> name = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from contacts where id = ?</span><span class="delimiter">&quot;</span></span>)
                    .bind(<span class="integer">0</span>, <span class="integer">3</span>)
                    .mapTo(<span class="predefined-type">String</span>.class)
                    .findOnly();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_named_arguments"><a class="anchor" href="#_named_arguments"></a>3.3.2. Named Arguments</h4>
<div class="paragraph">
<p>When a SQL statement uses colon-prefixed tokens like <code>:name</code>, Jdbi can bind
parameters by name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Chuck</span><span class="delimiter">&quot;</span></span>)
      .execute();

<span class="predefined-type">String</span> name = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from contacts where id = :id</span><span class="delimiter">&quot;</span></span>)
                    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
                    .mapTo(<span class="predefined-type">String</span>.class)
                    .findOnly();</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_supported_argument_types"><a class="anchor" href="#_supported_argument_types"></a>3.3.3. Supported Argument Types</h4>
<div class="paragraph">
<p>Out of the box, Jdbi supports the following types as SQL statement arguments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Primitives: <code>boolean</code>, <code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code>, <code>char</code>, <code>float</code>, and
<code>double</code></p>
</li>
<li>
<p>java.lang: <code>Boolean</code>, <code>Byte</code>, <code>Short</code>, <code>Integer</code>, <code>Long</code>, <code>Character</code>,
<code>Float</code>, <code>Double</code>, <code>String</code>, and <code>Enum</code> (stored as the enum value&#8217;s name)</p>
</li>
<li>
<p>java.math: <code>BigDecimal</code></p>
</li>
<li>
<p>java.net: <code>Inet4Address</code>, <code>Inet6Address</code>, <code>URL</code>, and <code>URI</code></p>
</li>
<li>
<p>java.sql: <code>Blob</code>, <code>Clob</code>, <code>Date</code>, <code>Time</code>, and <code>Timestamp</code></p>
</li>
<li>
<p>java.time: <code>Instant</code>, <code>LocalDate</code>, <code>LocalDateTime</code>, <code>LocalTime</code>,
<code>OffsetDateTime</code>, <code>ZonedDateTime</code>, and <code>ZoneId</code></p>
</li>
<li>
<p>java.util: <code>Date</code>, <code>Optional</code> (around any other supported type), and <code>UUID</code></p>
</li>
<li>
<p><code>java.util.Collection</code> and Java arrays (stored as SQL arrays). Some
additional setup may be required depending on the type of array element.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can also configure Jdbi to support additional argument types. More on that
later.</p>
</div>
</div>
<div class="sect3">
<h4 id="_binding_arguments"><a class="anchor" href="#_binding_arguments"></a>3.3.4. Binding Arguments</h4>
<div class="paragraph">
<p>Arguments to SQL statement can be bound in a few different ways.</p>
</div>
<div class="paragraph">
<p>You can bind individual arguments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>)
      .execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can bind multiple arguments at once from the entries of a <code>Map</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>);

handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
      .bindMap(contact)
      .execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can bind multiple values at once, from either a <code>List&lt;T&gt;</code> or a list of arguments. Note that this requires your binding to be written using the <code>&lt;boundValue&gt;</code> form (as opposed to <code>`:boundValue</code> for most of the other bindings.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; keys = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;<span class="predefined-type">String</span>&gt;()
keys.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">user_name</span><span class="delimiter">&quot;</span></span>);
keys.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">street</span><span class="delimiter">&quot;</span></span>);

handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT value FROM items WHERE kind in (&lt;listOfKinds&gt;)
      .bindList(</span><span class="delimiter">&quot;</span></span>listOfKinds<span class="string"><span class="delimiter">&quot;</span><span class="content">, keys)
      .mapTo(String.class)
      .list();

// Or, using the `vararg` definition
handle.createQuery(</span><span class="delimiter">&quot;</span></span>SELECT value FROM items WHERE kind in (&lt;varargListOfKinds&gt;)
      .bindList(<span class="string"><span class="delimiter">&quot;</span><span class="content">varargListOfKinds</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">user_name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">docs</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">street</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">library</span><span class="delimiter">&quot;</span></span>)
      .mapTo(<span class="predefined-type">String</span>.class)
      .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can bind multiple arguments from properties of a Java Bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Contact contact = <span class="keyword">new</span> Contact();
contact.setId(<span class="integer">3</span>);
contact.setName(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cindy</span><span class="delimiter">&quot;</span></span>);

handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
      .bindBean(contact)
      .execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also bind an Object&#8217;s public fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Object</span> contact = <span class="keyword">new</span> <span class="predefined-type">Object</span>() {
    <span class="directive">public</span> <span class="type">int</span> id = <span class="integer">0</span>;
    <span class="directive">public</span> <span class="predefined-type">String</span> name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Cindy</span><span class="delimiter">&quot;</span></span>;
};

handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
      .bindFields(contact)
      .execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can bind public, parameterless methods of an Object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Object</span> contact = <span class="keyword">new</span> <span class="predefined-type">Object</span>() {
    <span class="directive">public</span> <span class="type">int</span> theId() {
        <span class="keyword">return</span> <span class="integer">0</span>;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> theName() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Cindy</span><span class="delimiter">&quot;</span></span>;
    }
};

handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (:theId, :theName)</span><span class="delimiter">&quot;</span></span>)
      .bindMethods(contact)
      .execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optionally, you can qualify each bound bean/object with a prefix. This can help
remove ambiguity in situations where two or more bound beans have similar
property names:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Folder folder = <span class="keyword">new</span> Folder(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Important Documents</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Document</span> document =
    <span class="keyword">new</span> <span class="predefined-type">Document</span>(<span class="integer">100</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">memo.txt</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Business business business. Numbers.</span><span class="delimiter">&quot;</span></span>);

handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into documents (id, folder_id, name, contents) </span><span class="delimiter">&quot;</span></span> +
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">values (:d.id, :f.id, :d.name, :d.contents)</span><span class="delimiter">&quot;</span></span>)
      .bindBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">f</span><span class="delimiter">&quot;</span></span>, folder)
      .bindMethods(<span class="string"><span class="delimiter">&quot;</span><span class="content">f</span><span class="delimiter">&quot;</span></span>, folder)
      .bindFields(<span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span>, document)
      .execute();</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>bindBean()</code>, <code>bindFields()</code>, and <code>bindMethods()</code> may be used to bind nested
properties, e.g. <code>:user.address.street</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>bindMap()</code> does not bind nested properties&#8212;&#8203;map keys are expected to exactly
match the bound parameter name.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_custom_arguments"><a class="anchor" href="#_custom_arguments"></a>3.3.5. Custom Arguments</h4>
<div class="paragraph">
<p>Occasionally your data model will use data types not natively supported by
Jdbi (see <a href="#_supported_argument_types">Supported Argument Types</a>).</p>
</div>
<div class="paragraph">
<p>Fortunately, Jdbi can be configured to bind custom data types as arguments.</p>
</div>
<div class="sect4">
<h5 id="_argument"><a class="anchor" href="#_argument"></a>Argument</h5>
<div class="paragraph">
<p>The <a href="./apidocs/org/jdbi/v3/core/argument/Argument.html" target="_blank">Argument</a> interface wraps a
single value into a binding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> <span class="type">class</span> <span class="class">UUIDArgument</span> <span class="directive">implements</span> Argument {
    <span class="directive">private</span> <span class="predefined-type">UUID</span> uuid;

    <span class="directive">public</span> UUIDArgument(<span class="predefined-type">UUID</span> uuid) {
        <span class="local-variable">this</span>.uuid = uuid;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(<span class="type">int</span> position, <span class="predefined-type">PreparedStatement</span> statement, StatementContext ctx)
    <span class="directive">throws</span> <span class="exception">SQLException</span> {
        statement.setString(position, uuid.toString()); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> uuidArgument() {
    <span class="predefined-type">UUID</span> u = <span class="predefined-type">UUID</span>.randomUUID();
    assertThat(handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT CAST(:uuid AS VARCHAR)</span><span class="delimiter">&quot;</span></span>)
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> UUIDArgument(u))
        .mapTo(<span class="predefined-type">String</span>.class)
        .findOnly()).isEqualTo(u.toString());
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Since Argument usually directly calls into JDBC directly, it is given the
<strong>one-based index</strong> (as expected by JDBC) when it is applied.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here we use an <strong>Argument</strong> to directly bind a UUID. In this particular case,
the most obvious approach is to send the UUID to the database as a String. If
your JDBC driver supports custom types directly or efficient binary transfers,
you can leverage them easily here.</p>
</div>
</div>
<div class="sect4">
<h5 id="_argumentfactory"><a class="anchor" href="#_argumentfactory"></a>ArgumentFactory</h5>
<div class="paragraph">
<p>The <a href="./apidocs/org/jdbi/v3/core/argument/ArgumentFactory.html" target="_blank">ArgumentFactory</a>
interface provides <a href="#_argument">Argument</a> instances for any data type it knows about. By
implementing and registering an argument factory, it is possible to bind
custom data types without having to explicitly wrap them in <code>Argument</code> objects.</p>
</div>
<div class="paragraph">
<p>Jdbi provides an <code>AbstractArgumentFactory</code> class which simplifies implementing
the <code>ArgumentFactory</code> contract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">static</span> <span class="type">class</span> <span class="class">UUIDArgumentFactory</span> <span class="directive">extends</span> AbstractArgumentFactory&lt;<span class="predefined-type">UUID</span>&gt; {
    <span class="directive">public</span> UUIDArgumentFactory() {
        <span class="local-variable">super</span>(<span class="predefined-type">Types</span>.VARCHAR); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> Argument build(<span class="predefined-type">UUID</span> value, ConfigRegistry config) {
        <span class="keyword">return</span> (position, statement, ctx) -&gt; statement.setString(position, value.toString()); <i class="conum" data-value="2"></i><b>(2)</b>
    }
}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> uuidArgumentFactory() {
    <span class="predefined-type">UUID</span> u = <span class="predefined-type">UUID</span>.randomUUID();
    handle.registerArgument(<span class="keyword">new</span> UUIDArgumentFactory());
    assertThat(handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT CAST(:uuid AS VARCHAR)</span><span class="delimiter">&quot;</span></span>)
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>, u)
        .mapTo(<span class="predefined-type">String</span>.class)
        .findOnly()).isEqualTo(u.toString());
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The JDBC <a href="https://docs.oracle.com/javase/8/docs/api/java/sql/Types.html" target="_blank">SQL type constant</a> to use when
binding UUIDs. Jdbi needs this in order to bind UUID values of <code>null</code>. See
<a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html#setNull-int-int-" target="_blank">PreparedStatement.setNull(int,int)</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Since <code>Argument</code> is a functional interface, it can be implemented as a
simple lambda expression.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_arguments_registry"><a class="anchor" href="#_arguments_registry"></a>Arguments Registry</h5>
<div class="paragraph">
<p>When you register an <code>ArgumentFactory</code>, the registration is stored in an
<a href="./apidocs/org/jdbi/v3/core/argument/Arguments.html" target="_blank">Arguments</a> instance held by Jdbi.
<code>Arguments</code> is a configuration class which stores all registered argument
factories (including the factories for built-in arguments).</p>
</div>
<div class="paragraph">
<p>Under the hood, when you bind arguments to a statement, Jdbi consults the
<code>Arguments</code> config object and searches for an <code>ArgumentFactory</code> which knows how
to convert a bound object into an <code>Argument</code>.</p>
</div>
<div class="paragraph">
<p>Later, when the statement is executed, each <code>Argument</code> located during binding
is applied to the JDBC
<a href="https://docs.oracle.com/javase/8/docs/api/java/sql/PreparedStatement.html" target="_blank">PreparedStatement</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Occasionally, two or more argument factories will support arguments of the same
data type. When this happens, the last-registered factory wins. This means that
you can override the way any data type is bound, including the data types
supported out of the box.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_queries"><a class="anchor" href="#_queries"></a>3.4. Queries</h3>
<div class="paragraph">
<p>A <a href="./apidocs/org/jdbi/v3/core/statement/Query.html" target="_blank">Query</a> is a
<a href="./apidocs/org/jdbi/v3/core/result/ResultBearing.html" target="_blank">result-bearing</a> SQL statement
that returns a result set from the database.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;&gt; users =
    handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM user ORDER BY id ASC</span><span class="delimiter">&quot;</span></span>)
        .mapToMap()
        .list();

assertThat(users).containsExactly(
        map(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>),
        map(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>For single rows, you can use <code>findOnly()</code>, which expects exactly one row (or
throws an exception):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> name = handle.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from users where id = ?</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
    .mapTo(<span class="predefined-type">String</span>.class)
    .findOnly();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also use <code>findFirst()</code>, which returns an <code>Optional</code> of the mapped type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Optional&lt;<span class="predefined-type">String</span>&gt; name = handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from users where id = :id</span><span class="delimiter">&quot;</span></span>)
    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
    .mapTo(<span class="predefined-type">String</span>.class)
    .findFirst();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple result rows can be returned in a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; name = handle.createQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">select title from films where genre = :genre order by title</span><span class="delimiter">&quot;</span></span>)
    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">genre</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>)
    .mapTo(<span class="predefined-type">String</span>.class)
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For other collections, use <code>collect()</code> with a
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collector.html" target="_blank">collector</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; name = handle.createQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">select title from films where genre = :genre order by title</span><span class="delimiter">&quot;</span></span>)
    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">genre</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Action</span><span class="delimiter">&quot;</span></span>)
    .mapTo(<span class="predefined-type">String</span>.class)
    .collect(Collectors.toSet());</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also stream results:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.createQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">select title from films where genre = :genre order by title</span><span class="delimiter">&quot;</span></span>)
    .mapTo(<span class="predefined-type">String</span>.class)
    .useStream(stream -&gt; {
      <span class="comment">// do stuff with stream</span>
    });</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus far, all examples have shown a <code>String</code> result type. Of course, you can
map to many other data types:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">LocalDate releaseDate = handle.createQuery(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">select release_date from films where name = :name</span><span class="delimiter">&quot;</span></span>)
    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Star Wars: A New Hope</span><span class="delimiter">&quot;</span></span>)
    .mapTo(LocalDate.class)
    .findOnly();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mappers"><a class="anchor" href="#_mappers"></a>3.5. Mappers</h3>
<div class="paragraph">
<p>Jdbi makes use of mappers to convert result data into Java objects. There are
two types of mappers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_row_mappers">Row Mappers</a>, which map a full row of result set data.</p>
</li>
<li>
<p><a href="#_column_mappers">Column Mappers</a>, which map a single column of a result set row.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_row_mappers"><a class="anchor" href="#_row_mappers"></a>3.5.1. Row Mappers</h4>
<div class="paragraph">
<p><a href="./apidocs/org/jdbi/v3/core/mapper/RowMapper.html" target="_blank">RowMapper</a> is a functional
interface, which maps the current row of a JDBC
<a href="https://docs.oracle.com/javase/8/docs/api/java/sql/ResultSet.html" target="_blank">ResultSet</a> to a mapped type. Row
mappers are invoked once for each row in the result set.</p>
</div>
<div class="paragraph">
<p>Since <code>RowMapper</code> is a functional interface, they can be provided inline to a
query using a lambda expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;User&gt; users = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM user ORDER BY id ASC</span><span class="delimiter">&quot;</span></span>)
        .map((rs, ctx) -&gt; <span class="keyword">new</span> User(rs.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)))
        .list();</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
There are three different types being used in the above example. <code>Query</code>,
returned by <code>Handle.createQuery()</code>, implements the <code>ResultBearing</code> interface.
The <code>ResultBearing.map()</code> method takes a <code>RowMapper&lt;T&gt;</code> and returns a
<code>ResultIterable&lt;T&gt;</code>. Finally, <code>ResultBearing.list()</code> collects each row in the
result set into a <code>List&lt;T&gt;</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Row mappers may be defined as classes, which allows for re-use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">UserMapper</span> <span class="directive">implements</span> <span class="predefined-type">RowMapper</span>&lt;User&gt; {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> User map(<span class="predefined-type">ResultSet</span> rs, StatementContext ctx) <span class="directive">throws</span> <span class="exception">SQLException</span> {
        <span class="keyword">return</span> <span class="keyword">new</span> User(rs.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;User&gt; users = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM user ORDER BY id ASC</span><span class="delimiter">&quot;</span></span>)
    .map(<span class="keyword">new</span> UserMapper())
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>RowMapper</code> is equivalent to the lambda mapper above but more explicit.</p>
</div>
<div class="sect4">
<h5 id="_rowmappers_registry"><a class="anchor" href="#_rowmappers_registry"></a>RowMappers registry</h5>
<div class="paragraph">
<p>Row mappers can be registered for particular types. This simplifies usage,
requiring only that you specify what type you want to map to. Jdbi
automatically looks up the mapper from the registry, and uses it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.registerRowMapper(User.class,
    (rs, ctx) -&gt; <span class="keyword">new</span> User(rs.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));

<span class="keyword">try</span> (Handle handle = jdbi.open()) {
  <span class="predefined-type">List</span>&lt;User&gt; users = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM user ORDER BY id ASC</span><span class="delimiter">&quot;</span></span>)
        .mapTo(User.class)
        .list();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A mapper which implements <code>RowMapper</code> with an explicit mapped type (such as the
<code>UserMapper</code> class in the previous section) may be registered without specifying
the mapped type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(<span class="keyword">new</span> UserMapper());</code></pre>
</div>
</div>
<div class="paragraph">
<p>When this method is used, Jdbi inspects the generic class signature of the
mapper to automatically discover the mapped type.</p>
</div>
<div class="paragraph">
<p>It is possible to register more than one mapper for any given type. When this
happens, the last-registered mapper for a given type takes precedence. This
permits optimizations, like registering a "default" mapper for some type, while
allowing that default mapper to be overridden with a different one when
appropriate.</p>
</div>
</div>
<div class="sect4">
<h5 id="_rowmapperfactory"><a class="anchor" href="#_rowmapperfactory"></a>RowMapperFactory</h5>
<div class="paragraph">
<p>A <a href="./apidocs/org/jdbi/v3/core/mapper/RowMapperFactory.html" target="_blank">RowMapperFactory</a> can
produce row mappers for arbitrary types.</p>
</div>
<div class="paragraph">
<p>Implementing a factory might be preferable to a regular row mapper if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The mapper implementation is generic, and could apply to multiple mapped
types. For example, Jdbi provides a generalized <a href="#_beanmapper">BeanMapper</a>, which maps
columns to bean properties for any bean class.</p>
</li>
<li>
<p>The mapped type has a generic signature, and/or the mapper could be composed
from other registered mappers. For example, Jdbi provides a
<a href="#_map_entry_mapping">Map.Entry&lt;K,V&gt; mapper</a>, provided a mapper is registered
for types <code>K</code> and <code>V</code>.</p>
</li>
<li>
<p>You want to bundle multiple mappers into a single class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s take an example <code>Pair&lt;L, R&gt;</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">Pair</span>&lt;L, R&gt; {
  <span class="directive">public</span> <span class="directive">final</span> L left;
  <span class="directive">public</span> <span class="directive">final</span> R right;

  <span class="directive">public</span> Pair(L left, R right) {
    <span class="local-variable">this</span>.left = left;
    <span class="local-variable">this</span>.right = right;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s implement a row mapper factory. The factory should produce a
<code>RowMapper&lt;Pair&lt;L, R&gt;&gt;</code> for any <code>Pair&lt;L, R&gt;</code> type, where the <code>L</code> type is mapped
from the first column, and <code>R</code> from the second&#8212;&#8203;assuming there are column
mappers registered for both <code>L</code> and <code>R</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take this one step at a time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PairMapperFactory</span> <span class="directive">implements</span> RowMapperFactory {
  <span class="directive">public</span> Optional&lt;<span class="predefined-type">RowMapper</span>&lt;?&gt;&gt; build(<span class="predefined-type">Type</span> type, ConfigRegistry config) {
    ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>build</code> method accepts a mapped type, and a config registry. It may return
<code>Optional.of(someMapper)</code> if it knows how to map that type, or
<code>Optional.empty()</code> otherwise.</p>
</div>
<div class="paragraph">
<p>First we check whether the mapped type is a <code>Pair</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (!Pair.class.equals(GenericTypes.getErasedType(type))) {
  <span class="keyword">return</span> Optional.empty();
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>GenericTypes</code> utility class is discussed in <a href="#_working_with_generic_types">Working with Generic Types</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, we extract the <code>L</code> and <code>R</code> generic parameters from the mapped type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Type</span> leftType = GenericTypes.resolveType(Pair.class.getTypeParameters()[<span class="integer">0</span>], type);
<span class="predefined-type">Type</span> rightType = GenericTypes.resolveType(Pair.class.getTypeParameters()[<span class="integer">1</span>], type);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the first line, <code>Pair.class.getTypeParameters()[0]</code> gives the type variable
<code>L</code>. Likewise in the second line, <code>Pair.class.getTypeParameters()[1]</code> gives the type
variable <code>R</code>.</p>
</div>
<div class="paragraph">
<p>We use <code>resolveType()</code> to resolve the types for the <code>L</code> and <code>R</code> type variables
in the context of the mapped type.</p>
</div>
<div class="paragraph">
<p>Now that we have the types for <code>L</code> and <code>R</code>, we can look up the column mappers
for those types from the <code>ColumnMappers</code> config class, through the config
registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ColumnMappers columnMappers = config.get(ColumnMappers.class);

ColumnMapper&lt;?&gt; leftMapper = columnMappers.findFor(leftType)
   .orElseThrow(() -&gt; <span class="keyword">new</span> NoSuchMapperException(
       <span class="string"><span class="delimiter">&quot;</span><span class="content">No column mapper registered for Pair left parameter </span><span class="delimiter">&quot;</span></span> + leftType));
ColumnMapper&lt;?&gt; rightMapper = columnMappers.findFor(rightType)
   .orElseThrow(() -&gt; <span class="keyword">new</span> NoSuchMapperException(
       <span class="string"><span class="delimiter">&quot;</span><span class="content">No column mapper registered for Pair right parameter </span><span class="delimiter">&quot;</span></span> + rightType));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The config registry is a locator for config classes. So when we call
<code>config.get(ColumnMappers.class)</code>, we get back a <code>ColumnMappers</code> instance with
the current column mapper configuration.</p>
</div>
<div class="paragraph">
<p>Next we call <code>ColumnMappers.findFor()</code> to get the column mappers for the left
and right types.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You may have noticed that although this method can return <code>Optional</code>, we&#8217;re
throwing an exception if we can&#8217;t find the left- or right-hand mappers. We&#8217;ve
found this to be a best practice: return <code>Optional.empty()</code> if the factory
knows nothing about the mapped type (<code>Pair</code>, in this case). If it knows the
mapped type but is missing some configuration to make it work (e.g. mappers not
registered for <code>L</code> or <code>R</code> parameter) it is more helpful to throw an exception
with an informative message, so users can diagnose <em>why</em> the mapper isn&#8217;t
working as expected.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, we construct a pair mapper, and return it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">RowMapper</span>&lt;?&gt; pairMapper = (rs, ctx) -&gt;
    <span class="keyword">new</span> Pair(leftMapper.map(rs, <span class="integer">1</span>, ctx), <span class="comment">// In JDBC, column numbers start at 1</span>
             rightMapper.map(rs, <span class="integer">2</span>, ctx)); <span class="comment">// ..for MOTHERF***ING REASONS</span>

<span class="keyword">return</span> Optional.of(pairMapper);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the factory class all together:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PairMapperFactory</span> <span class="directive">implements</span> RowMapperFactory {
  <span class="directive">public</span> Optional&lt;<span class="predefined-type">RowMapper</span>&lt;?&gt;&gt; build(<span class="predefined-type">Type</span> type, ConfigRegistry config) {
    <span class="keyword">if</span> (!Pair.class.equals(GenericTypes.getErasedType(type))) {
      <span class="keyword">return</span> Optional.empty();
    }

    <span class="predefined-type">Type</span> leftType = GenericTypes.resolveType(Pair.class.getTypeParameters()[<span class="integer">0</span>], type);
    <span class="predefined-type">Type</span> rightType = GenericTypes.resolveType(Pair.class.getTypeParameters()[<span class="integer">1</span>], type);

    ColumnMappers columnMappers = config.get(ColumnMappers.class);

    ColumnMapper&lt;?&gt; leftMapper = columnMappers.findFor(leftType)
       .orElseThrow(() -&gt; <span class="keyword">new</span> NoSuchMapperException(
           <span class="string"><span class="delimiter">&quot;</span><span class="content">No column mapper registered for Pair left parameter </span><span class="delimiter">&quot;</span></span> + leftType));
    ColumnMapper&lt;?&gt; rightMapper = columnMappers.findFor(rightType)
       .orElseThrow(() -&gt; <span class="keyword">new</span> NoSuchMapperException(
           <span class="string"><span class="delimiter">&quot;</span><span class="content">No column mapper registered for Pair right parameter </span><span class="delimiter">&quot;</span></span> + rightType));

    <span class="predefined-type">RowMapper</span>&lt;?&gt; pairMapper = (rs, ctx) -&gt;
        <span class="keyword">new</span> Pair(leftMapper.map(rs, <span class="integer">1</span>, ctx),
                 rightMapper.map(rs, <span class="integer">2</span>, ctx));

    <span class="keyword">return</span> Optional.of(pairMapper);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Row mapper factories may be registered similar to regular row mappers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.registerRowMapper(<span class="keyword">new</span> PairMapperFactory());

<span class="keyword">try</span> (Handle handle = jdbi.open()) {
  <span class="predefined-type">List</span>&lt;Pair&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;&gt; configPairs = handle
          .createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT key, value FROM config</span><span class="delimiter">&quot;</span></span>)
          .mapTo(<span class="keyword">new</span> GenericType&lt;Pair&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;&gt;() {})
          .list();
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>GenericType</code> utility class is discussed in <a href="#_working_with_generic_types">Working with Generic Types</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_column_mappers"><a class="anchor" href="#_column_mappers"></a>3.5.2. Column Mappers</h4>
<div class="paragraph">
<p><a href="./apidocs/org/jdbi/v3/core/mapper/ColumnMapper.html" target="_blank">ColumnMapper</a> is a functional
interface, which maps a column from the current row of a JDBC
<a href="https://docs.oracle.com/javase/8/docs/api/java/sql/ResultSet.html" target="_blank">ResultSet</a> to a mapped type.</p>
</div>
<div class="paragraph">
<p>Since <code>ColumnMapper</code> is a functional interface, they can be provided inline to a
query using a lambda expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Money&gt; amounts = handle
    .select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select amount from transactions where account_id = ?</span><span class="delimiter">&quot;</span></span>, accountId)
    .map((rs, col, ctx) -&gt; Money.parse(rs.getString(col))) <i class="conum" data-value="1"></i><b>(1)</b>
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Whenever a column mapper is used to map rows, only the first column of each row
is mapped.</p>
</div>
<div class="paragraph">
<p>Column mappers may be defined as classes, which allows for re-use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MoneyMapper</span> <span class="directive">implements</span> ColumnMapper&lt;Money&gt; {
  <span class="directive">public</span> T map(<span class="predefined-type">ResultSet</span> r, <span class="type">int</span> columnNumber, StatementContext ctx) <span class="directive">throws</span> <span class="exception">SQLException</span> {
    <span class="keyword">return</span> Money.parse(r.getString(columnNumber));
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Money&gt; amounts = handle
    .select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select amount from transactions where account_id = ?</span><span class="delimiter">&quot;</span></span>, accountId)
    .map(<span class="keyword">new</span> MoneyMapper())
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>This <code>ColumnMapper</code> is equivalent to the lambda mapper above, but more explicit.</p>
</div>
<div class="sect4">
<h5 id="_columnmappers_registry"><a class="anchor" href="#_columnmappers_registry"></a>ColumnMappers registry</h5>
<div class="paragraph">
<p>Column mappers may be registered for specific types. This simplifies usage,
requiring only that you specify what type you want to map to. Jdbi automatically
looks up the mapper from the registry, and uses it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.registerColumnMapper(Money.class,
    (rs, col, ctx) -&gt; Money.parse(rs.getString(col)));

<span class="predefined-type">List</span>&lt;Money&gt; amounts = jdbi.withHandle(handle -&gt;
    handle.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select amount from transactions where account_id = ?</span><span class="delimiter">&quot;</span></span>, accountId)
          .mapTo(Money.class)
          .list());</code></pre>
</div>
</div>
<div class="paragraph">
<p>A mapper which implements <code>ColumnMapper</code> with an explicit mapped type (such as
the <code>MoneyMapper</code> class in the previous section) may be registered without
specifying the mapped type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerColumnMapper(<span class="keyword">new</span> MoneyMapper());</code></pre>
</div>
</div>
<div class="paragraph">
<p>When this method is used, Jdbi inspects the generic class signature of the
mapper to automatically discover the mapped type.</p>
</div>
<div class="paragraph">
<p>It is possible to register more than one mapper for any given type. When this
happens, the last-registered mapper for a given type takes precedence. This
permits optimizations, like registering a "default" mapper for some type, while
allowing that default mapper to be overridden with a different one when
appropriate.</p>
</div>
<div class="paragraph">
<p>Out of the box, column mappers are registered for the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Primitives: <code>boolean</code>, <code>byte</code>, <code>short</code>, <code>int</code>, <code>long</code>, <code>char</code>, <code>float</code>, and
<code>double</code></p>
</li>
<li>
<p>java.lang: <code>Boolean</code>, <code>Byte</code>, <code>Short</code>, <code>Integer</code>, <code>Long</code>, <code>Character</code>,
<code>Float</code>, <code>Double</code>, <code>String</code>, and <code>Enum</code> (stored as the enum value&#8217;s name)</p>
</li>
<li>
<p>java.math: <code>BigDecimal</code></p>
</li>
<li>
<p><code>byte[]</code> arrays (e.g. for BLOB or VARBINARY columns)</p>
</li>
<li>
<p>java.net: <code>InetAddress</code>, <code>URL</code>, and <code>URI</code></p>
</li>
<li>
<p>java.sql: <code>Timestamp</code></p>
</li>
<li>
<p>java.time: <code>Instant</code>, <code>LocalDate</code>, <code>LocalDateTime</code>, <code>LocalTime</code>,
<code>OffsetDateTime</code>, <code>ZonedDateTime</code>, and <code>ZoneId</code></p>
</li>
<li>
<p>java.util: <code>UUID</code></p>
</li>
<li>
<p><code>java.util.Collection</code> and Java arrays (for array columns). Some
additional setup may be required depending on the type of array element&#8212;&#8203;see
<a href="#_sql_arrays">SQL Arrays</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_columnmapperfactory"><a class="anchor" href="#_columnmapperfactory"></a>ColumnMapperFactory</h5>
<div class="paragraph">
<p>A <a href="./apidocs/org/jdbi/v3/core/mapper/ColumnMapperFactory.html" target="_blank">ColumnMapperFactory</a> can
produce column mappers for arbitrary types.</p>
</div>
<div class="paragraph">
<p>Implementing a factory might be preferable to a regular column mapper if:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The mapper class is generic, and could apply to multiple mapped types.</p>
</li>
<li>
<p>The type being mapped is generic, and/or the mapper could be composed
from other registered mappers.</p>
</li>
<li>
<p>You want to bundle multiple mappers into a single class.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s create a mapper factory for <code>Optional&lt;T&gt;</code> as an example. The factory
should produce a <code>ColumnMapper&lt;Optional&lt;T&gt;&gt;</code> for any <code>T</code>, provided a column
mapper is registered for <code>T</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s take this one step at a time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">OptionalColumnMapperFactory</span> <span class="directive">implements</span> ColumnMapperFactory {
  <span class="directive">public</span> Optional&lt;ColumnMapper&lt;?&gt;&gt; build(<span class="predefined-type">Type</span> type, ConfigRegistry config) {
    ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>build</code> method accepts a mapped type, and a config registry. It may return
<code>Optional.of(someMapper)</code> if it knows how to map that type, or
<code>Optional.empty()</code> otherwise.</p>
</div>
<div class="paragraph">
<p>First, we check whether the mapped type is an <code>Optional</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">if</span> (!Optional.class.equals(GenericTypes.getErasedType(type))) {
  <span class="keyword">return</span> Optional.empty();
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>GenericTypes</code> utility class is discussed in <a href="#_working_with_generic_types">Working with Generic Types</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, extract the <code>T</code> generic parameter from the mapped type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Type</span> t = GenericTypes.resolveType(Optional.class.getTypeParameters()[<span class="integer">0</span>], type);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression <code>Optional.class.getTypeParameters()[0]</code> gives the type variable
<code>T</code>.</p>
</div>
<div class="paragraph">
<p>We use <code>resolveType()</code> to resolve the type of <code>T</code> in the context of the mapped
type.</p>
</div>
<div class="paragraph">
<p>Now that we have the type of <code>T</code>, we can look up a column mapper for that type
from the <code>ColumnMappers</code> config class, through the config registry:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ColumnMapper&lt;?&gt; tMapper = config.get(ColumnMappers.class)
    .findFor(embeddedType)
    .orElseThrow(() -&gt; <span class="keyword">new</span> NoSuchMapperException(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">No column mapper registered for parameter </span><span class="delimiter">&quot;</span></span> + embeddedType + <span class="string"><span class="delimiter">&quot;</span><span class="content"> of type </span><span class="delimiter">&quot;</span></span> + type));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The config registry is a locator for config classes. So when we call
<code>config.get(ColumnMappers.class)</code>, we get back a <code>ColumnMappers</code> instance with
the current column mapper configuration.</p>
</div>
<div class="paragraph">
<p>Next we call <code>ColumnMappers.findFor()</code> to get the column mapper for the embedded
type.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You may have noticed that although this method can return <code>Optional</code>, we&#8217;re
throwing an exception if we can&#8217;t find a mapper for the embedded type. We&#8217;ve
found this to be a best practice: return <code>Optional.empty()</code> if the factory knows
nothing about the mapped type (<code>Optional</code>, in this case). If it knows the mapped
type but is missing some configuration to make it work (e.g. no mapper
registered for tye <code>T</code> parameter) it is more helpful to throw an exception with
an informative message, so users can diagnose <em>why</em> the mapper isn&#8217;t working as
expected.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, we construct the column mapper for optionals, and return it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ColumnMapper&lt;?&gt; optionalMapper = (rs, col, ctx) -&gt;
    Optional.ofNullable(tMapper.map(rs, col, ctx));

<span class="keyword">return</span> Optional.of(optionalMapper);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the factory class all together:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">OptionalColumnMapperFactory</span> <span class="directive">implements</span> ColumnMapperFactory {
  <span class="directive">public</span> Optional&lt;ColumnMapper&lt;?&gt;&gt; build(<span class="predefined-type">Type</span> type, ConfigRegistry config) {
    <span class="keyword">if</span> (!Optional.class.equals(GenericTypes.getErasedType(type))) {
      <span class="keyword">return</span> Optional.empty();
    }

    <span class="predefined-type">Type</span> t = GenericTypes.resolveType(Optional.class.getTypeParameters()[<span class="integer">0</span>], type);

    ColumnMapper&lt;?&gt; tMapper = config.get(ColumnMappers.class)
        .findFor(t)
        .orElseThrow(() -&gt; <span class="keyword">new</span> NoSuchMapperException(
            <span class="string"><span class="delimiter">&quot;</span><span class="content">No column mapper registered for parameter </span><span class="delimiter">&quot;</span></span> + t + <span class="string"><span class="delimiter">&quot;</span><span class="content"> of type </span><span class="delimiter">&quot;</span></span> + type));

    ColumnMapper&lt;?&gt; optionalMapper = (rs, col, ctx) -&gt;
        Optional.ofNullable(tMapper.map(rs, col, ctx));

    <span class="keyword">return</span> Optional.of(optionalMapper);
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Column mapper factories may be registered similar to regular column mappers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.registerColumnMapper(<span class="keyword">new</span> OptionalColumnMapperFactory());

<span class="keyword">try</span> (Handle handle = jdbi.open()) {
  <span class="predefined-type">List</span>&lt;Optional&lt;<span class="predefined-type">String</span>&gt;&gt; middleNames = handle
          .createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select middle_name from contacts</span><span class="delimiter">&quot;</span></span>)
          .mapTo(<span class="keyword">new</span> GenericType&lt;Optional&lt;<span class="predefined-type">String</span>&gt;&gt;() {})
          .list();
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>GenericType</code> utility class is discussed in <a href="#_working_with_generic_types">Working with Generic Types</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reflection_mappers"><a class="anchor" href="#_reflection_mappers"></a>3.5.3. Reflection Mappers</h4>
<div class="paragraph">
<p>Jdbi provides a few reflection-based mappers out of the box.</p>
</div>
<div class="paragraph">
<p>Reflective mappers treat column names as bean property names (BeanMapper),
constructor parameter names (ConstructorMapper), or field names (FieldMapper).</p>
</div>
<div class="paragraph">
<p>Reflective mappers are snake_case aware and will automatically match up these
columns to camelCase field/argument/property names.</p>
</div>
<div class="sect4">
<h5 id="_constructormapper"><a class="anchor" href="#_constructormapper"></a>ConstructorMapper</h5>
<div class="paragraph">
<p><strong>Jdbi</strong> provides a simple constructor mapper which uses reflection to assign
columns to constructor parameters by name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ConstructorProperties</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>})
<span class="directive">public</span> User(<span class="type">int</span> id, <span class="predefined-type">String</span> name) {
  <span class="local-variable">this</span>.id = id;
  <span class="local-variable">this</span>.name = name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@ConstructorProperties</code> annotations tells Jdbi the property name of each
constructor parameter, so it can figure out which column corresponds to each
constructor parameter.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Lombok&#8217;s <code>@AllArgsConstructor</code> annotation generates the
<code>@ConstructorProperties</code> annotation for you.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Enabling the <code>-parameters</code> Java compiler flag removes the need for the
<code>@ConstructorProperties</code> annotation&#8212;&#8203;see <a href="#_compiling_with_parameter_names">Compiling with Parameter Names</a>.
Thus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> User(<span class="type">int</span> id, <span class="predefined-type">String</span> name) {
    <span class="local-variable">this</span>.id = id;
    <span class="local-variable">this</span>.name = name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Register a constructor mapper for your mapped class using the <code>factory()</code>
method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(ConstructorMapper.factory(User.class));
<span class="predefined-type">Set</span>&lt;User&gt; userSet = handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user ORDER BY id ASC</span><span class="delimiter">&quot;</span></span>)
    .mapTo(User.class)
    .collect(Collectors.toSet());

assertThat(userSet).hasSize(<span class="integer">4</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor parameter names "id", "name" match the database column names
and as such no custom mapper code is required at all.</p>
</div>
<div class="paragraph">
<p>Constructor mappers can be configured with a column name prefix for each mapped
constructor parameter. This can help to disambiguate mapping joins, e.g. when
two mapped classes have identical property names (like <code>id</code> or <code>name</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(ConstructorMapper.factory(Contact.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span>));
handle.registerRowMapper(ConstructorMapper.factory(Phone.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>));
handle.registerRowMapper(JoinRowMapper.forTypes(Contact.class, Phone.class);
<span class="predefined-type">List</span>&lt;JoinRow&gt; contactPhones = handle.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">c.id cid, c.name cname, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">p.id pid, p.name pname, p.number pnumber </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">from contacts c left join phones p on c.id = p.contact_id</span><span class="delimiter">&quot;</span></span>)
    .mapTo(JoinRow.class)
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Typically, the mapped class will have a single constructor. If it has multiple
constructors, Jdbi will pick one based on these rules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>First, use the constructor annotated with <code>@JdbiConstructor</code>, if any.</p>
</li>
<li>
<p>Next, use the constructor annotated with <code>@ConstructorProperties</code>, if any.</p>
</li>
<li>
<p>Otherwise, throw an exception that Jdbi doesn&#8217;t know which constructor to
use.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For legacy column names that don&#8217;t match up to property names, use the
<code>@ColumnName</code> annotation to provide an exact column name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> User(<span class="annotation">@ColumnName</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">user_id</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> id, <span class="predefined-type">String</span> name) {
  <span class="local-variable">this</span>.id = id;
  <span class="local-variable">this</span>.name = name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nested constructor-injected types can be mapped using the <code>@Nested</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
  <span class="directive">public</span> User(<span class="type">int</span> id,
              <span class="predefined-type">String</span> name,
              <span class="annotation">@Nested</span> Address address) {
    ...
  }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {
  <span class="directive">public</span> Address(<span class="predefined-type">String</span> street,
                 <span class="predefined-type">String</span> city,
                 <span class="predefined-type">String</span> state,
                 <span class="predefined-type">String</span> zip) {
    ...
  }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(ConstructorMapper.factory(User.class));

<span class="predefined-type">List</span>&lt;User&gt; users = handle
    .select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name, street, city, state, zip from users</span><span class="delimiter">&quot;</span></span>)
    .mapTo(User.class)
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Nested</code> annotation has an optional <code>value()</code> attribute, which can be used
to apply a column name prefix to each nested constructor parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> User(<span class="type">int</span> id,
            <span class="predefined-type">String</span> name,
            <span class="annotation">@Nested</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">addr</span><span class="delimiter">&quot;</span></span>) Address address) {
  ...
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(ConstructorMapper.factory(User.class));

<span class="predefined-type">List</span>&lt;User&gt; users = handle
    .select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name, addr_street, addr_city, addr_state, addr_zip from users</span><span class="delimiter">&quot;</span></span>)
    .mapTo(User.class)
    .list();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_beanmapper"><a class="anchor" href="#_beanmapper"></a>BeanMapper</h5>
<div class="paragraph">
<p>We also provide basic support for mapping beans:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserBean</span> {
    <span class="directive">private</span> <span class="type">int</span> id;
    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> <span class="type">int</span> getId() {
        <span class="keyword">return</span> id;
    }
    <span class="directive">public</span> <span class="type">void</span> setId(<span class="type">int</span> id) {
        <span class="local-variable">this</span>.id = id;
    }
    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }
    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Register a bean mapper for your mapped class, using the <code>factory()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(BeanMapper.factory(UserBean.class));

<span class="predefined-type">List</span>&lt;UserBean&gt; users = handle
        .createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name from user</span><span class="delimiter">&quot;</span></span>)
        .mapTo(UserBean.class)
        .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, call <code>mapToBean()</code> instead of registering a bean mapper:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;UserBean&gt; users = handle
        .createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name from user</span><span class="delimiter">&quot;</span></span>)
        .mapToBean(UserBean.class)
        .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bean mappers can be configured with a column name prefix for each mapped
property. This can help to disambiguate mapping joins, e.g. when two mapped
classes have identical property names (like <code>id</code> or <code>name</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(BeanMapper.factory(ContactBean.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span>));
handle.registerRowMapper(BeanMapper.factory(PhoneBean.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>));
handle.registerRowMapper(JoinRowMapper.forTypes(ContactBean.class, PhoneBean.class));
<span class="predefined-type">List</span>&lt;JoinRow&gt; contactPhones = handle.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">c.id cid, c.name cname, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">p.id pid, p.name pname, p.number pnumber </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">from contacts c left join phones p on c.id = p.contact_id</span><span class="delimiter">&quot;</span></span>)
        .mapTo(JoinRow.class)
        .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For legacy column names that don&#8217;t match up to property names, use the
<code>@ColumnName</code> annotation to provide an exact column name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
  <span class="directive">private</span> <span class="type">int</span> id;

  <span class="annotation">@ColumnName</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">user_id</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="type">int</span> getId() { <span class="keyword">return</span> id; }

  <span class="directive">public</span> <span class="type">void</span> setId(<span class="type">int</span> id) { <span class="local-variable">this</span>.id = id; }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@ColumnName</code> annotation can be placed on either the getter or setter
method.</p>
</div>
<div class="paragraph">
<p>Nested Java Bean types can be mapped using the <code>@Nested</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
  <span class="directive">private</span> <span class="type">int</span> id;
  <span class="directive">private</span> <span class="predefined-type">String</span> name;
  <span class="directive">private</span> Address address;

  ... (getters and setters)

  <span class="annotation">@Nested</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="directive">public</span> Address getAddress() { ... }

  <span class="directive">public</span> <span class="type">void</span> setAddress(Address address) { ... }
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {
  <span class="directive">private</span> <span class="predefined-type">String</span> street;
  <span class="directive">private</span> <span class="predefined-type">String</span> city;
  <span class="directive">private</span> <span class="predefined-type">String</span> state;
  <span class="directive">private</span> <span class="predefined-type">String</span> zip;

  ... (getters and setters)
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>@Nested</code> annotation can be placed on either the getter or setter
method.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(BeanMapper.factory(User.class));

<span class="predefined-type">List</span>&lt;User&gt; users = handle
    .select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name, street, city, state, zip from users</span><span class="delimiter">&quot;</span></span>)
    .mapTo(User.class)
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Nested</code> annotation has an optional <code>value()</code> attribute, which can be used
to apply a column name prefix to each nested bean property:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Nested</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">addr</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Address getAddress() { ... }</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(BeanMapper.factory(User.class));

<span class="predefined-type">List</span>&lt;User&gt; users = handle
    .select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name, addr_street, addr_city, addr_state, addr_zip from users</span><span class="delimiter">&quot;</span></span>)
    .mapTo(User.class)
    .list();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_fieldmapper"><a class="anchor" href="#_fieldmapper"></a>FieldMapper</h5>
<div class="paragraph">
<p><a href="./apidocs/org/jdbi/v3/mapper/reflect/FieldMapper.html" target="_blank">FieldMapper</a> uses reflection
to map database columns directly to object fields (including private fields).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
  <span class="directive">public</span> <span class="type">int</span> id;

  <span class="directive">public</span> <span class="predefined-type">String</span> name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Register a field mapper for your mapped class, using the <code>factory()</code> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(FieldMapper.factory(User.class));

<span class="predefined-type">List</span>&lt;UserBean&gt; users = handle
        .createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name from user</span><span class="delimiter">&quot;</span></span>)
        .mapTo(User.class)
        .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Field mappers can be configured with a column name prefix for each mapped
field. This can help to disambiguate mapping joins, e.g. when two mapped
classes have identical property names (like <code>id</code> or <code>name</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(FieldMapper.factory(Contact.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span>));
handle.registerRowMapper(FieldMapper.factory(Phone.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>));
handle.registerRowMapper(JoinRowMapper.forTypes(Contact.class, Phone.class);
<span class="predefined-type">List</span>&lt;JoinRow&gt; contactPhones = handle.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">c.id cid, c.name cname, </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">p.id pid, p.name pname, p.number pnumber </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">from contacts c left join phones p on c.id = p.contact_id</span><span class="delimiter">&quot;</span></span>)
    .mapTo(JoinRow.class)
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For legacy column names that don&#8217;t match up to field names, use the
<code>@ColumnName</code> annotation to provide an exact column name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
  <span class="annotation">@ColumnName</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">user_id</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> <span class="type">int</span> id;

  <span class="directive">public</span> <span class="predefined-type">String</span> name;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nested field-mapped types can be mapped using the <code>@Nested</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
  <span class="directive">public</span> <span class="type">int</span> id;
  <span class="directive">public</span> <span class="predefined-type">String</span> name;

  <span class="annotation">@Nested</span>
  <span class="directive">public</span> Address address;
}

<span class="directive">public</span> <span class="type">class</span> <span class="class">Address</span> {
  <span class="directive">public</span> <span class="predefined-type">String</span> street;
  <span class="directive">public</span> <span class="predefined-type">String</span> city;
  <span class="directive">public</span> <span class="predefined-type">String</span> state;
  <span class="directive">public</span> <span class="predefined-type">String</span> zip;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(FieldMapper.factory(User.class));

<span class="predefined-type">List</span>&lt;User&gt; users = handle
    .select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name, street, city, state, zip from users</span><span class="delimiter">&quot;</span></span>)
    .mapTo(User.class)
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>@Nested</code> annotation has an optional <code>value()</code> attribute, which can be used
to apply a column name prefix to each nested field:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">User</span> {
  <span class="directive">public</span> <span class="type">int</span> id;
  <span class="directive">public</span> <span class="predefined-type">String</span> name;

  <span class="annotation">@Nested</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">addr</span><span class="delimiter">&quot;</span></span>)
  <span class="directive">public</span> Address address;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.registerRowMapper(FieldMapper.factory(User.class));

<span class="predefined-type">List</span>&lt;User&gt; users = handle
    .select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name, addr_street, addr_city, addr_state, addr_zip from users</span><span class="delimiter">&quot;</span></span>)
    .mapTo(User.class)
    .list();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_map_entry_mapping"><a class="anchor" href="#_map_entry_mapping"></a>Map.Entry mapping</h5>
<div class="paragraph">
<p>Out of the box, Jdbi registers a <code>RowMapper&lt;Map.Entry&lt;K,V&gt;&gt;</code>. Since each row in
the result set is a <code>Map.Entry&lt;K,V&gt;</code>, the entire result set can be easily
collected into a <code>Map&lt;K,V&gt;</code> (or Guava&#8217;s <code>Multimap&lt;K,V&gt;</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A mapper must be registered for both the key and value type.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Join rows can be gathered into a map result by specifying the generic map
signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">select u.id u_id, u.name u_name, p.id p_id, p.phone p_phone </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">from user u left join phone p on u.id = p.user_id</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Map</span>&lt;User, Phone&gt; map = h.createQuery(sql)
        .registerRowMapper(ConstructorMapper.factory(User.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span>))
        .registerRowMapper(ConstructorMapper.factory(Phone.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>))
        .collectInto(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">Map</span>&lt;User, Phone&gt;&gt;() {});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the <code>User</code> mapper uses a "u" column name prefix, and
the <code>Phone</code> mapper uses "p". Since each mapper only reads columns with the
expected prefix, the respective <code>id</code> columns are unambiguous.</p>
</div>
<div class="paragraph">
<p>A unique index (e.g. by ID column) can be obtained by setting the key column
name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">Integer</span>, User&gt; map = h.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from user</span><span class="delimiter">&quot;</span></span>)
        .setMapKeyColumn(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
        .registerRowMapper(ConstructorMapper.factory(User.class))
        .collectInto(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">Integer</span>, User&gt;&gt;() {});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set both the key and value column names to gather a two-column query into a map
result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; map = h.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select key, value from config</span><span class="delimiter">&quot;</span></span>)
        .setMapKeyColumn(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>)
        .setMapValueColumn(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>)
        .collectInto(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;&gt;() {});</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the above examples assume a one-to-one key/value relationship. What if
there is a one-to-many relationship?</p>
</div>
<div class="paragraph">
<p>Google Guava provides a <code>Multimap</code> type, which supports mapping multiple
values per key.</p>
</div>
<div class="paragraph">
<p>First, follow the instructions in the <a href="#_google_guava">Google Guava</a> section to install
<code>GuavaPlugin</code> into Jdbi.</p>
</div>
<div class="paragraph">
<p>Then, simply ask for a <code>Multimap</code> instead of a <code>Map</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">select u.id u_id, u.name u_name, p.id p_id, p.phone p_phone </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">from user u left join phone p on u.id = p.user_id</span><span class="delimiter">&quot;</span></span>;
Multimap&lt;User, Phone&gt; map = h.createQuery(sql)
        .registerRowMapper(ConstructorMapper.factory(User.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span>))
        .registerRowMapper(ConstructorMapper.factory(Phone.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>))
        .collectInto(<span class="keyword">new</span> GenericType&lt;Multimap&lt;User, Phone&gt;&gt;() {});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>collectInto()</code> method is worth explaining. When you call it, several things
happen behind the scenes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Consult the <code>JdbiCollectors</code> registry to obtain a
<a href="./apidocs/org/jdbi/v3/core/collector/CollectorFactory.html" target="_blank">CollectorFactory</a> which
supports the given container type.</p>
</li>
<li>
<p>Next, ask that <code>CollectorFactory</code> to extract the element type from the
container type signature. In the above example, the element type of
<code>Multimap&lt;User,Phone&gt;</code> is <code>Map.Entry&lt;User,Phone&gt;</code>.</p>
</li>
<li>
<p>Obtain a mapper for that element type from the mapping registry.</p>
</li>
<li>
<p>Obtain a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collector.html" target="_blank">Collector</a> for the
container type from the <code>CollectorFactory</code>.</p>
</li>
<li>
<p>Finally, return <code>map(elementMapper).collect(collector)</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the lookup for the collector factory, element type, or element mapper
fails, an exception is thrown.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Jdbi can be enhanced to support arbitrary container types. See
<a href="#JdbiCollectors">[JdbiCollectors]</a> for more information.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sql_arrays"><a class="anchor" href="#_sql_arrays"></a>3.6. SQL Arrays</h3>
<div class="paragraph">
<p>TODO:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The SqlArrayTypes registry</p>
</li>
<li>
<p>Register an array type for a Java element type supported directly by the JDBC
driver</p>
</li>
<li>
<p>Register an array type for a custom Java element type, converting into a
value supported by the JDBC driver</p>
</li>
<li>
<p>Last registered SQL array type for a given type wins</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_results"><a class="anchor" href="#_results"></a>3.7. Results</h3>
<div class="paragraph">
<p>After executing a database query, you need to interpret the results. JDBC
provides the <strong>ResultSet</strong> class which can do simple mapping to Java primitives
and built in classes, but the API is often cumbersome to use. <strong>Jdbi</strong> provides
configurable mapping, including the ability to register custom mappers for rows
and columns.</p>
</div>
<div class="paragraph">
<p>A <strong>RowMapper</strong> converts a row of a <strong>ResultSet</strong> into a result object.</p>
</div>
<div class="paragraph">
<p>A <strong>ColumnMapper</strong> converts a single column&#8217;s value into a Java object. It can be
used as a <strong>RowMapper</strong> if there is only one column present, or it can be used to
build more complex <strong>RowMapper</strong> types.</p>
</div>
<div class="paragraph">
<p>The mapper is selected based on the declared result type of your query.</p>
</div>
<div class="paragraph">
<p><strong>jdbi</strong> iterates over the rows in the ResultSet and presents the mapped results
to you in a container such as a <strong>List</strong>, <strong>Stream</strong>, <strong>Optional</strong>, or <strong>Iterator</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">User</span> {
    <span class="directive">final</span> <span class="type">int</span> id;
    <span class="directive">final</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> User(<span class="type">int</span> id, <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.id = id;
        <span class="local-variable">this</span>.name = name;
    }
}

<span class="annotation">@Before</span>
<span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
    handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE user (id INTEGER PRIMARY KEY AUTO_INCREMENT, name VARCHAR)</span><span class="delimiter">&quot;</span></span>);
    <span class="keyword">for</span> (<span class="predefined-type">String</span> name : <span class="predefined-type">Arrays</span>.asList(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Data</span><span class="delimiter">&quot;</span></span>)) {
        handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(name) VALUES (?)</span><span class="delimiter">&quot;</span></span>, name);
    }
}

<span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> findBob() {
    User u = findUserById(<span class="integer">2</span>).orElseThrow(() -&gt; <span class="keyword">new</span> <span class="exception">AssertionError</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">No user found</span><span class="delimiter">&quot;</span></span>));
    assertThat(u.id).isEqualTo(<span class="integer">2</span>);
    assertThat(u.name).isEqualTo(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>);
}

<span class="directive">public</span> Optional&lt;User&gt; findUserById(<span class="type">long</span> id) {
    <span class="predefined-type">RowMapper</span>&lt;User&gt; userMapper =
            (rs, ctx) -&gt; <span class="keyword">new</span> User(rs.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>), rs.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>));
    <span class="keyword">return</span> handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user WHERE id=:id</span><span class="delimiter">&quot;</span></span>)
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, id)
        .map(userMapper)
        .findFirst();
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_resultbearing"><a class="anchor" href="#_resultbearing"></a>3.7.1. ResultBearing</h4>
<div class="paragraph">
<p>The <a href="./apidocs/org/jdbi/v3/core/result/ResultBearing.html">ResultBearing</a> interface
represents a result set of a database operation, which has not been mapped to
any particular result type.</p>
</div>
<div class="paragraph">
<p>TODO:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Query implements ResultBearing</p>
</li>
<li>
<p>Update.executeAndReturnGeneratedKeys() returns ResultBearing</p>
</li>
<li>
<p>PreparedBatch.executeAndReturnGeneratedKeys() returns ResultBearing</p>
</li>
<li>
<p>A ResultBearing object can be mapped, which returns a ResultIterable of the
mapped type.</p>
<div class="ulist">
<ul>
<li>
<p>mapTo(Type | Class | GenericType) if a mapper is registered for type</p>
</li>
<li>
<p>map(RowMapper | ColumnMapper)</p>
</li>
<li>
<p>mapToBean() for bean types</p>
</li>
<li>
<p>mapToMap() which returns Map&lt;String,Object&gt; mapping lower-cased column names
to values</p>
</li>
</ul>
</div>
</li>
<li>
<p>reduceRows</p>
<div class="ulist">
<ul>
<li>
<p>RowView</p>
</li>
</ul>
</div>
</li>
<li>
<p>reduceResultSet</p>
</li>
<li>
<p>collectInto e.g. with a GenericType token. Implies a mapTo() and a collect()
in one operation. e.g. collectInto(new GenericType&lt;List&lt;User&gt;&gt;(){}) is the
same as mapTo(User.class).collect(toList())</p>
</li>
<li>
<p>Provide list of container types supported out of the box</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_resultiterable"><a class="anchor" href="#_resultiterable"></a>3.7.2. ResultIterable</h4>
<div class="paragraph">
<p><a href="./apidocs/org/jdbi/v3/core/result/ResultIterable.html">ResultIterable</a> represents a
result set which has been mapped to a specific type, e.g.
<code>ResultIterable&lt;User&gt;</code>.</p>
</div>
<div class="paragraph">
<p>TODO:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ResultIterable.forEach</p>
</li>
<li>
<p>ResultIterable.iterator()</p>
<div class="ulist">
<ul>
<li>
<p>Must be explicitly closed, to release database resources.</p>
</li>
<li>
<p>Use try-with-resources to ensure database resources get cleaned up.
*</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_find_a_single_result"><a class="anchor" href="#_find_a_single_result"></a>Find a Single Result</h5>
<div class="paragraph">
<p><strong>ResultIterable#findOnly</strong> returns the only row in the result set. If zero or
multiple rows are encountered, it will throw <strong>IllegalStateException</strong>.</p>
</div>
<div class="paragraph">
<p><strong>#findFirst</strong> returns an <strong>Optional&lt;T&gt;</strong> with the first row, if any.</p>
</div>
</div>
<div class="sect4">
<h5 id="_stream"><a class="anchor" href="#_stream"></a>Stream</h5>
<div class="paragraph">
<p><strong>Stream</strong> integration allows you to use a RowMapper to adapt a ResultSet into
the new Java 8 Streams framework. As long as your database supports streaming
results (for example, PostgreSQL will do it as long as you are in a transaction
and set a fetch size), the stream will lazily fetch rows from the database as
necessary.</p>
</div>
<div class="paragraph">
<p><strong>#stream</strong> returns a <strong>Stream&lt;T&gt;</strong>. You should then process the stream and produce
a result. This stream must be closed to release any database resources held, so
we recommend <strong>useStream</strong>, <strong>withStream</strong> or alternately a <strong>try-with-resources</strong> block
to ensure that no resources are leaked.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM user ORDER BY id ASC</span><span class="delimiter">&quot;</span></span>)
      .map(<span class="keyword">new</span> UserMapper())
      .useStream(stream -&gt; {
          Optional&lt;<span class="predefined-type">String</span>&gt; first = stream
              .filter(u -&gt; u.id &gt; <span class="integer">2</span>)
              .map(u -&gt; u.name)
              .findFirst();
          assertThat(first).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>);
      });</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>#withStream</strong> and <strong>#useStream</strong> handle closing the stream for you. You provide a
<strong>StreamCallback</strong> that produces a result or a <strong>StreamConsumer</strong> that produces no
result, respectively.</p>
</div>
</div>
<div class="sect4">
<h5 id="_list"><a class="anchor" href="#_list"></a>List</h5>
<div class="paragraph">
<p><strong>#list</strong> emits a <strong>List&lt;T&gt;</strong>. This necessarily buffers all results in memory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;User&gt; users =
    handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT id, name FROM user</span><span class="delimiter">&quot;</span></span>)
        .map(<span class="keyword">new</span> UserMapper())
        .list();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_collectors"><a class="anchor" href="#_collectors"></a>Collectors</h5>
<div class="paragraph">
<p><strong>#collect</strong> takes a <strong>Collector&lt;T, ? , R&gt;</strong> that builds a resulting collection
<strong>R&lt;T&gt;</strong>. The <strong>java.util.stream.Collectors</strong> class has a number of interesting
*Collector*s to start with.</p>
</div>
<div class="paragraph">
<p>You can also write your own custom collectors.  For example, to accumulate
found rows into a <strong>Map</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">h.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into something (id, name) values (1, 'Alice'), (2, 'Bob'), (3, 'Chuckles')</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">Integer</span>, Something&gt; users = h.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name from something</span><span class="delimiter">&quot;</span></span>)
    .mapTo(Something.class)
    .collect(Collector.of(<span class="predefined-type">HashMap</span>::<span class="keyword">new</span>, (accum, item) -&gt; {
        accum.put(item.getId(), item);   <span class="comment">// Each entry is added into an accumulator map</span>
    }, (l, r) -&gt; {
        l.putAll(r);                     <span class="comment">// While jdbi does not process rows in parallel,</span>
        <span class="keyword">return</span> l;                        <span class="comment">// the Collector contract encourages writing combiners.</span>
    }, Characteristics.IDENTITY_FINISH));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_reduction"><a class="anchor" href="#_reduction"></a>Reduction</h5>
<div class="paragraph">
<p><strong>#reduce</strong> provides a simplified <strong>Stream#reduce</strong>. Given an identity starting
value and a <strong>BiFunction&lt;U, T, U&gt;</strong> it will repeatedly combine *U*s until only a
single remains, and then return that.</p>
</div>
</div>
<div class="sect4">
<h5 id="_resultsetscanner"><a class="anchor" href="#_resultsetscanner"></a>ResultSetScanner</h5>
<div class="paragraph">
<p>The <strong>ResultSetScanner</strong> interface accepts a lazily-provided <strong>ResultSet</strong>
and produces the result Jdbi returns from statement execution.</p>
</div>
<div class="paragraph">
<p>Most of the above operations are implemented in terms of <strong>ResultSetScanner</strong>.
The Scanner has ownership of the ResultSet and may advance or seek it.</p>
</div>
<div class="paragraph">
<p>The return value ends up being the final result of statement execution.</p>
</div>
<div class="paragraph">
<p>Most users should prefer using the higher level result collectors described above,
but someone&#8217;s gotta do the dirty work.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_joins"><a class="anchor" href="#_joins"></a>3.7.3. Joins</h4>
<div class="paragraph">
<p>Joining multiple tables together is a very common database task. It is also
where the mismatch between the relational model and Java&#8217;s object model starts
to rear its ugly head.</p>
</div>
<div class="paragraph">
<p>Here we present a couple of strategies for retrieving results from more
complicated rows.</p>
</div>
<div class="paragraph">
<p>Consider a contact list app as an example. The contact list contains any
number of contacts. Contacts have a name, and any number of phone numbers.
Phone numbers have a type (e.g. home, work) and a phone number:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">Contact</span> {
  <span class="predefined-type">Long</span> id;
  <span class="predefined-type">String</span> name;
  <span class="predefined-type">List</span>&lt;Phone&gt; phones = <span class="keyword">new</span> <span class="predefined-type">ArrayList</span>&lt;&gt;();

  <span class="type">void</span> addPhone(Phone phone) {
    phones.add(phone);
  }
}

<span class="type">class</span> <span class="class">Phone</span> {
  <span class="predefined-type">Long</span> id;
  <span class="predefined-type">String</span> type;
  <span class="predefined-type">String</span> phone;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ve left out getters, setters, and access modifiers for brevity.</p>
</div>
<div class="paragraph">
<p>Since we&#8217;ll be reusing the same queries, we&#8217;ll define them as constants now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>static final String SELECT_ALL = "select contacts.id c_id, name c_name, "
    + "phones.id p_id, type p_type, phones.phone p_phone "
    + "from contacts left join phones on contacts.id = phones.contact_id "
    + "order by c_name, p_type ";

static final String SELECT_ONE = SELECT_ALL + "where phones.id = :id";</pre>
</div>
</div>
<div class="paragraph">
<p>Note that we&#8217;ve given aliases (e.g. <code>c_id</code>, <code>p_id</code>) to distinguish columns of
the same name (<code>id</code>) from different tables.</p>
</div>
<div class="paragraph">
<p>Jdbi provides a few different APIs for dealing with joined data.</p>
</div>
<div class="sect4">
<h5 id="_resultbearing_reducerows"><a class="anchor" href="#_resultbearing_reducerows"></a>ResultBearing.reduceRows()</h5>
<div class="paragraph">
<p>The
<a href="./apidocs/org/jdbi/v3/core/result/ResultBearing.html#reduceRows-U-java.util.function.BiFunction-">ResultBearing.reduceRows(U, BiFunction)</a>
method accepts an accumulator seed value and a lambda function. For each row in
the result set, Jdbi calls the lambda with the current accumulator value and a
<a href="./apidocs/org/jdbi/v3/core/result/RowView.html" target="_blank">RowView</a> over the current row of the
result set. The value returned for each row becomes the input accumulator
passed in for the next row. After the last row has been processed,
<code>reducedRows()</code> returns the last value returned from the lambda.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Contact&gt; contacts = handle.createQuery(SELECT_ALL)
    .registerRowMapper(BeanMapper.factory(Contact.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span>))
    .registerRowMapper(BeanMapper.factory(Phone.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="1"></i><b>(1)</b>
    .reduceRows(<span class="keyword">new</span> <span class="predefined-type">LinkedHashMap</span>&lt;<span class="predefined-type">Long</span>, Contact&gt;(), <i class="conum" data-value="2"></i><b>(2)</b>
                (map, rowView) -&gt; {
      Contact contact = map.computeIfAbsent( <i class="conum" data-value="3"></i><b>(3)</b>
          rowView.getColumn(<span class="string"><span class="delimiter">&quot;</span><span class="content">c_id</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Long</span>.class),
          id -&gt; rowView.getRow(Contact.class));

      <span class="keyword">if</span> (rowView.getColumn(<span class="string"><span class="delimiter">&quot;</span><span class="content">p_id</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Long</span>.class) != <span class="predefined-constant">null</span>) { <i class="conum" data-value="4"></i><b>(4)</b>
        contact.addPhone(rowView.getRow(Phone.class));
      }

      <span class="keyword">return</span> map; <i class="conum" data-value="5"></i><b>(5)</b>
    })
    .values() <i class="conum" data-value="6"></i><b>(6)</b>
    .stream()
    .collect(toList()); <i class="conum" data-value="7"></i><b>(7)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Register row mappers for <code>Contact</code> and <code>Phone</code>. Note the <code>"c"</code> and <code>"p"</code>
arguments used&#8212;&#8203;these are column name prefixes. By registering mappers with
prefixes, the <code>Contact</code> mapper will only map the <code>c_id</code> and <code>c_name</code>
columns, whereas the <code>Phone</code> mapper will only map <code>p_id</code>, <code>p_type</code>, and
<code>p_phone</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use an empty <a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html" target="_blank">LinkedHashMap</a>
as the accumulator seed, mapped by contact ID. <code>LinkedHashMap</code> is a good
accumulator when selecting multiple master records, since it has fast
storage and lookup while preserving insertion order (which helps honor
<code>ORDER BY</code> clauses). If ordering is unimportant, a <code>HashMap</code> would also
suffice.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Load the <code>Contact</code> from the accumulator if we already have it; otherwise,
initialize it through the <code>RowView</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>If <code>p_id</code> column is not null, load the phone number from the current row
and add it to the current contact.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Return the input map (now sporting an additional contact and/or phone) as
the accumulator for the next row.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>At this point, all rows have been read into memory, and we don&#8217;t need the
contact ID keys. So we call <code>Map.values()</code> to get a <code>Collection&lt;Contact&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Collect the contacts into a <code>List&lt;Contact&gt;</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, the
<a href="./apidocs/org/jdbi/v3/core/result/ResultBearing.html#reduceRows-org.jdbi.v3.core.result.RowReducer-" target="_blank">ResultBearing.reduceRows(RowReducer)</a>
variant accepts a <a href="./apidocs/org/jdbi/v3/core/result/RowReducer.html" target="_blank">RowReducer</a> and
returns a stream of reduced elements.</p>
</div>
<div class="paragraph">
<p>For simple master-detail joins, the abstract
<a href="./apidocs/org/jdbi/v3/core/result/LinkedHashMapRowReducer.html" target="_blank">LinkedHashMapRowReducer</a>
class makes it easy to reduce these joins into a stream of master elements.
Adapting the example above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Contact&gt; contacts = handle.createQuery(SELECT_ALL)
    .registerRowMapper(BeanMapper.factory(Contact.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span>))
    .registerRowMapper(BeanMapper.factory(Phone.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>))
    .reduceRows(LinkedHashMapRowReducer.&lt;<span class="predefined-type">Long</span>, Contact&gt; of((map, rowView) -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
      Contact contact = map.computeIfAbsent(
          rowView.getColumn(<span class="string"><span class="delimiter">&quot;</span><span class="content">c_id</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Long</span>.class),
          id -&gt; rowView.getRow(Contact.class));

      <span class="keyword">if</span> (rowView.getColumn(<span class="string"><span class="delimiter">&quot;</span><span class="content">p_id</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Long</span>.class) != <span class="predefined-constant">null</span>) {
        contact.addPhone(rowView.getRow(Phone.class));
      }
      <i class="conum" data-value="2"></i><b>(2)</b>
    })
    .collect(toList()); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The factory method
<a href="./apidocs/org/jdbi/v3/core/result/LinkedHashMapRowReducer.html#of-java.util.function.BiConsumer-" target="_blank">LinkedHashMapRowReducer.of(BiConsumer)</a>
needs only a <code>BiConsumer(Map&lt;K,V&gt;, RowView)</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>No <code>return</code> statement needed. The same <code>map</code> is reused on every row.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This reduction produces a <code>Stream&lt;Contact&gt;</code>, and we can use any stream method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You may be wondering about the <code>getRow()</code> and <code>getColumn()</code> calls to <code>rowView</code>.
When you call <code>rowView.getRow(SomeType.class)</code>, <code>RowView</code> looks up the
registered row mapper for <code>SomeType</code>, and uses it to map the current row to a
<code>SomeType</code> object.</p>
</div>
<div class="paragraph">
<p>Likewise, when you call <code>rowView.getColumn("my_value", MyValueType.class)</code>,
<code>RowView</code> looks up the registered column mapper for <code>MyValueType</code>, and uses it
to map the <code>my_value</code> column of the current row to a <code>MyValueType</code> object.</p>
</div>
<div class="paragraph">
<p>Now let&#8217;s do the same thing, but for a single contact:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Optional&lt;Contact&gt; contact = handle.createQuery(SELECT_ONE)
    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, contactId)
    .registerRowMapper(BeanMapper.factory(Contact.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">c</span><span class="delimiter">&quot;</span></span>))
    .registerRowMapper(BeanMapper.factory(Phone.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>))
    .reduceRows(LinkedHashMapRowReducer.&lt;<span class="predefined-type">Long</span>, Contact&gt; of((map, rowView) -&gt; {
      Contact contact = map.orElseGet(() -&gt; rowView.getRow(Contact.class));

      <span class="keyword">if</span> (rowView.getColumn(<span class="string"><span class="delimiter">&quot;</span><span class="content">p_id</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Long</span>.class) != <span class="predefined-constant">null</span>) {
        contact.addPhone(rowView.getRow(Phone.class));
      }
    })
    .findFirst();</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_resultbearing_reduceresultset"><a class="anchor" href="#_resultbearing_reduceresultset"></a>ResultBearing.reduceResultSet()</h5>
<div class="paragraph">
<p><a href="./apidocs/org/jdbi/v3/core/result/ResultBearing.html#reduceResultSet-U-org.jdbi.v3.core.result.ResultSetAccumulator-" target="_blank">ResultBearing.reduceResultSet()</a>
is a low-level API similar to <code>reduceRows()</code>, except it provides direct access
to the JDBC <code>ResultSet</code> instead of a <code>RowView</code> for each row.</p>
</div>
<div class="paragraph">
<p>This method can provide superior performance compared to <code>reduceRows()</code>, at the
expense of verbosity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Contact&gt; contacts = handle.createQuery(SELECT_ALL)
    .reduceResultSet(<span class="keyword">new</span> <span class="predefined-type">LinkedHashMap</span>&lt;<span class="predefined-type">Long</span>, Contact&gt;(),
                     (acc, resultSet, ctx) -&gt; {
      <span class="type">long</span> contactId = resultSet.getLong(<span class="string"><span class="delimiter">&quot;</span><span class="content">c_id</span><span class="delimiter">&quot;</span></span>);
      Contact contact;
      <span class="keyword">if</span> (acc.containsKey(contactId)) {
        contact = acc.get(contactId);
      } <span class="keyword">else</span> {
        contact = <span class="keyword">new</span> Contact();
        contact.setId(contactId);
        contact.setName(resultSet.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">c_name</span><span class="delimiter">&quot;</span></span>);
      }

      <span class="type">long</span> phoneId = resultSet.getLong(<span class="string"><span class="delimiter">&quot;</span><span class="content">p_id</span><span class="delimiter">&quot;</span></span>);
      <span class="keyword">if</span> (!resultSet.wasNull()) {
        Phone phone = <span class="keyword">new</span> Phone();
        phone.setId(phoneId);
        phone.setType(resultSet.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">p_type</span><span class="delimiter">&quot;</span></span>);
        phone.setPhone(resultSet.getString(<span class="string"><span class="delimiter">&quot;</span><span class="content">p_phone</span><span class="delimiter">&quot;</span></span>);
        contact.addPhone(phone);
      }

      <span class="keyword">return</span> acc;
    })
    .values()
    .stream()
    .collect(toList());</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_joinrowmapper"><a class="anchor" href="#_joinrowmapper"></a>JoinRowMapper</h5>
<div class="paragraph">
<p>The JoinRowMapper takes a set of types to extract from each row. It uses the
mapping registry to determine how to map each given type, and presents you with
a JoinRow that holds all of the resulting values.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s consider two simple types, User and Article, with a join table named
Author. Guava provides a Multimap class which is very handy for representing
joined tables like this. Assuming we have mappers already registered:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">h.registerRowMapper(ConstructorMapper.factory(User.class));
h.registerRowMapper(ConstructorMapper.factory(Article.class));</code></pre>
</div>
</div>
<div class="paragraph">
<p>we can then easily populate a Multimap with the mapping from the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Multimap&lt;User, Article&gt; joined = HashMultimap.create();
h.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user NATURAL JOIN author NATURAL JOIN article</span><span class="delimiter">&quot;</span></span>)
    .map(JoinRowMapper.forTypes(User.class, Article.class))
    .forEach(jr -&gt; joined.put(jr.get(User.class), jr.get(Article.class)));</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
While this approach is easy to read and write, it can be inefficient for
certain patterns of data. Consider performance requirements when deciding
whether to use high level mapping or more direct low level access with
handwritten mappers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also use it with SqlObject:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserArticleDao</span>
{
    <span class="annotation">@RegisterJoinRowMapper</span>({User.class, Article.class})
    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM user NATURAL JOIN author NATURAL JOIN article</span><span class="delimiter">&quot;</span></span>)
    Stream&lt;JoinRow&gt; getAuthorship();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Multimap&lt;User, Article&gt; joined = HashMultimap.create();

handle.attach(UserArticleDao.class)
        .getAuthorship()
        .forEach(jr -&gt; joined.put(jr.get(User.class), jr.get(Article.class)));

assertThat(joined).isEqualTo(JoinRowMapperTest.getExpected());</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_updates"><a class="anchor" href="#_updates"></a>3.8. Updates</h3>
<div class="paragraph">
<p>Updates are operations that return an integer number of rows modified, such
as a database <strong>INSERT</strong>, <strong>UPDATE</strong>, or <strong>DELETE</strong>.</p>
</div>
<div class="paragraph">
<p>You can execute a simple update with <code>Handle&#8217;s `int execute(String sql, Object&#8230;&#8203; args)</code>
method which binds simple positional parameters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">count = handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES(?, ?)</span><span class="delimiter">&quot;</span></span>, <span class="integer">4</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>);
assertThat(count).isEqualTo(<span class="integer">1</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>To further customize, use <code>createUpdate</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> count = handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES(:id, :name)</span><span class="delimiter">&quot;</span></span>)
    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">3</span>)
    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>)
    .execute();
assertThat(count).isEqualTo(<span class="integer">1</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Updates may return <a href="#_generated_keys">Generated Keys</a> instead of a result count.</p>
</div>
</div>
<div class="sect2">
<h3 id="_batches"><a class="anchor" href="#_batches"></a>3.9. Batches</h3>
<div class="paragraph">
<p>A <strong>Batch</strong> sends many commands to the server in bulk.</p>
</div>
<div class="paragraph">
<p>After opening the batch, repeated add statements, and invoke <strong>add</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Batch batch = handle.createBatch();

batch.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO fruit VALUES(0, 'apple')</span><span class="delimiter">&quot;</span></span>);
batch.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO fruit VALUES(1, 'banana')</span><span class="delimiter">&quot;</span></span>);

<span class="type">int</span><span class="type">[]</span> rowsModified = batch.execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The statements are sent to the database in bulk, but each statement is executed separately.
There are no parameters.  Each statement returns a modification count, as with an Update, and
those counts are then returned in an <code>int[]</code> array.  In common cases all elements will be <code>1</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prepared_batches"><a class="anchor" href="#_prepared_batches"></a>3.10. Prepared Batches</h3>
<div class="paragraph">
<p>A <strong>PreparedBatch</strong> sends one statement to the server with many argument sets.
The statement is executed repeatedly, once for each batch of arguments that is <strong>add</strong>-ed to it.</p>
</div>
<div class="paragraph">
<p>The result is again a <code>int[]</code> of modified row count.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">PreparedBatch batch = handle.prepareBatch(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user(id, name) VALUES(:id, :name)</span><span class="delimiter">&quot;</span></span>);
<span class="keyword">for</span> (<span class="type">int</span> i = <span class="integer">100</span>; i &lt; <span class="integer">5000</span>; i++)
{
    batch.bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, i).bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">User:</span><span class="delimiter">&quot;</span></span> + i).add();
}
<span class="type">int</span><span class="type">[]</span> counts = batch.execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>SqlObject also supports batch inserts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> testSqlObjectBatch() {
    BasketOfFruit basket = handle.attach(BasketOfFruit.class);

    <span class="type">int</span><span class="type">[]</span> rowsModified = basket.fillBasket(<span class="predefined-type">Arrays</span>.asList(
            <span class="keyword">new</span> Fruit(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">apple</span><span class="delimiter">&quot;</span></span>),
            <span class="keyword">new</span> Fruit(<span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">banana</span><span class="delimiter">&quot;</span></span>)));

    assertThat(rowsModified).containsExactly(<span class="integer">1</span>, <span class="integer">1</span>);
    assertThat(basket.countFruit()).isEqualTo(<span class="integer">2</span>);
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">BasketOfFruit</span> {
    <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO fruit VALUES(:id, :name)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">int</span><span class="type">[]</span> fillBasket(<span class="annotation">@BindBean</span> <span class="predefined-type">Collection</span>&lt;Fruit&gt; fruits);

    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT count(1) FROM fruit</span><span class="delimiter">&quot;</span></span>)
    <span class="type">int</span> countFruit();
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Batching dramatically increases efficiency over repeated single statement execution, but
many databases don&#8217;t handle extremely large batches well either.  Test with your database
configuration, but often extremely large data sets should be divided
and committed in pieces - or risk bringing your database to its knees.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_exception_rewriting"><a class="anchor" href="#_exception_rewriting"></a>3.10.1. Exception Rewriting</h4>
<div class="paragraph">
<p>The JDBC SQLException class is very old and predates more modern exception
facilities like Throwable&#8217;s suppressed exceptions. When a batch fails, there
may be multiple failures to report, which could not be represented by the base
Exception types of the day.</p>
</div>
<div class="paragraph">
<p>So SQLException has a bespoke
<a href="https://docs.oracle.com/javase/8/docs/api/java/sql/SQLException.html#getNextException--" target="_blank">getNextException</a>
chain to represent the causes of a batch failure. Unfortunately, by default
most logging libraries do not print these exceptions out, pushing their
handling into your code. It is very common to forget to handle this situation
and end up with logs that say nothing other than</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.sql.BatchUpdateException: Batch entry 1 insert into something (id, name) values (0, '') was aborted. Call getNextException to see the cause.</pre>
</div>
</div>
<div class="paragraph">
<p><strong>jdbi</strong> will attempt to rewrite such nextExceptions into "suppressed exceptions"
(new in Java 8) so that your logs are more helpful:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.sql.BatchUpdateException: Batch entry 1 insert into something (id, name) values (0, 'Keith') was aborted. Call getNextException to see the cause.
Suppressed: org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "something_pkey"
  Detail: Key (id)=(0) already exists.</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generated_keys"><a class="anchor" href="#_generated_keys"></a>3.11. Generated Keys</h3>
<div class="paragraph">
<p>An Update or PreparedBatch may automatically generate keys. These keys
are treated separately from normal results. Depending on your database and
configuration, the entire inserted row may be available.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Unfortunately there is a lot of variation between databases supporting
this feature so please test this feature&#8217;s interaction with your database
thoroughly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In PostgreSQL, the entire row is available, so you can immediately map your
inserted names back to full User objects!  This avoids the overhead of
separately querying after the insert completes.</p>
</div>
<div class="paragraph">
<p>Consider the following table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">User</span> {
    <span class="directive">final</span> <span class="type">int</span> id;
    <span class="directive">final</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> User(<span class="type">int</span> id, <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.id = id;
        <span class="local-variable">this</span>.name = name;
    }
}

<span class="annotation">@Before</span>
<span class="directive">public</span> <span class="type">void</span> setUp() <span class="directive">throws</span> <span class="exception">Exception</span> {
    db.useHandle(h -&gt; h.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE users (id SERIAL PRIMARY KEY, name VARCHAR)</span><span class="delimiter">&quot;</span></span>));
    db.registerRowMapper(ConstructorMapper.factory(User.class));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can get generated keys in the fluent style:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> fluentInsertKeys() {
    db.useHandle(handle -&gt; {
        User data = handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO users (name) VALUES(?)</span><span class="delimiter">&quot;</span></span>)
                .bind(<span class="integer">0</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Data</span><span class="delimiter">&quot;</span></span>)
                .executeAndReturnGeneratedKeys()
                .mapTo(User.class)
                .findOnly();

        assertEquals(<span class="integer">1</span>, data.id); <span class="comment">// This value is generated by the database</span>
        assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Data</span><span class="delimiter">&quot;</span></span>, data.name);
    });
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stored_procedure_calls"><a class="anchor" href="#_stored_procedure_calls"></a>3.12. Stored Procedure Calls</h3>
<div class="paragraph">
<p>A <strong>Call</strong> invokes a database stored procedure.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s assume an existing stored procedure as an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">FUNCTION</span> <span class="class">add</span>(a <span class="keyword">IN</span> <span class="predefined-type">INT</span>, b <span class="keyword">IN</span> <span class="predefined-type">INT</span>, <span class="predefined">sum</span> OUT <span class="predefined-type">INT</span>) <span class="keyword">AS</span> <span class="error">$</span><span class="error">$</span>
<span class="class">BEGIN</span>
  <span class="predefined">sum</span> := a + b;
<span class="keyword">END</span>;
<span class="error">$</span><span class="error">$</span> LANGUAGE plpgsql</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here&#8217;s how to call a stored procedure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">OutParameters result = handle
        .createCall(<span class="string"><span class="delimiter">&quot;</span><span class="content">{:sum = call add(:a, :b)}</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>, <span class="integer">13</span>) <i class="conum" data-value="2"></i><b>(2)</b>
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>, <span class="integer">9</span>) <i class="conum" data-value="2"></i><b>(2)</b>
        .registerOutParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">sum</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Types</span>.INTEGER)  <i class="conum" data-value="3"></i><b>(3)</b> <i class="conum" data-value="4"></i><b>(4)</b>
        .invoke(); <i class="conum" data-value="5"></i><b>(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Call <code>Handle.createCall()</code> with the SQL statement. Note that JDBC has a
peculiar SQL format when calling stored procedures, which we must follow.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Bind input parameters to the procedure call.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Register out parameters, the values that will be returned from the stored
procedure call. This tells JDBC what data type to expect for each out
parameter.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Out parameters may be registered by name (as shown in the example) or by
zero-based index, if the SQL is using positional parameters. Multiple output
parameters may be registered, depending on the output of the stored
procedure itself.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Finally, call <code>invoke()</code> to execute the procedure.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Invoking the stored procedure returns an
<a href="./apidocs/org/jdbi/v3/core/statement/OutParameters.html" target="_blank">OutParameters</a> object, which
contains the value(s) returned from the stored procedure call.</p>
</div>
<div class="paragraph">
<p>Now we can extract the result(s) from <code>OutParameters</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span> sum = result.getInt(<span class="string"><span class="delimiter">&quot;</span><span class="content">sum</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Due to design constraints within JDBC, the parameter data types available
through <code>OutParameters</code> is limited to those types supported directly by JDBC.
This cannot be expanded through e.g. mapper registration.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_scripts"><a class="anchor" href="#_scripts"></a>3.13. Scripts</h3>
<div class="paragraph">
<p>A <strong>Script</strong> parses a String into semicolon terminated statements. The statements
can be executed in a single <strong>Batch</strong> or individually.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">int</span><span class="type">[]</span> results = handle.createScript(
        <span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO user VALUES(3, 'Charlie');</span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">UPDATE user SET name='Bobby Tables' WHERE id=2;</span><span class="delimiter">&quot;</span></span>)
    .execute();

assertThat(results).containsExactly(<span class="integer">1</span>, <span class="integer">1</span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transactions"><a class="anchor" href="#_transactions"></a>3.14. Transactions</h3>
<div class="paragraph">
<p><strong>jdbi</strong> provides full support for JDBC transactions.</p>
</div>
<div class="paragraph">
<p><strong>Handle</strong> objects provide two ways to open a transaction&#8201;&#8212;&#8201;<strong>inTransaction</strong>
allows you to return a result, and <strong>useTransaction</strong> has no return value.</p>
</div>
<div class="paragraph">
<p>Both optionally allow you to specify the transaction isolation level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Optional&lt;User&gt; findUserById(<span class="type">long</span> id) {
    <span class="keyword">return</span> handle.inTransaction(h -&gt;
            h.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM users WHERE id=:id</span><span class="delimiter">&quot;</span></span>)
                    .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, id)
                    .mapTo(User.class)
                    .findFirst());
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here, we (probably unnecessarily) guard a simple <em>SELECT</em> statement with a transaction.</p>
</div>
<div class="paragraph">
<p>Additionally, Handle has a number of methods for direct transaction management:
begin(), savepoint(), rollback(), commit(), etc.  Normally, you will not need to use these.
Failing to explicitly commit or roll back a transaction will roll back the transaction and throw an exception.</p>
</div>
<div class="sect3">
<h4 id="_serializable_transactions"><a class="anchor" href="#_serializable_transactions"></a>3.14.1. Serializable Transactions</h4>
<div class="paragraph">
<p>For more advanced queries, sometimes serializable transactions are required.
<strong>jdbi</strong> includes a transaction runner that is able to retry transactions that
abort due to serialization failures. It is important that your transaction does
not have side effects as it may be executed multiple times.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Automatically rerun transactions</span>
db.setTransactionHandler(<span class="keyword">new</span> SerializableTransactionRunner());

<span class="comment">// Set up some values</span>
BiConsumer&lt;Handle, <span class="predefined-type">Integer</span>&gt; insert = (h, i) -&gt; h.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO ints(value) VALUES(?)</span><span class="delimiter">&quot;</span></span>, i);
handle.execute(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE TABLE ints (value INTEGER)</span><span class="delimiter">&quot;</span></span>);
insert.accept(handle, <span class="integer">10</span>);
insert.accept(handle, <span class="integer">20</span>);

<span class="comment">// Run the following twice in parallel, and synchronize</span>
<span class="predefined-type">ExecutorService</span> executor = <span class="predefined-type">Executors</span>.newCachedThreadPool();
<span class="predefined-type">CountDownLatch</span> latch = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">2</span>);

<span class="predefined-type">Callable</span>&lt;<span class="predefined-type">Integer</span>&gt; sumAndInsert = () -&gt;
    db.inTransaction(TransactionIsolationLevel.SERIALIZABLE, h -&gt; {
        <span class="comment">// Both read initial state of table</span>
        <span class="type">int</span> sum = h.select(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT sum(value) FROM ints</span><span class="delimiter">&quot;</span></span>).mapTo(<span class="type">int</span>.class).findOnly();

        <span class="comment">// First time through, make sure neither transaction writes until both have read</span>
        latch.countDown();
        latch.await();

        <span class="comment">// Now do the write.</span>
        insert.accept(h, sum);
        <span class="keyword">return</span> sum;
    });

<span class="comment">// Both of these would calculate 10 + 20 = 30, but that violates serialization!</span>
<span class="predefined-type">Future</span>&lt;<span class="predefined-type">Integer</span>&gt; result1 = executor.submit(sumAndInsert);
<span class="predefined-type">Future</span>&lt;<span class="predefined-type">Integer</span>&gt; result2 = executor.submit(sumAndInsert);

<span class="comment">// One of the transactions gets 30, the other will abort and automatically rerun.</span>
<span class="comment">// On the second attempt it will compute 10 + 20 + 30 = 60, seeing the update from its sibling.</span>
<span class="comment">// This assertion fails under any isolation level below SERIALIZABLE!</span>
assertThat(result1.get() + result2.get()).isEqualTo(<span class="integer">30</span> + <span class="integer">60</span>);

executor.shutdown();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above test is designed to run two transactions in lock step. Each attempts
to read the sum of all rows in the table, and then insert a new row with that
sum. We seed the table with the values 10 and 20.</p>
</div>
<div class="paragraph">
<p>Without serializable isolation, each transaction reads 10 and 20, and then
returns 30. The end result is 30 + 30 = 60, which does not correspond to any
serial execution of the transactions!</p>
</div>
<div class="paragraph">
<p>With serializable isolation, one of the two transactions is forced to abort and
retry. On the second go around, it calculates 10 + 20 + 30 = 60. Adding to 30
from the other, we get 30 + 60 = 90 and the assertion succeeds.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_classpathsqllocator"><a class="anchor" href="#_classpathsqllocator"></a>3.15. ClasspathSqlLocator</h3>
<div class="paragraph">
<p>You may find it helpful to store your SQL templates in individual files on the
classpath, rather than in string inside Java code.</p>
</div>
<div class="paragraph">
<p>The <code>ClasspathSqlLocator</code> converts Java type and method names into classpath locations,
and then reads, parses, and caches the loaded statements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// reads classpath resource com/foo/BarDao/query.sql</span>
ClasspathSqlLocator.findSqlOnClasspath(com.foo.BarDao.class, <span class="string"><span class="delimiter">&quot;</span><span class="content">query</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// same resource as above</span>
ClasspathSqlLocator.findSqlOnClasspath(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.BarDao.query</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_statementcontext"><a class="anchor" href="#_statementcontext"></a>3.16. StatementContext</h3>
<div class="paragraph">
<p>The <a href="./apidocs/org/jdbi/v3/core/statement/StatementContext.html">StatementContext</a> class
is a carrier for various state related to the creation and execution of statements
that is not appropriate to hold on the <strong>Query</strong> or other particular statement class
itself.  Among other things, it holds open <strong>JDBC</strong> resources, processed SQL statements,
and accumulated bindings.  It is exposed to implementations of most user extension points,
for example <strong>RowMapper, *ColumnMapper*s, or *CollectorFactory</strong>.</p>
</div>
<div class="paragraph">
<p>The <strong>StatementContext</strong> itself is not intended to be extended and generally extensions
should not need to mutate the context.  Please read the JavaDoc for more information
on advanced usage.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sql_objects"><a class="anchor" href="#_sql_objects"></a>4. SQL Objects</h2>
<div class="sectionbody">
<div class="paragraph">
<p>SQL Objects are a declarative-style alternative to the fluent-style Core API.</p>
</div>
<div class="paragraph">
<p>To start using the SQL Object plugin, add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-sqlobject<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the plugin into your <code>Jdbi</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Jdbi jdbi = ...
jdbi.installPlugin(<span class="keyword">new</span> SqlObjectPlugin());</code></pre>
</div>
</div>
<div class="paragraph">
<p>With SQL Object, you declare a public interface, add methods for each database
operation, and specify what SQL statement to execute.</p>
</div>
<div class="paragraph">
<p>You can specify what each method does in one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Annotate the method with a SQL method annotation. Jdbi provides four of these
annotations out of the box (updates, queries, stored procedure calls, and
batches).</p>
</li>
<li>
<p>Declare the method as a Java 8 <code>default</code> method, and provide your own
implementation in the method body.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At runtime, you can request an instance of your interface, and Jdbi synthesizes
an implementation based on the annotations and methods you declared.</p>
</div>
<div class="sect2">
<h3 id="_annotated_methods"><a class="anchor" href="#_annotated_methods"></a>4.1. Annotated Methods</h3>
<div class="paragraph">
<p>Methods annotated with one of Jdbi&#8217;s SQL method annotations
(<a href="./apidocs/org/jdbi/v3/sqlobject/statement/SqlBatch.html" target="_blank">@SqlBatch</a>,
<a href="./apidocs/org/jdbi/v3/sqlobject/statement/SqlCall.html" target="_blank">@SqlCall</a>,
<a href="./apidocs/org/jdbi/v3/sqlobject/statement/SqlQuery.html" target="_blank">@SqlQuery</a>, or
<a href="./apidocs/org/jdbi/v3/sqlobject/statement/SqlUpdate.html" target="_blank">@SqlUpdate</a>) have their
implementation generated automatically, based on the annotations on the method,
and its parameters.</p>
</div>
<div class="paragraph">
<p>The parameters to the method are used as arguments to the statement, and the
SQL statement result mapped into the method return type.</p>
</div>
<div class="sect3">
<h4 id="__sqlupdate"><a class="anchor" href="#__sqlupdate"></a>4.1.1. @SqlUpdate</h4>
<div class="paragraph">
<p>Use the <code>@SqlUpdate</code> annotation for operations that modify data (i.e. inserts,
updates, deletes).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (?, ?)</span><span class="delimiter">&quot;</span></span>)
  <span class="type">void</span> insert(<span class="type">long</span> id, <span class="predefined-type">String</span> name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Method arguments are bound to the <code>?</code> token in the SQL statement at their
respective positions. So <code>id</code> is bound to the first <code>?</code>, and <code>name</code> to the
second.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<code>@SqlUpdate</code> can also be used for DDL (Data Definition Language) operations like
creating or altering tables. We recommend using a schema migration tool such
as <a href="https://flywaydb.org/" target="_blank">Flyway</a> or
<a href="http://www.liquibase.org/" target="_blank">Liquibase</a> to maintain your database schemas.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, a <code>@SqlUpdate</code> method may return a handful of types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code>: returns nothing (obviously)</p>
</li>
<li>
<p><code>int</code> or <code>long</code>: returns the update count. Depending on the database vendor
and JDBC driver, this may be either the number of rows changed, or the number
matched by the query (regardless of whether any data was changed).</p>
</li>
<li>
<p><code>boolean</code>: returns true if the update count is greater than zero.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="__getgeneratedkeys"><a class="anchor" href="#__getgeneratedkeys"></a>@GetGeneratedKeys</h5>
<div class="paragraph">
<p>Some SQL statements will cause data to be generated on your behalf at the
database, e.g. a table with an auto-generated primary key, or a primary key
selected from a sequence. We need a way to retrieve these generated values back
from the database.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Databases vary in support for generated keys. Some support only one generated
key column per statement, and some (such as Postgres) can return the entire row.
You should check your database vendor&#8217;s documentation before relying on this
behavior.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@GetGeneratedKeys</code> annotation tells Jdbi that the return value should be
generated key from the SQL statement, instead of the update count.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (nextval('user_seq'), ?)</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@GetGeneratedKeys</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
  <span class="type">long</span> insert(<span class="predefined-type">String</span> name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Multiple columns may be generated and returned in this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name, created_on) values (nextval('user_seq'), ?, now())</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@GetGeneratedKeys</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">created_on</span><span class="delimiter">&quot;</span></span>})
  <span class="annotation">@RegisterBeanMapper</span>(IdCreateTime.class)
  IdCreateTime insert(<span class="predefined-type">String</span> name);
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The One True Database supports additional functionality when returning generated
keys. See <a href="#__getgeneratedkeys_4">PostgreSQL</a> for more details.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_binding_arguments_2"><a class="anchor" href="#_binding_arguments_2"></a>4.1.2. Binding Arguments</h4>
<div class="paragraph">
<p>Before we go on with the other <code>@Sql___</code> annotations, let&#8217;s discuss how method
arguments are bound as parameters to the SQL statement.</p>
</div>
<div class="paragraph">
<p>By default, arguments passed to the method are bound as positional parameters
in the SQL statement.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (?, ?)</span><span class="delimiter">&quot;</span></span>)
  <span class="type">void</span> insert(<span class="type">long</span> id, <span class="predefined-type">String</span> name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can use named arguments with the <code>@Bind</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> insert(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="type">long</span> id, <span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name);</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#_compiling_with_parameter_names">Compiling with parameter names</a> removes the
need for the <code>@Bind</code> annotation. Jdbi will then bind each un-annotated parameter
to the parameter&#8217;s name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> insert(<span class="type">long</span> id, <span class="predefined-type">String</span> name);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Binding a list of values is done through the <code>@BindList</code> annotation. This will expand the list in a 'a,b,c,d,&#8230;&#8203;' form. Note that this annotation requires you to use the <code>&lt;binding&gt;</code> notation, unlike <code>@Bind</code> (which uses :binding)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from users where id in (&lt;userIds&gt;)</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getFromIds(<span class="annotation">@BindList</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">userIds</span><span class="delimiter">&quot;</span></span>) userIds)</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can bind from the entries of a <code>Map</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> insert(<span class="annotation">@BindMap</span> <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, ?&gt; map);</code></pre>
</div>
</div>
<div class="paragraph">
<p>In SQL Object (but not in Core), you can qualify a bound map with a prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (:user.id, :user.name)</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> insert(<span class="annotation">@BindMap</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, ?&gt; map);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can bind from the properties of a Java Bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> insert(<span class="annotation">@BindBean</span> User user);</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can bind from the public fields of an object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> insert(<span class="annotation">@BindFields</span> User user);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or you can bind from public, parameterless methods of an object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (:functionThatReturnsTheId, :functionThatReturnsTheName)</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> insert(<span class="annotation">@BindMethods</span> User user);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Like <code>@BindMap</code>, the <code>@BindBean</code>, <code>@BindMethods</code>, and <code>@BindFields</code> annotations
can have an optional prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (:user.id, :user.name)</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> insert(<span class="annotation">@BindBean</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>) User user);
<span class="comment">//void insert(@BindFields(&quot;user&quot;) User user);</span>
<span class="comment">//void insert(@BindMethods(&quot;user&quot;) User user);</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
As in the Core API, <code>@BindBean</code>, <code>@BindFields</code>, and <code>@BindMethods</code> may be used
to bind nested properties, e.g. <code>:user.address.street</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>@BindMap</code> does not bind nested properties&#8212;&#8203;map keys are expected to exactly
match the bound parameter name.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="__sqlquery"><a class="anchor" href="#__sqlquery"></a>4.1.3. @SqlQuery</h4>
<div class="paragraph">
<p>Use the <code>@SqlQuery</code> annotation for select operations.</p>
</div>
<div class="paragraph">
<p>Query methods may return a single- or multi-row result, depending on whether the
method return type looks like a collection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from users</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; listNames(); <i class="conum" data-value="1"></i><b>(1)</b>

  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from users where id = ?</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">String</span> getName(<span class="type">long</span> id);  <i class="conum" data-value="2"></i><b>(2)</b> <i class="conum" data-value="3"></i><b>(3)</b>

  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from users where id = ?</span><span class="delimiter">&quot;</span></span>)
  Optional&lt;<span class="predefined-type">String</span>&gt; findName(<span class="type">long</span> id); <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When a multi-row method returns an empty result set, an empty collection is
returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>If a single-row method returns multiple rows from the query, only the first
row in the result set is returned from the method.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>If a single-row method returns an empty result set, <code>null</code> is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Methods may return <code>Optional</code> values. If the query returns no rows (or if
the value in the row is null), <code>Optional.empty()</code> is returned instead of null.
SQL Object throws an exception if query returns more than one row.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Jdbi can be "taught" to recognize new collection types by registering a
<a href="./apidocs/org/jdbi/v3/core/collector/CollectorFactory.html" target="_blank">CollectorFactory</a> with the
<a href="#JdbiCollectors">[JdbiCollectors]</a> config registry.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See
<a href="./apidocs/org/jdbi/v3/core/collector/BuiltInCollectorFactory.html" target="_blank">BuiltInCollectorFactory</a>
for the complete list of collection types supported out of the box. Certain
Jdbi plugins (e.g. <code>GuavaPlugin</code>) register additional collection types.</p>
</div>
<div class="paragraph">
<p>Query methods may also return a <a href="#_resultiterable">ResultIterable</a>,
<a href="./apidocs/org/jdbi/v3/core/result/ResultIterator.html" target="_blank">ResultIterator</a>, or a
<code>Stream</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from users</span><span class="delimiter">&quot;</span></span>)
  ResultIterable&lt;<span class="predefined-type">String</span>&gt; getNamesAsIterable();

  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from users</span><span class="delimiter">&quot;</span></span>)
  ResultIterator&lt;<span class="predefined-type">String</span>&gt; getNamesAsIterator();

  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from users</span><span class="delimiter">&quot;</span></span>)
  Stream&lt;<span class="predefined-type">String</span>&gt; getNamesAsStream();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The objects returned from these methods hold database resources that must be
explicitly closed when you are done with them. We strongly recommend the use of
try-with-resource blocks when calling these methods, to prevent resource leaks:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (ResultIterable&lt;<span class="predefined-type">String</span>&gt; names = dao.getNamesAsIterable()) {
  ...
}

<span class="keyword">try</span> (ResultIterator&lt;<span class="predefined-type">String</span>&gt; names = dao.getNamesAsIterator()) {
  ...
}

<span class="keyword">try</span> (Stream&lt;<span class="predefined-type">String</span>&gt; names = dao.getNamesAsStream()) {
  ...
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>ResultIterable</code>, <code>ResultIterator</code> and <code>Stream</code> methods do not play nice with
on-demand SQL Objects. Unless the methods are called in a nested way (see
<a href="#_on_demand">On-Demand</a>), the returned object will already be closed.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="__registerrowmapper"><a class="anchor" href="#__registerrowmapper"></a>@RegisterRowMapper</h5>
<div class="paragraph">
<p>Use <code>@RegisterRowMapper</code> to register a concrete row mapper class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from users</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterRowMapper</span>(UserMapper.class)
  <span class="predefined-type">List</span>&lt;User&gt; list();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Row mappers used with this annotation must meet a few requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserMapper</span> <span class="directive">implements</span> <span class="predefined-type">RowMapper</span>&lt;User&gt; {  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="directive">public</span> UserMapper() { <i class="conum" data-value="3"></i><b>(3)</b>
    ...
  }

  <span class="directive">public</span> T map(<span class="predefined-type">ResultSet</span> rs, StatementContext ctx) <span class="directive">throws</span> <span class="exception">SQLException</span> {
    ...
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Must be a public class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Must implement <code>RowMapper</code> with an explicit type argument (e.g.
<code>RowMapper&lt;User&gt;</code>) instead of a type variable (e.g. <code>RowMapper&lt;T&gt;</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Must have a public, no-argument constructor (or a default constructor).</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>@RegisterRowMapper</code> annotation may be repeated multiple times on the same
type or method to register multiple mappers.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__registerrowmapperfactory"><a class="anchor" href="#__registerrowmapperfactory"></a>@RegisterRowMapperFactory</h5>
<div class="paragraph">
<p>Use <code>@RegisterRowMapperFactory</code> to register a <code>RowMapperFactory</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from users</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterRowMapperFactory</span>(UserMapperFactory.class)
  <span class="predefined-type">List</span>&lt;User&gt; list();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Row mapper factories used with this annotation must meet a few requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserMapperFactory</span> <span class="directive">implements</span> RowMapperFactory { <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="directive">public</span> UserMapperFactory() { <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  }

  <span class="directive">public</span> Optional&lt;<span class="predefined-type">RowMapper</span>&lt;?&gt;&gt; build(<span class="predefined-type">Type</span> type, ConfigRegistry config) {
    ...
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Must be a public class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Must have a public, no-argument constructor (or a default constructor).</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>@RegisterRowMapperFactory</code> annotation may be repeated multiple times on the
same type or method to register multiple factories.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__registercolumnmapper"><a class="anchor" href="#__registercolumnmapper"></a>@RegisterColumnMapper</h5>
<div class="paragraph">
<p>Use <code>@RegisterColumnMapper</code> to register a column mapper:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select balance from accounts where id = ?</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterColumnMapper</span>(MoneyMapper.class)
  Money getBalance(<span class="type">long</span> id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Column mappers used with this annotation must meet a few requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MoneyMapper</span> <span class="directive">implements</span> ColumnMapper&lt;Money&gt; {  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="directive">public</span> MoneyMapper() { <i class="conum" data-value="3"></i><b>(3)</b>
    ...
  }

  <span class="directive">public</span> T map(<span class="predefined-type">ResultSet</span> r, <span class="type">int</span> columnNumber, StatementContext ctx) <span class="directive">throws</span> <span class="exception">SQLException</span> {
    ...
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Must be a public class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Must implement <code>ColumnMapper</code> with an explicit type argument (e.g.
<code>ColumnMapper&lt;User&gt;</code>) instead of a type variable (e.g. <code>ColumnMapper&lt;T&gt;</code>).</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Must have a public, no-argument constructor (or a default constructor).</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>@RegisterColumnMapper</code> annotation may be repeated multiple times on the
same type or method to register multiple mappers.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__registercolumnmapperfactory"><a class="anchor" href="#__registercolumnmapperfactory"></a>@RegisterColumnMapperFactory</h5>
<div class="paragraph">
<p>Use <code>@RegisterColumnMapperFactory</code> to register a column mapper factory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from users</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterColumnMapperFactory</span>(MoneyMapperFactory.class)
  <span class="predefined-type">List</span>&lt;User&gt; list();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Row mapper factories used with this annotation must meet a few requirements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">UserMapperFactory</span> <span class="directive">implements</span> RowMapperFactory { <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="directive">public</span> UserMapperFactory() { <i class="conum" data-value="2"></i><b>(2)</b>
    ...
  }

  <span class="directive">public</span> Optional&lt;<span class="predefined-type">RowMapper</span>&lt;?&gt;&gt; build(<span class="predefined-type">Type</span> type, ConfigRegistry config) {
    ...
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Must be a public class.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Must have a public, no-argument constructor (or a default constructor).</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>@RegisterColumnMapperFactory</code> annotation may be repeated multiple times on
the same type or method to register multiple factories.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__registerbeanmapper"><a class="anchor" href="#__registerbeanmapper"></a>@RegisterBeanMapper</h5>
<div class="paragraph">
<p>Use <code>@RegisterBeanMapper</code> to register a <a href="#_beanmapper">BeanMapper</a> for a bean class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from users</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterBeanMapper</span>(User.class)
  <span class="predefined-type">List</span>&lt;User&gt; list();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>prefix</code> attribute causes the bean mapper to map only those columns
that begin with the prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u.id u_id, u.name u_name, r.id r_id, r.name r_name </span><span class="delimiter">&quot;</span></span> +
      <span class="string"><span class="delimiter">&quot;</span><span class="content">from users u left join roles r on u.role_id = r.id</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterBeanMapper</span>(value = User.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterBeanMapper</span>(value = <span class="predefined-type">Role</span>.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">r</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">Map</span>&lt;User,<span class="predefined-type">Role</span>&gt; getRolesPerUser();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>User</code> mapper will map the columns <code>u_id</code> and <code>u_name</code> into
the <code>User.id</code> and <code>User.name</code> properties. Likewise for <code>r_id</code> and <code>r_name</code> into
<code>Role.id</code> and <code>Role.name</code>, respectively.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>@RegisterBeanMapper</code> annotation may be repeated (as demonstrated above) on
the same type or method to register multiple bean mappers.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__registerconstructormapper"><a class="anchor" href="#__registerconstructormapper"></a>@RegisterConstructorMapper</h5>
<div class="paragraph">
<p>Use <code>@RegisterConstructorMapper</code> to register a <a href="#_constructormapper">ConstructorMapper</a> for classes
that are instantiated with all properties through the constructor.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from users</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterConstructorMapper</span>(User.class)
  <span class="predefined-type">List</span>&lt;User&gt; list();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>prefix</code> attribute causes the constructor mapper to only map those
columns that begin with the prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u.id u_id, u.name u_name, r.id r_id, r.name r_name </span><span class="delimiter">&quot;</span></span> +
      <span class="string"><span class="delimiter">&quot;</span><span class="content">from users u left join roles r on u.role_id = r.id</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterConstructorMapper</span>(value = User.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterConstructorMapper</span>(value = <span class="predefined-type">Role</span>.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">r</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">Map</span>&lt;User,<span class="predefined-type">Role</span>&gt; getRolesPerUser();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>User</code> mapper will map the columns <code>u_id</code> and <code>u_name</code> into
the <code>id</code> and <code>name</code> parameters of the <code>User</code> constructor. Likewise for <code>r_id</code>
and <code>r_name</code> into <code>id</code> and <code>name</code> parameters of the <code>Role</code> constructor,
respectively.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>@RegisterConstructorMapper</code> annotation may be repeated multiple times on
the same type or method to register multiple constructor mappers.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__registerfieldmapper"><a class="anchor" href="#__registerfieldmapper"></a>@RegisterFieldMapper</h5>
<div class="paragraph">
<p>Use <code>@RegisterFieldMapper</code> to register a <a href="#_fieldmapper">FieldMapper</a> for a given class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from users</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterFieldMapper</span>(User.class)
  <span class="predefined-type">List</span>&lt;User&gt; list();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>prefix</code> attribute causes the field mapper to only map those columns
that begin with the prefix:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u.id u_id, u.name u_name, r.id r_id, r.name r_name </span><span class="delimiter">&quot;</span></span> +
      <span class="string"><span class="delimiter">&quot;</span><span class="content">from users u left join roles r on u.role_id = r.id</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterFieldMapper</span>(value = User.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterFieldMapper</span>(value = <span class="predefined-type">Role</span>.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">r</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">Map</span>&lt;User,<span class="predefined-type">Role</span>&gt; getRolesPerUser();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <code>User</code> mapper will map the columns <code>u_id</code> and <code>u_name</code> into
the <code>User.id</code> and <code>User.name</code> fields. Likewise for <code>r_id</code> and <code>r_name</code> into the
<code>Role.id</code> and <code>Role.name</code> fields, respectively.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The <code>@RegisterConstructorMapper</code> annotation may be repeated multiple times on
the same type or method to register multiple constructor mappers.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__singlevalue"><a class="anchor" href="#__singlevalue"></a>@SingleValue</h5>
<div class="paragraph">
<p>Sometimes when using advanced SQL features like Arrays, a container type like
<code>int[]</code> or <code>List&lt;Integer&gt;</code> can ambiguously mean either "a single SQL int[]" or
"a ResultSet of int".</p>
</div>
<div class="paragraph">
<p>Since arrays are not commonly used in normalized schema, SQL Object assumes by
default that you are collecting a ResultSet into a container object. You can
annotate a return type as <code>@SingleValue</code> to override this.</p>
</div>
<div class="paragraph">
<p>For example, suppose we want to select a <code>varchar[]</code> column from a single row:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select roles from users where id = ?</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@SingleValue</span>
  <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getUserRoles(<span class="type">long</span> userId)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Normally, Jdbi would interpret <code>List&lt;String&gt;</code> to mean that the mapped type is
<code>String</code>, and to collect all result rows into a list. The <code>@SingleValue</code>
annotation causes Jdbi to treat <code>List&lt;String&gt;</code> as the mapped type instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It&#8217;s tempting to <code>@SingleValue Optional&lt;String&gt;</code>, but usually this isn&#8217;t needed.
<code>Optional</code> is implemented as a container of zero-or-one elements.  Adding <code>@SingleValue</code>
implies that the database itself has a column of a type like <code>optional&lt;varchar&gt;</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_map_k_v_results"><a class="anchor" href="#_map_k_v_results"></a>Map&lt;K,V&gt; Results</h5>
<div class="paragraph">
<p>SQL Object methods may return <code>Map&lt;K,V&gt;</code> types (see <a href="#_map_entry_mapping">Map.Entry mapping</a> in
the Core API). In this scenario, each row is mapped to a <code>Map.Entry&lt;K,V&gt;</code>,
and the entries for each row are collected into a single <code>Map</code> instance.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A mapper must be registered for both the key and value types.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gather master/detail join rows into a map, simply by registering mappers
for the key and value types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u.id u_id, u.name u_name, p.id p_id, p.phone p_phone </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">from user u left join phone p on u.id = p.user_id</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RegisterConstructorMapper</span>(value = User.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RegisterConstructorMapper</span>(value = Phone.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">Map</span>&lt;User, Phone&gt; getMap();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the preceding example, the <code>User</code> mapper uses a "u" column name prefix, and
the <code>Phone</code> mapper uses "p". Since each mapper only reads the column with the
expected prefix, the respective <code>id</code> columns are unambigous.</p>
</div>
<div class="paragraph">
<p>A unique index (e.g. by ID column) can be obtains by setting the key column
name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from user</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@KeyColumn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RegisterConstructorMapper</span>(User.class)
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">Integer</span>, User&gt; getAll();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set both the key and value column names to gather a two-column query into a map
result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select key, value from config</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@KeyColumn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">key</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ValueColumn</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>)
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; getAll();</code></pre>
</div>
</div>
<div class="paragraph">
<p>All of the above examples assume a one-to-one key/value relationship.</p>
</div>
<div class="paragraph">
<p>What if there is a one-to-many relationship? Google Guava provides a <code>Multimap</code>
type, which supports mapping multiple values per key.</p>
</div>
<div class="paragraph">
<p>First, follow the instructions in the <a href="#_google_guava">Google Guava</a> section to install
<code>GuavaPlugin</code>.</p>
</div>
<div class="paragraph">
<p>Then, simply specify a <code>Multimap</code> return type instead of <code>Map</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select u.id u_id, u.name u_name, p.id p_id, p.phone p_phone </span><span class="delimiter">&quot;</span></span> +
        <span class="string"><span class="delimiter">&quot;</span><span class="content">from user u left join phone p on u.id = p.user_id</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RegisterConstructorMapper</span>(value = User.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">u</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RegisterConstructorMapper</span>(value = Phone.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">p</span><span class="delimiter">&quot;</span></span>)
Multimap&lt;User, Phone&gt; getMultimap();</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the examples so far have been <code>Map</code> types where each row in the result set
is a single <code>Map.Entry</code>. However, what if the <code>Map</code> we want to return is
actually a single row or even a single column?</p>
</div>
<div class="paragraph">
<p>Jdbi&#8217;s <a href="./apidocs/org/jdbi/v3/core/mapper/MapMapper.html" target="_blank">MapMapper</a> maps each row to a
<code>Map&lt;String, Object&gt;</code>, where column names (converted to lowercase) are mapped to
column values.</p>
</div>
<div class="paragraph">
<p>By default, SQL Object treats <code>Map</code> return types as a collection of <code>Map.Entry</code>
values. Use the <code>@SingleValue</code> annotation to override this, so that the return
type is treated as a single value instead of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from users where id = ?</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@RegisterRowMapper</span>(MapMapper.class)
<span class="annotation">@SingleValue</span>
<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; getById(<span class="type">long</span> userId);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Do you use PostgreSQL&#8217;s <code>hstore</code> columns? The <a href="#_postgresql">PostgreSQL</a> plugin provides an
<code>hstore</code> to <code>Map&lt;String, String&gt;</code> column mapper. See
<a href="#_hstore">hstore</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="__userowreducer"><a class="anchor" href="#__userowreducer"></a>@UseRowReducer</h5>
<div class="paragraph">
<p><code>@SqlQuery</code> methods that use join queries may reduce master-detail joins
into one or more master-level objects. See <a href="#_resultbearing_reducerows">ResultBearing.reduceRows()</a> for
an introduction to row reducers.</p>
</div>
<div class="paragraph">
<p>Consider a filesystem metaphor with folders and documents. In the join, we&#8217;ll
prefix folder columns with <code>f_</code> and document columns with <code>d_</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@RegisterBeanMapper</span>(value = Folder.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">f</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@RegisterBeanMapper</span>(value = <span class="predefined-type">Document</span>.class, prefix = <span class="string"><span class="delimiter">&quot;</span><span class="content">d</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">DocumentDao</span> {
    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">f.id f_id, f.name f_name, </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">d.id d_id, d.name d_name, d.contents d_contents </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">from folders f left join documents d </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">on f.id = d.folder_id </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">where f.id = :folderId</span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">order by d.name</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@UseRowReducer</span>(FolderDocReducer.class) <i class="conum" data-value="2"></i><b>(2)</b>
    Optional&lt;Folder&gt; getFolder(<span class="type">int</span> folderId); <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">f.id f_id, f.name f_name, </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">d.id d_id, d.name d_name, d.contents d_contents </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">from folders f left join documents d </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">on f.id = d.folder_id </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">order by f.name, d.name</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@UseRowReducer</span>(FolderDocReducer.class) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="predefined-type">List</span>&lt;Folder&gt; listFolders(); <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="type">class</span> <span class="class">FolderDocReducer</span> <span class="directive">extends</span> LinkedHashMapRowReducer&lt;<span class="predefined-type">Integer</span>, Folder&gt; { <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> accumulate(<span class="predefined-type">Map</span>&lt;<span class="predefined-type">Integer</span>, Folder&gt; map, RowView rowView) {
            Folder f = map.computeIfAbsent(rowView.getColumn(<span class="string"><span class="delimiter">&quot;</span><span class="content">f_id</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class), <i class="conum" data-value="2"></i><b>(2)</b>
                                           id -&gt; rowView.getRow(Folder.class));

            <span class="keyword">if</span> (rowView.getColumn(<span class="string"><span class="delimiter">&quot;</span><span class="content">d_id</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class) != <span class="predefined-constant">null</span>) { <i class="conum" data-value="3"></i><b>(3)</b>
                f.getDocuments().add(rowView.getRow(<span class="predefined-type">Document</span>.class));
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this example, we register the folder and document mappers with a
prefix, so that each mapper only looks at the columns with that prefix.
These mappers are used indirectly by the row reducer in the
<code>getRow(Folder.class)</code> and <code>getRow(Document.class)</code> calls.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the method with <code>@UseRowReducer</code>, and specify the <code>RowReducer</code>
implementation class.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The same <code>RowReducer</code> implementation may be used for both single- and
multi-master-record queries.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><a href="./apidocs/org/jdbi/v3/core/result/LinkedHashMapRowReducer.html" target="_blank">LinkedHashMapRowReducer</a>
is an abstract <code>RowReducer</code> implementation that uses a <code>LinkedHashMap</code> as the result
container, and returns the <code>values()</code> collection as the result.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Get the <code>Folder</code> for this row from the map by ID, or create it if not in the map.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Confirm this row has a document (this <em>is</em> a left join) before mapping a document
and adding it to the folder.</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__sqlbatch"><a class="anchor" href="#__sqlbatch"></a>4.1.4. @SqlBatch</h4>
<div class="paragraph">
<p>Use the <code>@SqlBatch</code> annotation for bulk update operations. <code>@SqlBatch</code> is
analogous to <a href="#_prepared_batches">PreparedBatch</a> in Core.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ContactDao</span> {
  <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name, email) values (?, ?, ?)</span><span class="delimiter">&quot;</span></span>)
  <span class="type">void</span> bulkInsert(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; ids,
                  <span class="predefined-type">Iterator</span>&lt;<span class="predefined-type">String</span>&gt; names,
                  <span class="predefined-type">String</span>... emails);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Batch parameters may be collections, iterables, iterators, arrays (including
varargs). We&#8217;ll call these "iterables" for brevity.</p>
</div>
<div class="paragraph">
<p>When a batch method is called, SQL Object iterates through the method&#8217;s iterable
parameters, and executes the SQL statement with the corresponding elements from
each parameter.</p>
</div>
<div class="paragraph">
<p>Thus a statement like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">contactDao.bulkInsert(
    ImmutableList.of(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>),
    ImmutableList.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span>).iterator(),
    <span class="string"><span class="delimiter">&quot;</span><span class="content">a@example.com</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">b@example.com</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">c@fake.com</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>would execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">insert</span> <span class="class">into</span> contacts (id, name, email) <span class="keyword">values</span> (<span class="integer">1</span>, <span class="string"><span class="delimiter">'</span><span class="content">foo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">a@example.com</span><span class="delimiter">'</span></span>);
<span class="class">insert</span> <span class="class">into</span> contacts (id, name, email) <span class="keyword">values</span> (<span class="integer">2</span>, <span class="string"><span class="delimiter">'</span><span class="content">bar</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">b@example.com</span><span class="delimiter">'</span></span>);
<span class="class">insert</span> <span class="class">into</span> contacts (id, name, email) <span class="keyword">values</span> (<span class="integer">3</span>, <span class="string"><span class="delimiter">'</span><span class="content">baz</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">c@fake.com</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Constant values may also be used as parameters to a SQL batch. In this case,
the same value is bound to that parameter for every SQL statement in the batch.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (tenant_id, id, name) </span><span class="delimiter">&quot;</span></span> +
      <span class="string"><span class="delimiter">&quot;</span><span class="content">values (:tenantId, :user.id, :user.name)</span><span class="delimiter">&quot;</span></span>)
  <span class="type">void</span> bulkInsert(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tenantId</span><span class="delimiter">&quot;</span></span>) <span class="type">long</span> tenantId, <i class="conum" data-value="1"></i><b>(1)</b>
                  <span class="annotation">@BindBean</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>) User... users);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Insert each user record using the same <code>tenant_id</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<code>@SqlBatch</code> methods must have at least one iterable parameter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, a <code>@SqlBatch</code> method may return a handful of types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>void</code>: returns nothing (obviously)</p>
</li>
<li>
<p><code>int[]</code> or <code>long[]</code>: returns the update count per execution in the batch.
Depending on the database vendor and JDBC driver, this may be either the
number of rows changed by a statement, or the number matched by the query
(regardless of whether any data was changed).</p>
</li>
<li>
<p><code>boolean[]</code>: returns true if the update count is greater than zero, one value
for each execution in the batch.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="__getgeneratedkeys_2"><a class="anchor" href="#__getgeneratedkeys_2"></a>@GetGeneratedKeys</h5>
<div class="paragraph">
<p>Similar to <code>@SqlUpdate</code>, the <code>@GetGeneratedKeys</code> annotations tells SQL Object
that the return value should be the generated keys from each SQL statement,
instead of the update count. See
<a href="#__getgeneratedkeys">@GetGeneratedKeys</a> for a more thorough discussion.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (nextval('user_seq'), ?)</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@GetGeneratedKeys</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>)
  <span class="type">long</span><span class="type">[]</span> bulkInsert(<span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; names); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Returns the generated ID for each inserted name.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Multiple columns may be generated and returned in this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name, created_on) values (nextval('user_seq'), ?, now())</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@GetGeneratedKeys</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">created_on</span><span class="delimiter">&quot;</span></span>})
  <span class="annotation">@RegisterBeanMapper</span>(IdCreateTime.class)
  <span class="predefined-type">List</span>&lt;IdCreateTime&gt; bulkInsert(<span class="predefined-type">String</span>... names);
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__singlevalue_2"><a class="anchor" href="#__singlevalue_2"></a>@SingleValue</h5>
<div class="paragraph">
<p>In some cases you may want an iterable parameter to be treated as a
constant&#8212;&#8203;use the <code>@SingleValue</code> annotation on the method parameter. This causes
SQL Object to bind the whole iterable as the parameter value for every SQL
statement in the batch (typically as a SQL Array parameter).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name, roles) values (?, ?, ?)</span><span class="delimiter">&quot;</span></span>)
  <span class="type">void</span> bulkInsert(<span class="predefined-type">List</span>&lt;<span class="predefined-type">Long</span>&gt; ids,
                  <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; names,
                  <span class="annotation">@SingleValue</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; roles);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, each new row would get the same <code>varchar[]</code> value in the
<code>roles</code> column.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__sqlcall"><a class="anchor" href="#__sqlcall"></a>4.1.5. @SqlCall</h4>
<div class="paragraph">
<p>Use the <code>@SqlCall</code> annotation to call stored procedures.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountDao</span> {
  <span class="annotation">@SqlCall</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">{call suspend_account(:id)}</span><span class="delimiter">&quot;</span></span>)
  <span class="type">void</span> suspendAccount(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="type">long</span> accountId);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@SqlCall</code> methods can return <code>void</code>, or may return <code>OutParameters</code> if the
stored procedure has any output parameters. Each output parameter must be
registered with the <code>@OutParameter</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">OrderDao</span> {
  <span class="annotation">@SqlCall</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">{call prepare_order_from_cart(:cartId, :orderId, :orderTotal)}</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@OutParameter</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">orderId</span><span class="delimiter">&quot;</span></span>,    sqlType = java.sql.Types.BIGINT)
  <span class="annotation">@OutParameter</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">orderTotal</span><span class="delimiter">&quot;</span></span>, sqlType = java.sql.Types.DECIMAL)
  OutParameters prepareOrderFromCart(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">cartId</span><span class="delimiter">&quot;</span></span>) <span class="type">long</span> cartId);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Individual output parameters can be extracted from the
<a href="./apidocs/org/jdbi/v3/core/statement/OutParameters.html" target="_blank">OutParameters</a> returned from
the method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">OutParameters outParams = orderDao.prepareOrderFromCart(cartId);
<span class="type">long</span> orderId = outParams.getLong(<span class="string"><span class="delimiter">&quot;</span><span class="content">orderId</span><span class="delimiter">&quot;</span></span>);
<span class="type">double</span> orderTotal = outParams.getDouble(<span class="string"><span class="delimiter">&quot;</span><span class="content">orderTotal</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__getgeneratedkeys_3"><a class="anchor" href="#__getgeneratedkeys_3"></a>4.1.6. @GetGeneratedKeys</h4>
<div class="paragraph">
<p>The <code>@GetGeneratedKeys</code> annotation may be used on a <code>@SqlUpdate</code> or <code>@SqlBatch</code>
method to return the keys generated from the SQL statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">void</span> sqlObjectBatchKeys() {
    db.useExtension(UserDao.class, dao -&gt; {
        <span class="predefined-type">List</span>&lt;User&gt; users = dao.createUsers(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>);
        assertEquals(<span class="integer">3</span>, users.size());

        assertEquals(<span class="integer">1</span>, users.get(<span class="integer">0</span>).id);
        assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Alice</span><span class="delimiter">&quot;</span></span>, users.get(<span class="integer">0</span>).name);

        assertEquals(<span class="integer">2</span>, users.get(<span class="integer">1</span>).id);
        assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>, users.get(<span class="integer">1</span>).name);

        assertEquals(<span class="integer">3</span>, users.get(<span class="integer">2</span>).id);
        assertEquals(<span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>, users.get(<span class="integer">2</span>).name);
    });
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
    <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO users (name) VALUES(?)</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@GetGeneratedKeys</span>
    <span class="predefined-type">List</span>&lt;User&gt; createUsers(<span class="predefined-type">String</span>... names);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sqllocator"><a class="anchor" href="#_sqllocator"></a>4.1.7. SqlLocator</h4>
<div class="paragraph">
<p>When SQL statements grow in complexity, it may be cumbersome to provide
the statements as Java strings in <code>@Sql___</code> method annotations.</p>
</div>
<div class="paragraph">
<p>Jdbi provides annotations that let you configure external locations to
load SQL statements.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>@UseAnnotationSqlLocator (the default behavior; use @Sql___(&#8230;&#8203;) annotation value)</p>
</li>
<li>
<p>@UseClasspathSqlLocator - loads SQL from a file on the classpath, based on
the package and name of the SQL Object interface type.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;
<span class="annotation">@UseClasspathSqlLocator</span>
<span class="type">interface</span> <span class="class">BarDao</span> {
    <span class="comment">// loads classpath resource com/foo/BarDao/query.sql</span>
    <span class="annotation">@SqlQuery</span>
    <span class="type">void</span> query();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>@UseClasspathSqlLocator</strong> is implemented with <a href="#_classpathsqllocator">ClasspathSqlLocator</a>, as described above.</p>
</div>
<div class="paragraph">
<p>If you like StringTemplate, the <a href="#_stringtemplate_4">StringTemplate 4</a> module also provides a
SqlLocator, which can load SQL templates from StringTemplate 4 files on the
classpath.</p>
</div>
</div>
<div class="sect3">
<h4 id="__createsqlobject"><a class="anchor" href="#__createsqlobject"></a>4.1.8. @CreateSqlObject</h4>
<div class="paragraph">
<p>Use the @CreateSqlObject annotation to reuse a SqlObject inside another SqlObject. For example,
you can build a transactional method which performs an SQL update defined in other SqlObject
as part of the transaction. Jdbi won&#8217;t open a new handle for a call to the child SqlObject.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Bar</span> {

    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into bar (name) values (:name)</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@GetGeneratedKeys</span>
    <span class="type">int</span> insert(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name);
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">Foo</span> {

    <span class="annotation">@CreateSqlObject</span>
    Bar createBar();

    <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into foo (bar_id, name) values (:bar_id, :name)</span><span class="delimiter">&quot;</span></span>)
    <span class="type">void</span> insert(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">bar_id</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> barId, <span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name);

    <span class="annotation">@Transaction</span>
    <span class="keyword">default</span> <span class="type">void</span> insertBarAndFoo(<span class="predefined-type">String</span> barName, <span class="predefined-type">String</span> fooName) {
        <span class="type">int</span> barId = createBar().insert(barName);
        insert(barId, fooName);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_consumer_methods"><a class="anchor" href="#_consumer_methods"></a>4.2. Consumer Methods</h3>
<div class="paragraph">
<p>As a special case, you may provide a <code>Consumer&lt;T&gt;</code> argument in addition to other bound parameters.
The provided consumer is executed once for each row in the result set.
The static type of parameter T determines the row type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name from users</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> forEachUser(Consumer&lt;User&gt; consumer);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_default_methods"><a class="anchor" href="#_default_methods"></a>4.3. Default Methods</h3>
<div class="paragraph">
<p>Occasionally a use case comes up where SQL Method annotations don&#8217;t fit. In
these situations, you can "drop down" to the Core API using a Java 8 <code>default</code>
method.</p>
</div>
<div class="paragraph">
<p>Jdbi provides a <code>SqlObject</code> mixin interface with a single method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SqlObject</span> {
  Handle getHandle();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Make your SQL Object interface extend the <code>SqlObject</code> mixin, then provide your
own implementation in a default method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">SplineDao</span> <span class="directive">extends</span> SqlObject {
  <span class="keyword">default</span> <span class="type">void</span> reticulateSplines(Spline spline) {
    Handle handle = getHandle();
    <span class="comment">// do tricky stuff using the Core API.</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Default methods can also be used to group multiple SQL operations into a single
method call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ContactPhoneDao</span> {
  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (nextval('contact_id'), :name)</span><span class="delimiter">&quot;</span></span>)
  <span class="type">long</span> insertContact(<span class="annotation">@BindBean</span> Contact contact);

  <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into phones (contact_id, type, phone) values (:contactId, :type, :phone)</span><span class="delimiter">&quot;</span></span>)
  <span class="type">void</span> insertPhone(<span class="type">long</span> contactId, <span class="annotation">@BindBean</span> <span class="predefined-type">Iterable</span>&lt;Phone&gt; phones);

  <span class="keyword">default</span> <span class="type">long</span> insertFullContact(Contact contact) {
    <span class="type">long</span> id = insertContact(contact);
    insertPhone(id, contact.getPhones());
    <span class="keyword">return</span> id;
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_transaction_management"><a class="anchor" href="#_transaction_management"></a>4.4. Transaction Management</h3>
<div class="paragraph">
<p>You may declare transactions with SqlObject annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Test</span>
<span class="directive">public</span> <span class="type">void</span> sqlObjectTransaction() {
    assertThat(handle.attach(UserDao.class).findUserById(<span class="integer">3</span>).map(u -&gt; u.name)).contains(<span class="string"><span class="delimiter">&quot;</span><span class="content">Charlie</span><span class="delimiter">&quot;</span></span>);
}

<span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT * FROM users WHERE id=:id</span><span class="delimiter">&quot;</span></span>)
    <span class="annotation">@Transaction</span>
    Optional&lt;User&gt; findUserById(<span class="type">int</span> id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>SQL methods with a <code>@Transaction</code> annotation may optionally specify a
transaction isolation level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">INSERT INTO USERS (name) VALUES (:name)</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@Transaction</span>(TransactionIsolationLevel.READ_COMMITTED)
<span class="type">void</span> insertUser(<span class="predefined-type">String</span> name);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a <code>@Transaction</code> method calls another <code>@Transaction</code> method, they must
specify the same isolation level, or the inner method must not specify
anything, in which case the isolation level of the outer method is used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Transaction</span>(TransactionIsolationLevel.READ_UNCOMMITTED)
<span class="keyword">default</span> <span class="type">void</span> outerMethodCallsInnerWithSameLevel() {
    <span class="comment">// this works: isolation levels agree</span>
    innerMethodSameLevel();
}

<span class="annotation">@Transaction</span>(TransactionIsolationLevel.READ_UNCOMMITTED)
<span class="keyword">default</span> <span class="type">void</span> innerMethodSameLevel() {}

<span class="annotation">@Transaction</span>(TransactionIsolationLevel.READ_COMMITTED)
<span class="keyword">default</span> <span class="type">void</span> outerMethodWithLevelCallsInnerMethodWithNoLevel() {
    <span class="comment">// this also works: inner method doesn't specify a level, so the outer method controls.</span>
    innerMethodWithNoLevel();
}

<span class="annotation">@Transaction</span>
<span class="keyword">default</span> <span class="type">void</span> innerMethodWithNoLevel() {}

<span class="annotation">@Transaction</span>(TransactionIsolationLevel.REPEATABLE_READ)
<span class="keyword">default</span> <span class="type">void</span> outerMethodWithOneLevelCallsInnerMethodWithAnotherLevel() <span class="directive">throws</span> TransactionException {
    <span class="comment">// error! inner method specifies a different isolation level.</span>
    innerMethodWithADifferentLevel();
}

<span class="annotation">@Transaction</span>(TransactionIsolationLevel.SERIALIZABLE)
<span class="keyword">default</span> <span class="type">void</span> innerMethodWithADifferentLevel() {}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_sql_objects"><a class="anchor" href="#_using_sql_objects"></a>4.5. Using SQL Objects</h3>
<div class="paragraph">
<p>Once you&#8217;ve defined your interface, there are a few ways to get an instance of
it:</p>
</div>
<div class="sect3">
<h4 id="_attached_to_handle"><a class="anchor" href="#_attached_to_handle"></a>4.5.1. Attached to Handle</h4>
<div class="paragraph">
<p>You can get a SQL Object that is attached to an open handle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">try</span> (Handle handle = jdbi.open()) {
  ContactPhoneDao dao = handle.attach(ContactPhoneDao.class);
  dao.insertFullContact(contact);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Attached SQL Objects have the same lifecycle as the handle&#8212;&#8203;when the handle is
closed, the SQL Object becomes unusable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_temporary_sql_objects"><a class="anchor" href="#_temporary_sql_objects"></a>4.5.2. Temporary SQL Objects</h4>
<div class="paragraph">
<p>You can also get a temporary SQL Object from the Jdbi object, by passing it a
callback (typically a lambda). Use
<a href="./apidocs/org/jdbi/v3/core/Jdbi.html#withExtension-java.lang.Class-org.jdbi.v3.core.extension.ExtensionCallback-" target="_blank">Jdbi.withExtension</a>
for operations that return a result, or
<a href="./apidocs/org/jdbi/v3/core/Jdbi.html#useExtension-java.lang.Class-org.jdbi.v3.core.extension.ExtensionConsumer-" target="_blank">useExtension</a>
for operations with no result.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.useExtension(ContactPhoneDao.class, dao -&gt; dao.insertFullContact(alice));
<span class="type">long</span> bobId = jdbi.withExtension(ContactPhoneDao.class, dao -&gt; dao.insertFullContact(bob));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Temporary SQL Objects are only valid inside the callback you pass to the
method. The SQL Object (and the associated temporary handle) are closed when
the callback returns.</p>
</div>
</div>
<div class="sect3">
<h4 id="_on_demand"><a class="anchor" href="#_on_demand"></a>4.5.3. On-Demand</h4>
<div class="paragraph">
<p>On-demand instances have an open-ended lifecycle, as they obtain and release a
connection for each method call. They are thread-safe, and may be reused
across an application. This is handy when you only need to make single calls at
a time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ContactPhoneDao dao = jdbi.onDemand(ContactPhoneDao.class);
<span class="type">long</span> aliceId = dao.insertFullContact(alice);
<span class="type">long</span> bobId = dao.insertFullContact(bob);</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
There is a performance penalty every time a connection is allocated and
released. If you need to make successive calls to a SQL Object, consider using
one of the above options for better performance, instead of on-demand.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_additional_annotations"><a class="anchor" href="#_additional_annotations"></a>4.6. Additional Annotations</h3>
<div class="paragraph">
<p>Jdbi provides dozens of annotations out of the box:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./apidocs/org/jdbi/v3/sqlobject/config/package-summary.html" target="_blank">org.jdbi.v3.sqlobject.config</a>
provides annotations for things that can be configured at the <code>Jdbi</code> or
<code>Handle</code> level. This includes registration of mappers and arguments, and for
configuring SQL statement rendering and parsing.</p>
</li>
<li>
<p><a href="./apidocs/org/jdbi/v3/sqlobject/customizer/package-summary.html" target="_blank">org.jdbi.v3.sqlobject.customizer</a>
provides annotations for binding parameters, defining attributes, and
controlling the fetch behavior of the statement&#8217;s result set.</p>
</li>
<li>
<p><a href="./apidocs/org/jdbi/v3/jpa/package-summary.html" target="_blank">org.jdbi.v3.jpa</a>
provides the <code>@BindJpa</code> annotation, for binding properties to column according
to JPA <code>@Column</code> annotations.</p>
</li>
<li>
<p><a href="./apidocs/org/jdbi/v3/sqlobject/locator/package-summary.html" target="_blank">org.jdbi.v3.sqlobject.locator</a>
provides annotations that configure Jdbi to load SQL statements from an
alternative source, e.g. a file on the classpath.</p>
</li>
<li>
<p><a href="./apidocs/org/jdbi/v3/sqlobject/statement/package-summary.html" target="_blank">org.jdbi.v3.sqlobject.statement</a>
provides the <code>@MapTo</code> annotation, which is used for dynamically specifying the
mapped type at the time the method is invoked.</p>
</li>
<li>
<p><a href="./apidocs/org/jdbi/v3/stringtemplate4/package-summary.html" target="_blank">org.jdbi.v3.stringtemplate4</a>
provides annotations that configure Jdbi to load SQL from StringTemplate 4
<code>.stg</code> files on the classpath, and/or to parse SQL templates using the
ST4 template engine.</p>
</li>
<li>
<p><a href="./apidocs/org/jdbi/v3/sqlobject/transaction/package-summary.html" target="_blank">org.jdbi.v3.sqlobject.transaction</a>
provides annotations for transaction management in a SQL object. See
<a href="#_transaction_management">Transaction Management</a> for details.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Jdbi is designed to support user-defined annotations. See
<a href="#_user_defined_annotations">User-Defined Annotations</a> for a guide to creating your own.</p>
</div>
</div>
<div class="sect2">
<h3 id="_annotations_and_inheritance"><a class="anchor" href="#_annotations_and_inheritance"></a>4.7. Annotations and Inheritance</h3>
<div class="paragraph">
<p>SQL Objects inherit methods and annotations from the interfaces they extend:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.app.dao</span>;

<span class="annotation">@UseClasspathSqlLocator</span>  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">CrudDao</span>&lt;T, ID&gt; {
  <span class="annotation">@SqlUpdate</span> <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="type">void</span> insert(<span class="annotation">@BindBean</span> T entity);

  <span class="annotation">@SqlQuery</span> <i class="conum" data-value="3"></i><b>(3)</b>
  Optional&lt;T&gt; findById(ID id);

  <span class="annotation">@SqlQuery</span>
  <span class="predefined-type">List</span>&lt;T&gt; list();

  <span class="annotation">@SqlUpdate</span>
  <span class="type">void</span> update(<span class="annotation">@BindBean</span> T entity);

  <span class="annotation">@SqlUpdate</span>
  <span class="type">void</span> deleteById(ID id);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>See <a href="#_sqllocator">SqlLocator</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Class annotations are inherited by subtypes.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Method and parameter annotations are inherited by subtypes, unless the
subtype overrides the method.</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.app.contact</span>;

<span class="annotation">@RegisterBeanMapper</span>(Contact.class)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">ContactDao</span> <span class="directive">extends</span> CrudDao&lt;Contact, <span class="predefined-type">Long</span>&gt; {}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.app.account</span>;

<span class="annotation">@RegisterConstructorMapper</span>(Account.class)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountDao</span> <span class="directive">extends</span> CrudDao&lt;Account, <span class="predefined-type">UUID</span>&gt; {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example we&#8217;re using the <code>@UseClasspathSqlLocator</code> annotation, so each
method will use SQL loaded from the classpath. Thus, <code>ContactDao</code> methods will
use SQL from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/com/app/contact/ContactDao/insert.sql</code></p>
</li>
<li>
<p><code>/com/app/contact/ContactDao/findById.sql</code></p>
</li>
<li>
<p><code>/com/app/contact/ContactDao/list.sql</code></p>
</li>
<li>
<p><code>/com/app/contact/ContactDao/update.sql</code></p>
</li>
<li>
<p><code>/com/app/contact/ContactDao/deleteById.sql</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Whereas <code>AccountDao</code> will use SQL from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/com/app/account/AccountDao/insert.sql</code></p>
</li>
<li>
<p><code>/com/app/account/AccountDao/findById.sql</code></p>
</li>
<li>
<p><code>/com/app/account/AccountDao/list.sql</code></p>
</li>
<li>
<p><code>/com/app/account/AccountDao/update.sql</code></p>
</li>
<li>
<p><code>/com/app/account/AccountDao/deleteById.sql</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Suppose <code>Account</code> used <code>name()</code>-style accessors instead of <code>getName()</code>. In that
case, we&#8217;d want <code>AccountDao</code> to use <code>@BindMethods</code> instead of <code>@BindBean</code>.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s override those methods with the right annotations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.app.account</span>;

<span class="annotation">@RegisterConstructorMapper</span>(Account.class)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountDao</span> <span class="directive">extends</span> CrudDao&lt;Account, <span class="predefined-type">UUID</span>&gt; {
  <span class="annotation">@Override</span>
  <span class="annotation">@SqlUpdate</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="type">void</span> insert(<span class="annotation">@BindMethods</span> Account entity);

  <span class="annotation">@Override</span>
  <span class="annotation">@SqlUpdate</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="type">void</span> update(<span class="annotation">@BindMethods</span> Account entity);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method annotations are not inherited on override, so we must duplicate
those we want to keep.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_third_party_integration"><a class="anchor" href="#_third_party_integration"></a>5. Third-Party Integration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_google_guava"><a class="anchor" href="#_google_guava"></a>5.1. Google Guava</h3>
<div class="paragraph">
<p>This plugin adds support for the following types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Optional&lt;T&gt;</code> - registers an argument and mapper. Supports <code>Optional</code> for any
wrapped type <code>T</code> for which a mapper / argument factory is registered.</p>
</li>
<li>
<p>Most Guava collection and map types - see
<a href="./apidocs/org/jdbi/v3/guava/GuavaCollectors.html" target="_blank">GuavaCollectors</a> for a complete
list of supported types.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use this plugin, add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-guava<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the plugin into your <code>Jdbi</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.installPlugin(<span class="keyword">new</span> GuavaPlugin());</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the plugin installed, any supported Guava collection type can
be returned from a SQL object method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from users order by name</span><span class="delimiter">&quot;</span></span>)
    ImmutableList&lt;User&gt; list();

    <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from users where id = :id</span><span class="delimiter">&quot;</span></span>)
    com.google.common.base.Optional&lt;User&gt; getById(<span class="type">long</span> id);
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_h2_database"><a class="anchor" href="#_h2_database"></a>5.2. H2 Database</h3>
<div class="paragraph">
<p>This plugin configures Jdbi to correctly handle <code>integer[]</code> and <code>uuid[]</code> data
types in an H2 database.</p>
</div>
<div class="paragraph">
<p>This plugin is included with the core jar (but may be extracted to separate
artifact in the future). Use it by installing the plugin into your <code>Jdbi</code>
instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.installPlugin(<span class="keyword">new</span> H2DatabasePlugin());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jodatime"><a class="anchor" href="#_jodatime"></a>5.3. JodaTime</h3>
<div class="paragraph">
<p>This plugin adds support for using joda-time&#8217;s <code>DateTime</code> type.</p>
</div>
<div class="paragraph">
<p>To use this plugin, add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-jodatime2<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the plugin into your <code>Jdbi</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.installPlugin(<span class="keyword">new</span> JodaTimePlugin());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jpa"><a class="anchor" href="#_jpa"></a>5.4. JPA</h3>
<div class="paragraph">
<p>Using the JPA plugin is a great way to trick your boss into letting you try
Jdbi. "No problem boss, it already supports JPA annotations, easy peasy!"</p>
</div>
<div class="paragraph">
<p>This plugin adds mapping support for a small subset of JPA entity annotations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Entity</p>
</li>
<li>
<p>MappedSuperclass</p>
</li>
<li>
<p>Column</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use this plugin, add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-jpa<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the plugin into your <code>Jdbi</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.installPlugin(<span class="keyword">new</span> JpaPlugin());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Honestly though.. just tear off the bandage and switch to Jdbi proper.</p>
</div>
</div>
<div class="sect2">
<h3 id="_kotlin"><a class="anchor" href="#_kotlin"></a>5.5. Kotlin</h3>
<div class="paragraph">
<p><a href="http://kotlinlang.org/" target="_blank">Kotlin</a> support is provided by <strong>jdbi3-kotlin</strong> and
<strong>jdbi3-kotlin-sqlobject</strong> modules.</p>
</div>
<div class="paragraph">
<p>Kotlin API documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="apidocs-kotlin/jdbi3-kotlin/index.html" target="_blank">jdbi3-kotlin</a></p>
</li>
<li>
<p><a href="apidocs-kotlin/jdbi3-kotlin-sqlobject/index.html" target="_blank">jdbi3-kotlin-sqlobject</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_resultset_mapping"><a class="anchor" href="#_resultset_mapping"></a>5.5.1. ResultSet mapping</h4>
<div class="paragraph">
<p>The <strong>jdbi3-kotlin</strong> plugin adds mapping to Kotlin data classes. It
supports data classes where all fields are present in the constructor as well
as classes with writable properties. Any fields not present in the constructor
will be set after the constructor call. The mapper supports nullable types. It
also uses default parameter values in the constructor if the parameter type is
not nullable and the value absent in the result set.</p>
</div>
<div class="paragraph">
<p>To use this plugin, add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-kotlin<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the plugin into your <code>Jdbi</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">jdbi.installPlugin(KotlinPlugin());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Kotlin mapper also supports <code>@ColumnName</code> annotation that allows to specify
name for a property or parameter explicitly, as well as the <code>@Nested</code> annotation
that allows mapping nested Kotlin objects.</p>
</div>
<div class="paragraph">
<p>If you load all Jdbi plugins via <code>Jdbi.installPlugins()</code> this plugin will be
discovered and registered automatically. Otherwise, you can attach it using
<code>Jdbi.installPlugin(KotlinPlugin())</code>.</p>
</div>
<div class="paragraph">
<p>An example from the test class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">data class IdAndName(val id: Int, val name: String)
data class Thing(@Nested val idAndName: IdAndName,
                 val nullable: String?,
                 val nullableDefaultedNull: String? = null,
                 val nullableDefaultedNotNull: String? = &quot;not null&quot;,
                 val defaulted: String = &quot;default value&quot;)
@Test fun testFindById() {
    val qry = db.sharedHandle.createQuery(&quot;select id, name from something where id = :id&quot;)
    val things: List&lt;Thing&gt; = qry.bind(&quot;id&quot;, brian.idAndName.id).mapTo&lt;Thing&gt;().list()
    assertEquals(1, things.size)
    assertEquals(brian, things[0])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two extensions to help:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>&lt;reified T : Any&gt;ResultBearing.mapTo()</code></p>
</li>
<li>
<p><code>&lt;T : Any&gt;ResultIterable&lt;T&gt;.useSequence(block: (Sequence&lt;T&gt;) &#8594; Unit)</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Allowing code like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">val qry = handle.createQuery(&quot;select id, name from something where id = :id&quot;)
val things = qry.bind(&quot;id&quot;, brian.id).mapTo&lt;Thing&gt;.list()</code></pre>
</div>
</div>
<div class="paragraph">
<p>and for using a Sequence that is auto closed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">qryAll.mapTo&lt;Thing&gt;.useSequence {
    it.forEach(::println)
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sqlobject"><a class="anchor" href="#_sqlobject"></a>5.5.2. SqlObject</h4>
<div class="paragraph">
<p>The <strong>jdbi3-kotlin-sqlobject</strong> plugin adds automatic parameter binding by name
for Kotlin methods in SqlObjects as well as support for Kotlin default methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-kotlin-sqlobject<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the plugin into your <code>Jdbi</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">jdbi.installPlugin(KotlinSqlObjectPlugin());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Parameter binding supports individual primitive types as well as Kotlin or
JavaBean style objects as a parameter (referenced in binding as
<code>:paramName.propertyName</code>). No annotations are needed.</p>
</div>
<div class="paragraph">
<p>If you load all Jdbi plugins via <code>Jdbi.installPlugins()</code> this plugin will be
discovered and registered automatically. Otherwise, you can attach the plugin
via: <code>Jdbi.installPlugin(KotlinSqlObjectPlugin())</code>.</p>
</div>
<div class="paragraph">
<p>An example from the test class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">interface ThingDao {
    @SqlUpdate(&quot;insert into something (id, name) values (:something.idAndName.id, :something.idAndName.name)&quot;)
    fun insert(something: Thing)

    @SqlQuery(&quot;select id, name from something&quot;)
    fun list(): List&lt;Thing&gt;
}
@Before fun setUp() {
    val dao = db.jdbi.onDemand&lt;ThingDao&gt;()

    val brian = Thing(IdAndName(1, &quot;Brian&quot;), null)
    val keith = Thing(IdAndName(2, &quot;Keith&quot;), null)

    dao.insert(brian)
    dao.insert(keith)
}
@Test fun testDao() {
    val dao = db.jdbi.onDemand&lt;ThingDao&gt;()

    val rs = dao.list()

    assertEquals(2, rs.size.toLong())
    assertEquals(brian, rs[0])
    assertEquals(keith, rs[1])

}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_oracle_12"><a class="anchor" href="#_oracle_12"></a>5.6. Oracle 12</h3>
<div class="paragraph">
<p>This module adds support for Oracle <code>RETURNING</code> DML expressions.</p>
</div>
<div class="paragraph">
<p>To use this feature, add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-oracle12<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, use the <code>OracleReturning</code> class with an <code>Update</code> or <code>PreparedBatch</code>
to get the returned DML.</p>
</div>
</div>
<div class="sect2">
<h3 id="_postgresql"><a class="anchor" href="#_postgresql"></a>5.7. PostgreSQL</h3>
<div class="paragraph">
<p>The <strong>jdbi3-postgres</strong> plugin provides enhanced integration with the
<a href="https://jdbc.postgresql.org/" target="_blank">PostgreSQL JDBC Driver</a>.</p>
</div>
<div class="paragraph">
<p>To use this feature, add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-postgres<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the plugin into your <code>Jdbi</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Jdbi jdbi = Jdbi.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:postgresql://host:port/database</span><span class="delimiter">&quot;</span></span>)
                .installPlugin(<span class="keyword">new</span> PostgresPlugin());</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin configures mappings for the Java 8 <strong>java.time</strong> types like
<strong>Instant</strong> or <strong>Duration</strong>, <strong>InetAddress</strong>, <strong>UUID</strong>, typed enums, and <strong>hstore</strong>.</p>
</div>
<div class="paragraph">
<p>It also configures SQL array type support for <code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>,
<code>String</code>, and <code>UUID</code>.</p>
</div>
<div class="paragraph">
<p>See the <a href="./apidocs/org/jdbi/v3/postgres/package-summary.html" target="_blank">javadoc</a> for an
exhaustive list.</p>
</div>
<div class="sect3">
<h4 id="_hstore"><a class="anchor" href="#_hstore"></a>5.7.1. hstore</h4>
<div class="paragraph">
<p>The Postgres plugin provides an <code>hstore</code> to <code>Map&lt;String, String&gt;</code> column mapper:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; accountAttributes = handle
    .select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select attributes from account where id = ?</span><span class="delimiter">&quot;</span></span>, userId)
    .mapTo(<span class="keyword">new</span> GenericType&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;&gt;() {})
    .findOnly();</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, SQL Object treats <code>Map</code> return types as a collection of <code>Map.Entry</code>
values. Use the <code>@SingleValue</code> annotation to override this, so that the return
type is treated as a single value instead of a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select attributes from account where id = ?</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@SingleValue</span>
  <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; getAccountAttributes(<span class="type">long</span> accountId);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__getgeneratedkeys_4"><a class="anchor" href="#__getgeneratedkeys_4"></a>5.7.2. @GetGeneratedKeys</h4>
<div class="paragraph">
<p>In Postgres, <code>@GetGeneratedKeys</code> can return the entire modified row if you
request generated keys without naming any columns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name, created_on) values (nextval('user_seq'), ?, now())</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@GetGeneratedKeys</span>
  <span class="annotation">@RegisterBeanMapper</span>(User.class)
  User insert(<span class="predefined-type">String</span> name);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a database operation modifies multiple rows (e.g. an update that will modify
several rows), your method can return all the modified rows in a collection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">UserDao</span> {
  <span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">update users set active = false where id = any(?)</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@GetGeneratedKeys</span>
  <span class="annotation">@RegisterBeanMapper</span>(User.class)
  <span class="predefined-type">List</span>&lt;User&gt; deactivateUsers(<span class="type">long</span>... userIds);
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spring"><a class="anchor" href="#_spring"></a>5.8. Spring</h3>
<div class="paragraph">
<p>This module provides <code>JdbiFactoryBean</code>, a factory bean which sets up a <code>Jdbi</code>
singleton.</p>
</div>
<div class="paragraph">
<p>To use this module, add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-spring4<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then configure the Jdbi factory bean in your Spring container, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:aop</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/aop</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:tx</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/tx</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span>
       <span class="content">http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd</span>
       <span class="content">http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd</span>
       <span class="content">http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.0.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

  <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">db</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.datasource.DriverManagerDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:testing</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>

  <i class="conum" data-value="2"></i><b>(2)</b>
  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.datasource.DataSourceTransactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">db</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>
  <span class="tag">&lt;tx:annotation-driven</span> <span class="attribute-name">transaction-manager</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>

  <i class="conum" data-value="3"></i><b>(3)</b>
  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbi</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jdbi.v3.spring4.JdbiFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">db</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>

  <i class="conum" data-value="4"></i><b>(4)</b>
  <span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">service</span><span class="delimiter">&quot;</span></span>
    <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.example.service.MyService</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbi</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;/beans&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The SQL data source that Jdbi will connect to. In this example we use an H2
database, but it can be any JDBC-compatible database.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Enable configuration of transactions via annotations.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Configure <code>JdbiFactoryBean</code> using the data source configured earlier.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Inject <code>Jdbi</code> into a service class. Alternatively, use standard JSR-330
<code>@Inject</code> annotations on the target class instead of configuring it in
your <code>beans.xml</code>.</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_installing_plugins"><a class="anchor" href="#_installing_plugins"></a>5.8.1. Installing plugins</h4>
<div class="paragraph">
<p>Plugins may be automatically installed by scanning the classpath for
<a href="https://docs.oracle.com/javase/8/docs/api/java/util/ServiceLoader.html" target="_blank">ServiceLoader</a> manifests.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbi</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jdbi.v3.spring4.JdbiFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autoInstallPlugins</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Plugins may also be installed explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbi</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jdbi.v3.spring4.JdbiFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plugins</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;list&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jdbi.v3.sqlobject.SqlObjectPlugin</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jdbi.v3.guava.GuavaPlugin</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Not all plugins are automatically installable. In these situations, you can
auto-install some plugins and manually install the rest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbi</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jdbi.v3.spring4.JdbiFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  ...
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">autoInstallPlugins</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">plugins</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;list&gt;</span>
      <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jdbi.v3.core.h2.H2DatabasePlugin</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/list&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_global_attributes"><a class="anchor" href="#_global_attributes"></a>5.8.2. Global Attributes</h4>
<div class="paragraph">
<p>Global defined attributes may be configured on the factory bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbi</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jdbi.v3.spring4.JdbiFactoryBean</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">db</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">globalDefines</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;map&gt;</span>
      <span class="tag">&lt;entry</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/map&gt;</span>
  <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sqlite"><a class="anchor" href="#_sqlite"></a>5.9. SQLite</h3>
<div class="paragraph">
<p>The <strong>jdbi3-sqlite</strong> plugin provides support for using the
<a href="https://bitbucket.org/xerial/sqlite-jdbc/" target="_blank">SQLite JDBC Driver</a>
with Jdbi.</p>
</div>
<div class="paragraph">
<p>The plugin configures mapping for the Java <strong>URL</strong> type which is not
supported by driver.</p>
</div>
<div class="paragraph">
<p>To use this plugin, first add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-sqlite<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then install the plugin into your <code>Jdbi</code> instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Jdbi jdbi = Jdbi.create(<span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:sqlite:database</span><span class="delimiter">&quot;</span></span>)
                .installPlugin(<span class="keyword">new</span> SQLitePlugin());</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stringtemplate_4"><a class="anchor" href="#_stringtemplate_4"></a>5.10. StringTemplate 4</h3>
<div class="paragraph">
<p>This module allows you to plug in the StringTemplate 4 templating engine, in
place of the standard Jdbi templating engine.</p>
</div>
<div class="paragraph">
<p>To use module plugin, add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-stringtemplate4<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To use StringTemplate format in SQL statements, set the template engine
to <code>StringTemplateEngine</code>.</p>
</div>
<div class="paragraph">
<p>Defined attributes are provided to the StringTemplate engine to render the SQL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> sortColumn = <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name </span><span class="delimiter">&quot;</span></span> +
             <span class="string"><span class="delimiter">&quot;</span><span class="content">from account </span><span class="delimiter">&quot;</span></span> +
             <span class="string"><span class="delimiter">&quot;</span><span class="content">order by &lt;if(sort)&gt; &lt;sortBy&gt;, &lt;endif&gt; id</span><span class="delimiter">&quot;</span></span>;

<span class="predefined-type">List</span>&lt;Account&gt; accounts = handle.createQuery(sql)
      .setTemplateEngine(<span class="keyword">new</span> StringTemplateEngine())
      .define(<span class="string"><span class="delimiter">&quot;</span><span class="content">sort</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>)
      .define(<span class="string"><span class="delimiter">&quot;</span><span class="content">sortBy</span><span class="delimiter">&quot;</span></span>, sortColumn)
      .mapTo(Account.class)
      .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, SQL templates can be loaded from StringTemplate group files on
the classpath:</p>
</div>
<div class="listingblock">
<div class="title">com/foo/AccountDao.sql.stg</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="stringtemplate">group AccountDao;

selectAll(sort,sortBy) ::= &lt;&lt;
  select id, name
  from account
  order by &lt;if(sort)&gt; &lt;sortBy&gt;, &lt;endif&gt; id
&gt;&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ST template = StringTemplateSqlLocator.findStringTemplate(
                  <span class="string"><span class="delimiter">&quot;</span><span class="content">com/foo/AccountDao.sql.stg</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">selectAll</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">String</span> sql = template.add(<span class="string"><span class="delimiter">&quot;</span><span class="content">sort</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>)
                     .add(<span class="string"><span class="delimiter">&quot;</span><span class="content">sortBy</span><span class="delimiter">&quot;</span></span>, sortColumn)
                     .render();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In SQL Objects, the <code>@UseStringTemplateEngine</code> annotation sets the
statement locator, similar to first example above.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select id, name </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">from account </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">order by &lt;if(sort)&gt; &lt;sortBy&gt;, &lt;endif&gt; id</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@UseStringTemplateEngine</span>
  <span class="predefined-type">List</span>&lt;Account&gt; selectAll(<span class="annotation">@Define</span> <span class="type">boolean</span> sort,
                          <span class="annotation">@Define</span> <span class="predefined-type">String</span> sortBy);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, the <code>@UseStringTemplateSqlLocator</code> annotation sets the statement
locator, and loads SQL from a StringTemplate group file on the classpath:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountDao</span> {
  <span class="annotation">@SqlQuery</span>
  <span class="annotation">@UseStringTemplateSqlLocator</span>
  <span class="predefined-type">List</span>&lt;Account&gt; selectAll(<span class="annotation">@Define</span> <span class="type">boolean</span> sort,
                          <span class="annotation">@Define</span> <span class="predefined-type">String</span> sortBy);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, since the fully qualified class name is <code>com.foo.AccountDao</code>,
SQL will be loaded from the file <code>com/foo/AccountDao.sql.stg</code> on the
classpath.</p>
</div>
<div class="paragraph">
<p>By default, the template in the group with the same name as the method will be
used. This can be overridden on the <code>@Sql___</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">com.foo</span>;

<span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">listSorted</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@UseStringTemplateSqlLocator</span>
  <span class="predefined-type">List</span>&lt;Account&gt; selectAll(<span class="annotation">@Define</span> <span class="type">boolean</span> sort,
                          <span class="annotation">@Define</span> <span class="predefined-type">String</span> sortBy);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the SQL template will still be loaded from the file
<code>com/foo/AccountDao.sql.stg</code> on the classpath, however the <code>listSorted</code>
template will be used, regardless of the method name.</p>
</div>
</div>
<div class="sect2">
<h3 id="_vavr"><a class="anchor" href="#_vavr"></a>5.11. Vavr</h3>
<div class="paragraph">
<p>The Vavr Plugin offers deep integration of <strong>Jdbi</strong> with the Vavr functional library:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Supports argument resolution of sever Vavr Value types such as
<code>Option&lt;T&gt;</code>, <code>Either&lt;L, T&gt;</code>, <code>Lazy&lt;T&gt;</code>, <code>Try&lt;T&gt;</code> and <code>Validation&lt;T&gt;</code>.
Given that for the wrapped type <code>T</code> a Mapper is registered.</p>
</li>
<li>
<p>Return Vavr collection types from queries. Supported are <code>Seq&lt;T&gt;</code>, <code>Set&lt;T&gt;</code>
and <code>Map&lt;T&gt;</code> as well as all subtypes thereof.
It is possible to collect into a <code>Traversable&lt;T&gt;</code>, in this case a <code>List&lt;T&gt;</code>
will be used as default implementation.
For interface types a sensible default implementation will be used
(e.q. <code>List&lt;T&gt;</code> for <code>Seq&lt;T&gt;</code>).</p>
</li>
<li>
<p>Columns can be mapped into Vavr&#8217;s <code>Option&lt;T&gt;</code> type.</p>
</li>
<li>
<p>Tuple projections for <strong>Jdbi</strong>! Yey! Vavr offers Tuples up to a maximum arity of 8.
you can map your query results e.g. to <code>Tuple3&lt;Integer, String, Long&gt;</code>.
If you select more columns than the arity of the projection the columns
up to that index will be used.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To use the plugin, add a Maven dependency:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.jdbi<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>jdbi3-vavr<span class="tag">&lt;/artifactId&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Currently Vavr &gt;= 0.9.0 is supported and tested. The plugin pulls a supported version of
Vavr and is ready to be used. As with other plugins: install via <code>Jdbi</code> instance or
use auto install.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">jdbi.installPlugin(<span class="keyword">new</span> VavrPlugin());</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here are some usage examples of the features listed above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> query = <span class="string"><span class="delimiter">&quot;</span><span class="content">select * from users where :name is null or name = :name</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Option</span>&lt;<span class="predefined-type">String</span>&gt; param = <span class="predefined-type">Option</span>.of(<span class="string"><span class="delimiter">&quot;</span><span class="content">eric</span><span class="delimiter">&quot;</span></span>);

<span class="comment">// will fetch first user with given name or first user without name (Option.none)</span>
<span class="keyword">return</span> handle.createQuery(query)
        .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, param)
        .mapToBean(User.class)
        .findFirst();</code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>param</code> may be one of <code>Option&lt;T&gt;</code>, <code>Either&lt;L, T&gt;</code>, <code>Lazy&lt;T&gt;</code>, <code>Try&lt;T&gt;</code>
or <code>Validation&lt;T&gt;</code>. Note that in the case of these types, the nested value must
be 'present' otherwise a <code>null</code> value is used (e.g. for <code>Either.Left</code> or
<code>Validation.Invalid</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select name from users</span><span class="delimiter">&quot;</span></span>)
        .collectInto(<span class="keyword">new</span> GenericType&lt;Seq&lt;<span class="predefined-type">String</span>&gt;&gt;() {});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This works for all the collection types supported. For the nested value
row and column mappers already installed in <strong>Jdbi</strong> will be used.
Therefore the following would work and can make sense if the column is nullable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select middle_name from users</span><span class="delimiter">&quot;</span></span>) <span class="comment">// nulls incoming!</span>
        .collectInto(<span class="keyword">new</span> GenericType&lt;Seq&lt;<span class="predefined-type">Option</span>&lt;<span class="predefined-type">String</span>&gt;&gt;&gt;() {});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The plugin will obey configured key and value columns for <code>Map&lt;K, V&gt;</code> return types.</p>
</div>
<div class="paragraph">
<p>Last but not least we can now project simple queries to Vavr tuples like that:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// given a 'tuples' table with t1 int, t2 varchar, t3 varchar, ...</span>
<span class="predefined-type">List</span>&lt;Tuple3&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;&gt; tupleProjection = handle
        .createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select t1, t2, t3 from tuples</span><span class="delimiter">&quot;</span></span>)
        .mapTo(<span class="keyword">new</span> GenericType&lt;Tuple3&lt;<span class="predefined-type">Integer</span>, <span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt;&gt;() {})
        .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also project complex types into a tuple as long as a row mapper is
registered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// given that there are row mappers registered for both complex types</span>
Tuple2&lt;City, Address&gt; tupleProjection = handle
        .createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select cityname, zipcode, street, housenumber from </span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content">addresses where user_id = 1</span><span class="delimiter">&quot;</span></span>)
        .mapTo(<span class="keyword">new</span> GenericType&lt;Tuple2&lt;City, Address&gt;&gt;() {})
        .findOnly();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to mix complex types and simple ones we also got you covered.
Using the <code>TupleMappers</code> class you can configure your projections.(In fact,
you have to - read below!)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.configure(TupleMappers.class, c -&gt;
        c.setColumn(<span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">street</span><span class="delimiter">&quot;</span></span>).setColumn(<span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">housenumber</span><span class="delimiter">&quot;</span></span>));

Tuple3&lt;City, <span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt; result = handle
        .createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select cityname, zipcode, street, housenumber from </span><span class="delimiter">&quot;</span></span> +
             <span class="string"><span class="delimiter">&quot;</span><span class="content">addresses where user_id = 1</span><span class="delimiter">&quot;</span></span>)
        .mapTo(<span class="keyword">new</span> GenericType&lt;Tuple3&lt;City, <span class="predefined-type">String</span>, <span class="predefined-type">Integer</span>&gt;&gt;() {})
        .findOnly();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bear in mind:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The configuration of the columns is 1-based, since they reflect
the tuples' values (which you would query by e.g. <code>._1</code>).</p>
</li>
<li>
<p>Tuples are always mapped fully column-wise or fully via row mappers.
If you want to mix row-mapped types and single-column mappings the
<code>TupleMappers</code> must be configured properly i.e. all non row-mapped
tuple indices must be provided with a column configuration!</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_advanced_topics"><a class="anchor" href="#_advanced_topics"></a>6. Advanced Topics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_compiling_with_parameter_names"><a class="anchor" href="#_compiling_with_parameter_names"></a>6.1. Compiling with Parameter Names</h3>
<div class="paragraph">
<p>By default, the Java compiler does not write parameter names of constructors and
methods to class files. At runtime, reflectively asking for parameter names
gives values like "arg0", "arg1", etc.</p>
</div>
<div class="paragraph">
<p>Out of the box, Jdbi uses annotations to know what each parameter is called,
e.g.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ConstructorMapper</code> uses the <code>@ConstructorProperties</code> annotation.</p>
</li>
<li>
<p>SQL Object method arguments use the <code>@Bind</code> annotation.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> insert(<span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>) <span class="type">long</span> id, <span class="annotation">@Bind</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> name); <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Such verbose, very boilerplate. Wow.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you compile your code with the <code>-parameters</code> compiler flag, then the need for
these annotations is removed&#8212;&#8203;Jdbi automatically uses the method parameter name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlUpdate</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into users (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
<span class="type">void</span> insert(<span class="type">long</span> id, <span class="predefined-type">String</span> name);</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_maven_setup"><a class="anchor" href="#_maven_setup"></a>6.1.1. Maven setup</h4>
<div class="paragraph">
<p>Configure the <code>maven-compiler-plugin</code> in your POM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;plugin&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;configuration&gt;</span>
    <span class="tag">&lt;compilerArgs&gt;</span>
      <span class="tag">&lt;arg&gt;</span>-parameters<span class="tag">&lt;/arg&gt;</span>
    <span class="tag">&lt;/compilerArgs&gt;</span>
  <span class="tag">&lt;/configuration&gt;</span>
<span class="tag">&lt;/plugin&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_intellij_idea_setup"><a class="anchor" href="#_intellij_idea_setup"></a>6.1.2. IntelliJ IDEA setup</h4>
<div class="ulist">
<ul>
<li>
<p>File &#8594; Settings</p>
</li>
<li>
<p>Build, Execution, Deployment &#8594; Compiler &#8594; Java Compiler</p>
</li>
<li>
<p>Additional command-line parameters: <code>-parameters</code></p>
</li>
<li>
<p>Click Apply, then OK.</p>
</li>
<li>
<p>Build &#8594; Rebuild Project</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_eclipse_setup"><a class="anchor" href="#_eclipse_setup"></a>6.1.3. Eclipse setup</h4>
<div class="ulist">
<ul>
<li>
<p>Window &#8594; Preferences</p>
</li>
<li>
<p>Java &#8594; Compiler</p>
</li>
<li>
<p>Under "Classfile Generation," check the option "Store information about
method parameters (usable via reflection)."</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_generic_types"><a class="anchor" href="#_working_with_generic_types"></a>6.2. Working with Generic Types</h3>
<div class="paragraph">
<p>Jdbi provides utility classes to make it easier to work with Java generic types.</p>
</div>
<div class="sect3">
<h4 id="_generictype"><a class="anchor" href="#_generictype"></a>6.2.1. GenericType</h4>
<div class="paragraph">
<p><a href="./apidocs/org/jdbi/v3/core/generic/GenericType.html" target="_blank">GenericType</a> represents a generic
type signature that can be passed around in a type-safe way.</p>
</div>
<div class="paragraph">
<p>Create a generic type reference by instantiating an anonymous inner class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">new</span> GenericType&lt;Optional&lt;<span class="predefined-type">String</span>&gt;&gt;() {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This type reference can be passed to any Jdbi method that accepts a
<code>GenericType&lt;T&gt;</code>, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">List</span>&lt;Optional&lt;<span class="predefined-type">String</span>&gt;&gt; middleNames = handle
    .select(<span class="string"><span class="delimiter">&quot;</span><span class="content">select middle_name from contacts</span><span class="delimiter">&quot;</span></span>)
    .mapTo(<span class="keyword">new</span> GenericType&lt;Optional&lt;<span class="predefined-type">String</span>&gt;&gt;() {})
    .list();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>GenericType.getType()</code> returns the raw
<a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Type.html" target="_blank">java.lang.reflect.Type</a> object used
to represent generics in Java.</p>
</div>
</div>
<div class="sect3">
<h4 id="_generictypes"><a class="anchor" href="#_generictypes"></a>6.2.2. GenericTypes</h4>
<div class="paragraph">
<p><a href="./apidocs/org/jdbi/v3/core/generic/GenericTypes.html" target="_blank">GenericTypes</a> provides methods
for working with Java generic types signatures.</p>
</div>
<div class="paragraph">
<p>All methods in <code>GenericTypes</code> operate in terms of <code>java.lang.reflect.Type</code>.</p>
</div>
<div class="paragraph">
<p>The <code>getErasedType(Type)</code> method accepts a <code>Type</code> and returns the raw <code>Class</code>
for that type, with any generic parameters erased:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Type</span> listOfInteger = <span class="keyword">new</span> GenericType&lt;<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt;&gt;() {}.getType();
GenericTypes.getErasedType(listOfInteger); <span class="comment">// =&gt; List.class</span>

GenericTypes.getErasedType(<span class="predefined-type">String</span>.class); <span class="comment">// =&gt; String.class</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>resolveType(Type, Type)</code> method takes a generic type, and a context type in
which to resolve it.</p>
</div>
<div class="paragraph">
<p>For example, given the type variable <code>T</code> from <code>Optional&lt;T&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Type</span> t = Optional.class.getTypeParameters()[<span class="integer">0</span>];</code></pre>
</div>
</div>
<div class="paragraph">
<p>And given the context type <code>Optional&lt;String&gt;</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">Type</span> optionalOfString = <span class="keyword">new</span> GenericType&lt;Optional&lt;<span class="predefined-type">String</span>&gt;&gt;() {}.getType();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>resolveType()</code> method answers the question: "what is type T, in the context
of type Optional&lt;String&gt;?"</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GenericTypes.resolveType(t, optionalOfString);
<span class="comment">// =&gt; String.class</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This scenario of resolving the first type parameter of some generic supertype is
so common that we made a separate method for it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GenericTypes.findGenericParameter(optionalOfString, Optional.class);
<span class="comment">// =&gt; Optional.of(String.class)</span>

<span class="predefined-type">Type</span> listOfInteger = <span class="keyword">new</span> GenericType&lt;<span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt;&gt;() {}.getType();
GenericTypes.findGenericParameter(listOfInteger, <span class="predefined-type">Collection</span>.class);
<span class="comment">// =&gt; Optional.of(Integer.class)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that this method will return <code>Optional.empty()</code> if the type parameter
cannot be resolved, or the types have nothing to do with each other:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GenericTypes.findGenericParameter(optionalOfString, <span class="predefined-type">List</span>.class);
<span class="comment">// =&gt; Optional.empty();</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_namedargumentfinder"><a class="anchor" href="#_namedargumentfinder"></a>6.3. NamedArgumentFinder</h3>
<div class="paragraph">
<p>The <a href="./apidocs/org/jdbi/v3/core/argument/NamedArgumentFinder" target="_blank">NamedArgumentFinder</a>
interface, as its name suggests, finds arguments by name from some source.
Typically a single <code>NamedArgumentFinder</code> instance will provide arguments for
several different names.</p>
</div>
<div class="paragraph">
<p>In cases where neither <code>bindBean()</code>, <code>bindFields()</code>, <code>bindMethods()</code>, nor
<code>bindMap()</code> are a good fit, you can implement your own <code>NamedArgumentFinder</code> and
bind that, instead of extracting and binding each argument individually.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cache cache = ... <span class="comment">// e.g. Guava Cache</span>
NamedArgumentFinder cacheFinder = (name, ctx) -&gt;
    Optional.ofNullable(cache.getIfPresent(name))
            .map(value -&gt; ctx.findArgumentFor(<span class="predefined-type">Object</span>.class, value));

stmt.bindNamedArgumentFinder(cacheFinder);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Under the hood, the
<a href="./apidocs/org/jdbi/v3/core/statement/SqlStatement.html#bindBean-java.lang.Object-" target="_blank">SqlStatement.bindBean()</a>,
<a href="./apidocs/org/jdbi/v3/core/statement/SqlStatement.html#bindMethods-java.lang.Object-" target="_blank">SqlStatement.bindMethods()</a>,
<a href="./apidocs/org/jdbi/v3/core/statement/SqlStatement.html#bindFields-java.lang.Object-" target="_blank">SqlStatement.bindFields()</a>,
and
<a href="./apidocs/org/jdbi/v3/core/statement/SqlStatement.html#bindMap-java.util.Map-" target="_blank">SqlStatement.bindMap()</a>
methods are just creating and binding custom implementations of
<code>NamedArgumentFinder</code> for beans, methods, fields, and maps, respectively.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_jdbiconfig"><a class="anchor" href="#_jdbiconfig"></a>6.4. JdbiConfig</h3>
<div class="paragraph">
<p>Configuration is managed by the
<a href="./apidocs/org/jdbi/v3/core/config/ConfigRegistry.html">ConfigRegistry</a>
class.  Each Jdbi object that represents a distinct database context
(for example, <strong>Jdbi</strong> itself, a <strong>Handle</strong> instance, or an attached SqlObject
class) gets its own configuration registry.  Most contexts implement the
<a href="./apidocs/org/jdbi/v3/core/config/Configurable.html">Configurable</a> interface which
allows modification of its configuration as well as retrieving the current
context&#8217;s configuration for use by Jdbi core or extensions.</p>
</div>
<div class="paragraph">
<p>When a new configurable context is created, it inherits a copy of its parent
configuration at the time of creation - further modifications to the original will
not affect already created configuration contexts.  Configuration context
copies happen when producing a Handle from Jdbi, when opening a <strong>SqlStatement</strong>
from the Handle, and when attaching or creating an on-demand extension such as
<strong>SqlObject</strong>.</p>
</div>
<div class="paragraph">
<p>The configuration itself is stored in various implementations of the
<a href="./apidocs/org/jdbi/v3/core/config/JdbiConfig.html">JdbiConfig</a> interface.
Each implementation must adhere to the contract of the interface; in particular
it must have a public no-argument constructor that provides useful defaults
and a <strong>createCopy</strong> method that is invoked when a configuration registry is cloned.</p>
</div>
<div class="paragraph">
<p>Generally, configuration should be set on a context before that context is used,
and not changed later.  Some configuration classes may be thread safe but most are
not.</p>
</div>
<div class="paragraph">
<p>Many of Jdbi&#8217;s core features, for example argument or mapper registries, are simply
implementations of <strong>JdbiConfig</strong> that store the registered mappings for later use
during query execution.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ExampleConfig</span> <span class="directive">implements</span> JdbiConfig&lt;ExampleConfig&gt; {

    <span class="directive">private</span> <span class="predefined-type">String</span> color;
    <span class="directive">private</span> <span class="type">int</span> number;

    <span class="directive">public</span> ExampleConfig() {
        color = <span class="string"><span class="delimiter">&quot;</span><span class="content">purple</span><span class="delimiter">&quot;</span></span>;
        number = <span class="integer">42</span>;
    }

    <span class="directive">private</span> ExampleConfig(ExampleConfig other) {
        <span class="local-variable">this</span>.color = other.color;
        <span class="local-variable">this</span>.number = other.number;
    }

    <span class="directive">public</span> ExampleConfig setColor(<span class="predefined-type">String</span> color) {
        <span class="local-variable">this</span>.color = color;
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getColor() {
        <span class="keyword">return</span> color;
    }

    <span class="directive">public</span> ExampleConfig setNumber(<span class="type">int</span> number) {
        <span class="local-variable">this</span>.number = number;
        <span class="keyword">return</span> <span class="local-variable">this</span>;
    }

    <span class="directive">public</span> <span class="type">int</span> getNumber() {
        <span class="keyword">return</span> number;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> ExampleConfig createCopy() {
        <span class="keyword">return</span> <span class="keyword">new</span> ExampleConfig(<span class="local-variable">this</span>);
    }

}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_custom_jdbiconfig_type"><a class="anchor" href="#_creating_a_custom_jdbiconfig_type"></a>6.4.1. Creating a custom JdbiConfig type</h4>
<div class="ulist">
<ul>
<li>
<p>Create a public class that implements JdbiConfig.</p>
</li>
<li>
<p>Add a public, no-argument constructor</p>
</li>
<li>
<p>Add a private, copy constructor.</p>
</li>
<li>
<p>Implement <code>createCopy()</code> to call the copy constructor.</p>
</li>
<li>
<p>Add config properties, and provide sane defaults for each property.</p>
</li>
<li>
<p>Ensure that all config properties get copied to the new instance in the copy
constructor.</p>
</li>
<li>
<p>Override <code>setConfig(ConfigRegistry)</code> if your config class wants to be able to
use other config classes in the registry. E.g. RowMappers registry delegates
to ColumnMappers registry, if it doesn&#8217;t have a mapper registered for a given
type.</p>
</li>
<li>
<p>Use that configuration object from other classes that are interested in it.</p>
<div class="ulist">
<ul>
<li>
<p>e.g. BeanMapper, FieldMapper, and ConstructorMapper all use the
ReflectionMappers config class to keep common configuration.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jdbiplugin"><a class="anchor" href="#_jdbiplugin"></a>6.5. JdbiPlugin</h3>
<div class="paragraph">
<p>JdbiPlugin can be used to bundle bulk configuration.
Plugins may be installed explicitly via <code>Jdbi.installPlugin(JdbiPlugin)</code>, or
may be installed automagically from the classpath using the ServiceLoader mechanism
via <code>installPlugins()</code>.</p>
</div>
<div class="paragraph">
<p>Jars may provide a file in <code>META-INF/services/org.jdbi.v3.core.spi.JdbiPlugin</code>
containing the fully qualified class name of your plugin.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The developers encourage you to install plugins explicitly.  Code with declared dependencies
on the module it uses is more robust to refactoring and provides useful data
for static analysis tools about what code is or isn&#8217;t used.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_user_defined_annotations"><a class="anchor" href="#_user_defined_annotations"></a>6.6. User-Defined Annotations</h3>
<div class="paragraph">
<p>SQL Object is designed to be extended with user-defined annotations. In fact,
most of the annotations provided in Jdbi are wired up with the approach
outlined below.</p>
</div>
<div class="paragraph">
<p>There are a few different categories of annotations in SQL Object, and it&#8217;s
important to understand the differences between them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_statement_customizing_annotations">Statement Customizing Annotations</a> - configures the underlying
<a href="./apidocs/org/jdbi/v3/core/statement/SqlStatement.html" target="_blank">SqlStatement</a> of a method
prior to execution. These can only be used in tandem with annotations like
<code>@SqlQuery</code>, <code>@SqlUpdate</code>, etc, and do not work on default methods.</p>
</li>
<li>
<p><a href="#_configuration_annotations">Configuration Annotations</a> - modifies configuration in the
<a href="./apidocs/org/jdbi/v3/core/config/ConfigRegistry.html" target="_blank">ConfigRegistry</a> within the
scope of a SQL object or one of its methods.</p>
</li>
<li>
<p><a href="#_method_decorating_annotations">Method Decorating Annotations</a> - decorates a method invocation with
some additional behavior, e.g. the <code>@Transaction</code> annotation wraps the method
call in a <code>handle.inTransaction()</code> call.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once you know which type of annotation you want, proceed to the appropriate
section below and follow the guide to set it up.</p>
</div>
<div class="sect3">
<h4 id="_statement_customizing_annotations"><a class="anchor" href="#_statement_customizing_annotations"></a>6.6.1. Statement Customizing Annotations</h4>
<div class="paragraph">
<p>SQL statement customizing annotations are used to apply some change to the
<a href="./apidocs/org/jdbi/v3/core/statement/SqlStatement.html" target="_blank">SqlStatement</a> associated
with a SQL method.</p>
</div>
<div class="paragraph">
<p>Typically these annotations correlate to an API method in core. e.g. <code>@Bind</code>
corresponds to <code>SqlStatement.bind()</code>, <code>@MaxRows</code> corresponds to
<code>Query.setMaxRows()</code>, etc.</p>
</div>
<div class="paragraph">
<p>Customizing annotations are applied only after the
<a href="./apidocs/org/jdbi/v3/core/statement/SqlStatement.html" target="_blank">SqlStatement</a> has been
created.</p>
</div>
<div class="paragraph">
<p>You can create your own SQL statement customizing annotations and attach runtime
behavior to them.</p>
</div>
<div class="paragraph">
<p>First, create an annotation that you want to attach a statement customization
to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE, <span class="predefined-type">ElementType</span>.METHOD, <span class="predefined-type">ElementType</span>.PARAMETER}) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="annotation">@interface</span> MaxRows {
  <span class="type">int</span> value();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All statement customizing annotations should have a <code>RUNTIME</code> retention
policy.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Statement customizing annotations only work on types, methods, or
parameters. Strictly speaking, the <code>@Target</code> annotation is not required, but
it&#8217;s a good practice to include it, so that annotations can only be applied
where they will actually do something.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Placing a customizing annotation on a type means "apply this customization to
every method."</p>
</div>
<div class="paragraph">
<p>When used on parameters, annotations may use the argument passed to the method
while processing the annotation.</p>
</div>
<div class="paragraph">
<p>Next, we write an implementation of the
<a href="./apidocs/org/jdbi/v3/sqlobject/customizer/SqlStatementCustomizerFactory.html" target="_blank">SqlStatementCustomizerFactory</a>
class, to process the annotation and apply the customization to the statement.</p>
</div>
<div class="paragraph">
<p>The <code>SqlStatementCustomizerFactory</code> produces two different types of "statement
customizer" command objects:
<a href="./apidocs/org/jdbi/v3/sqlobject/customizer/SqlStatementCustomizer.html" target="_blank">SqlStatementCustomizer</a>
(for annotations on types or methods), and
<a href="./apidocs/org/jdbi/v3/sqlobject/customizer/SqlStatementParameterCustomizer.html" target="_blank">SqlStatementParameterCustomizer</a>
(for annotations on method parameters).</p>
</div>
<div class="paragraph">
<p>Let&#8217;s implement a statement customizer factory for our annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MaxRowsFactory</span> <span class="directive">implements</span> SqlStatementCustomizerFactory {
    <span class="annotation">@Override</span>
    <span class="directive">public</span> SqlStatementCustomizer createForType(<span class="predefined-type">Annotation</span> annotation,
                                                <span class="predefined-type">Class</span>&lt;?&gt; sqlObjectType) {
        <span class="directive">final</span> <span class="type">int</span> maxRows = ((MaxRows)annotation).value(); <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="keyword">return</span> stmt -&gt; ((<span class="predefined-type">Query</span>)stmt).setMaxRows(maxRows); <i class="conum" data-value="2"></i><b>(2)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> SqlStatementCustomizer createForMethod(<span class="predefined-type">Annotation</span> annotation,
                                                  <span class="predefined-type">Class</span>&lt;?&gt; sqlObjectType,
                                                  <span class="predefined-type">Method</span> method) {
        <span class="keyword">return</span> createForType(annotation, sqlObjectType); <i class="conum" data-value="3"></i><b>(3)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> SqlStatementParameterCustomizer createForParameter(<span class="predefined-type">Annotation</span> annotation,
                                                              <span class="predefined-type">Class</span>&lt;?&gt; sqlObjectType,
                                                              <span class="predefined-type">Method</span> method,
                                                              Parameter param,
                                                              <span class="type">int</span> index,
                                                              <span class="predefined-type">Type</span> type) {
        <span class="keyword">return</span> (stmt, maxRows) -&gt; ((<span class="predefined-type">Query</span>)stmt).setMaxRows((<span class="predefined-type">Integer</span>) maxRows); <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Extract the max rows from the annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><a href="./apidocs/org/jdbi/v3/sqlobject/customizer/SqlStatementCustomizer.html" target="_blank">SqlStatementCustomizer</a>
can be implemented as a lambda&#8212;&#8203;it receives a
<a href="./apidocs/org/jdbi/v3/core/statement/SqlStatement.html" target="_blank">SqlStatement</a> as a
parameter, calls whatever method it wants on the statement, and returns
void.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Since the customization for this annotation is the same at the method level
as at the type level, we simply delegate to the type-level method for
brevity.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><a href="./apidocs/org/jdbi/v3/sqlobject/customizer/SqlStatementParameterCustomizer.html" target="_blank">SqlStatementParameterCustomizer</a>
can also be implemented as a lambda. It accepts a <code>SqlStatement</code> and the
value that was passed into the method on the annotated parameter.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, add the
<a href="./apidocs/org/jdbi/v3/sqlobject/customizer/SqlStatementCustomizingAnnotation.html" target="_blank">@SqlStatementCustomizingAnnotation</a>
annotation the <code>@MaxRows</code> annotation type. This tells Jdbi that <code>MaxRowsFactory</code>
implements the behavior of the <code>@MaxRows</code> annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlStatementCustomizingAnnotation</span>(MaxRowsFactory.class)
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.METHOD, <span class="predefined-type">ElementType</span>.PARAMETER})
<span class="directive">public</span> <span class="annotation">@interface</span> MaxRows {
    <span class="type">int</span> value() <span class="keyword">default</span> -<span class="integer">1</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your statement customizing annotation is now ready to use on any SQL object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Dao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@MaxRows</span>(<span class="integer">100</span>)
  <span class="predefined-type">List</span>&lt;Contact&gt; list();

  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts</span><span class="delimiter">&quot;</span></span>)
  <span class="predefined-type">List</span>&lt;Contact&gt; list(<span class="annotation">@MaxRows</span> <span class="type">int</span> maxRows);
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We chose <code>@MaxRows</code> as an example here because it was easy to understand.
In practice, you will get better database performance by using a <code>LIMIT</code> clause
in your SQL statement than by using <code>@MaxRows</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_annotations"><a class="anchor" href="#_configuration_annotations"></a>6.6.2. Configuration Annotations</h4>
<div class="paragraph">
<p>Configuration annotations are used to apply some change to the
<a href="./apidocs/org/jdbi/v3/core/config/ConfigRegistry.html" target="_blank">ConfigRegistry</a> associated with
a SQL object or method.</p>
</div>
<div class="paragraph">
<p>Typically these annotations correlate to a method of
<a href="./apidocs/org/jdbi/v3/core/config/Configurable.html" target="_blank">Configurable</a> (<code>Jdbi</code>,
<code>Handle</code>, and <code>SqlStatement</code> all implement this interface). For example,
<code>@RegisterColumnMapper</code> correlates to <code>Configurable.registerColumnMapper()</code>.</p>
</div>
<div class="paragraph">
<p>You can create your own configuration annotations, and attach runtime behavior
to them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Write a new configuration annotation, with any attributes you need.</p>
</li>
<li>
<p>Write an implementation of
<a href="./apidocs/org/jdbi/v3/sqlobject/config/Configurer.html" target="_blank">Configurer</a> which performs
the configuration associated with your annotation.</p>
</li>
<li>
<p>Add the <code>@ConfiguringAnnotation</code> annotation to your configuration annotation
type.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With the above steps completed, Jdbi will invoke your configurer whenever it
encounters the associated annotation.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s re-implement one of Jdbi&#8217;s built-in annotations as an example:</p>
</div>
<div class="paragraph">
<p>The <code>@RegisterColumnMapper</code> annotation has an attribute to specify the class of
the column mapper to register. Wherever the annotation is used, we want Jdbi to
create an instance of that mapper type, and register it with the config
registry.</p>
</div>
<div class="paragraph">
<p>First, let&#8217;s create the new annotation type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE, <span class="predefined-type">ElementType</span>.METHOD}) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="annotation">@interface</span> RegisterColumnMapper{
  <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> ColumnMapper&lt;?&gt;&gt; value();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All configuration annotations should have a <code>RUNTIME</code> retention policy.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Configuration annotations only work on types and methods. Strictly speaking,
the <code>@Target</code> annotation is not required, but it&#8217;s a good practice to
include it, so that annotations can only be applied where they will actually
do something.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Placing a configuration annotation on a type means "apply this configuration to
every method."</p>
</div>
<div class="paragraph">
<p>Next, we write an implementation of the
<a href="./apidocs/org/jdbi/v3/sqlobject/config/Configurer.html" target="_blank">Configurer</a> class, to process
the annotation and apply the configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">RegisterColumnMapperImpl</span> <span class="directive">implements</span> Configurer {
  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> configureForMethod(ConfigRegistry registry,
                                 <span class="predefined-type">Annotation</span> annotation,
                                 <span class="predefined-type">Class</span>&lt;?&gt; sqlObjectType,
                                 <span class="predefined-type">Method</span> method) {
    configure(registry, (RegisterColumnMapper) annotation);
  }

  <span class="annotation">@Override</span>
  <span class="directive">public</span> <span class="type">void</span> configureForType(ConfigRegistry registry,
                               <span class="predefined-type">Annotation</span> annotation,
                               <span class="predefined-type">Class</span>&lt;?&gt; sqlObjectType) {
    configure(registry, (RegisterColumnMapper) annotation);
  }

  <span class="directive">private</span> <span class="type">void</span> configure(ConfigRegistry registry,
                         RegisterColumnMapper registerColumnMapper) { <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="keyword">try</span> {
      <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> ColumnMapper&gt; mapperType = registerColumnMapper.value();
      ColumnMapper mapper = mapperType.getConstructor().newInstance();
      registry.get(ColumnMappers.class).register(mapper);
    }
    <span class="keyword">catch</span> (<span class="exception">NoSuchMethodException</span> e) {
      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Cannot construct </span><span class="delimiter">&quot;</span></span> + mapperType, e);
    }
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>In this example, we&#8217;re applying the same configuration, whether the
<code>@RegisterColumnMapper</code> annotation is used on the SQL object type or method.
However this is not a requirement&#8212;&#8203;some annotations may choose to apply
configuration differently depending on whether the annotation is placed on
the type or the method.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For configuration annotations with only one target, (e.g. <code>@KeyColumn</code> and
<code>@ValueColumn</code> may only be applied to methods), you need only implement
the <code>Configurer</code> method appropriate for the annotation target.</p>
</div>
<div class="paragraph">
<p>Finally, add the
<a href="./apidocs/org/jdbi/v3/sqlobject/config/ConfiguringAnnotation.html" target="_blank">@ConfiguringAnnotation</a>
annotation to your <code>@RegisterColumnMapper</code> annotation type. This tells Jdbi that
<code>RegisterColumnMapperImpl</code> implements the behavior of the
<code>@RegisterColumnMapper</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ConfiguringAnnotation</span>(RegisterColumnMapperImpl.class)
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE, <span class="predefined-type">ElementType</span>.METHOD})
<span class="directive">public</span> <span class="annotation">@interface</span> RegisterColumnMapper {
    <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> TemplateEngine&gt; value();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your configuration annotation is now ready to use in any SQL object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">AccountDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select balance from accounts where id = ?</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@RegisterColumnMapper</span>(MoneyMapper.class)
  <span class="directive">public</span> Money getBalance(<span class="type">long</span> accountId);
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_method_decorating_annotations"><a class="anchor" href="#_method_decorating_annotations"></a>6.6.3. Method Decorating Annotations</h4>
<div class="paragraph">
<p>Method decorating annotations are used to enhance a SQL Object method with
additional (or substitute) behavior.</p>
</div>
<div class="paragraph">
<p>Internally, SQL Object represents the behavior of each method with an instance
of the <a href="./apidocs/org/jdbi/v3/sqlobject/Handler.html" target="_blank">Handler</a> interface. Every time
you call a method on a SQL Object instance, the method is executed by executing
the handler for the given method.</p>
</div>
<div class="paragraph">
<p>When use use a decorating annotation (like <code>@Transaction</code>), the regular handler
for a method is wrapped in another handler which may perform some action before
and/or after passing the call to the original handler.</p>
</div>
<div class="paragraph">
<p>A decorator could even perform some action <em>instead</em> of calling the original,
e.g. for a caching annotation.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s re-implement the <code>@Transaction</code> annotation to see how it works:</p>
</div>
<div class="paragraph">
<p>First, create the annotation type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@Target</span>(<span class="predefined-type">ElementType</span>.METHOD) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="annotation">@interface</span> Transaction {
    TransactionIsolationLevel value();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All decorating annotations should have a <code>RUNTIME</code> retention policy.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Decorating annotations only work on types and methods. Strictly speaking,
the <code>@Target</code> annotation is note required, but it&#8217;s a good practice to
include it, so that annotations can only be applied where they will actually
do something.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Placing a decorating annotation on a type means "apply this decoration to every
method."</p>
</div>
<div class="paragraph">
<p>Next we write an implementation of the
<a href="./apidocs/org/jdbi/v3/sqlobject/HandlerDecorator.html" target="_blank">HandlerDecorator</a> interface, to
process the annotation and apply the decoration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">TransactionDecorator</span> <span class="directive">implements</span> HandlerDecorator {
  <span class="directive">public</span> <span class="predefined-type">Handler</span> decorateHandler(<span class="predefined-type">Handler</span> base,
                                 <span class="predefined-type">Class</span>&lt;?&gt; sqlObjectType,
                                 <span class="predefined-type">Method</span> method) {
    Transaction anno = method.getAnnotation(Transaction.class); <i class="conum" data-value="1"></i><b>(1)</b>
    TransactionIsolationLevel isolation = anno.value(); <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="keyword">return</span> (target, args, handleSupplier) -&gt; handleSupplier.getHandle() <i class="conum" data-value="3"></i><b>(3)</b>
        .inTransaction(isolation, h -&gt; base.invoke(target, args, handleSupplier));
  }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Get the <code>@Transaction</code> annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Extract the transaction isolation level from the annotation</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>Handler</code> interface accepts a target (the SQL Object instance being
invoked), an <code>Object[]</code> array of arguments passed to the method, and a
<code>HandleSupplier</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, add the
<a href="./apidocs/org/jdbi/v3/sqlobject/SqlMethodDecoratingAnnotation.html" target="_blank">@SqlMethodDecoratingAnnotation</a>
annotation to your <code>@Transaction</code> annotation type. This tells Jdbi that
<code>TransactionDecorator</code> implements the behavior of the <code>@Transaction</code> annotation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@SqlMethodDecoratingAnnotation</span>(TransactionDecorator.class)
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Target</span>(<span class="predefined-type">ElementType</span>.METHOD)
<span class="directive">public</span> <span class="annotation">@interface</span> Transaction {
    TransactionIsolationLevel value();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your decorating annotation is now ready to use in any SQL object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ContactDao</span> {
  <span class="annotation">@SqlBatch</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into contacts (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@Transaction</span>
  <span class="type">void</span> batchInsert(<span class="annotation">@BindBean</span> Contact... contacts);
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_decorator_order"><a class="anchor" href="#_decorator_order"></a>Decorator Order</h5>
<div class="paragraph">
<p>If a SQL object method has two or more decorating annotations applied, and the
order of decorations is important, use the <code>@DecoratorOrder</code> annotation.</p>
</div>
<div class="paragraph">
<p>For example, suppose a method were annotated both with <code>@Cached</code> and
<code>@Transaction</code> (just go with it..). We would probably want the <code>@Cached</code>
annotation to go first, so that transactions are not created unnecessarily when
the cache already contains the entry.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">ContactDao</span> {
  <span class="annotation">@SqlQuery</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">select * from contacts where id = ?</span><span class="delimiter">&quot;</span></span>)
  <span class="annotation">@Cached</span>
  <span class="annotation">@Transaction</span>
  <span class="annotation">@DecoratorOrder</span>(Cached.class, Transaction.class)
  Contact getById(<span class="type">long</span> id);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Decorator order is expressed from outermost to innermost.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_templateengine"><a class="anchor" href="#_templateengine"></a>6.7. TemplateEngine</h3>
<div class="paragraph">
<p>Jdbi uses a <a href="./apidocs/org/jdbi/v3/core/statement/TemplateEngine.html" target="_blank">TemplateEngine</a>
implementation to render templates into SQL. Template engines take a SQL
template string and the <code>StatementContext</code> as input, and produce a parseable
SQL string as output.</p>
</div>
<div class="paragraph">
<p>Out of the box, Jdbi is configured to use <code>DefinedAttributeTemplateEngine</code>,
which replaces angle-bracked tokens like <code>&lt;name&gt;</code> in your SQL statements with
the string value of the named attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">String</span> tableName = <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Class</span>&lt;?&gt; entityClass = Customer.class;

handle.createQuery(<span class="string"><span class="delimiter">&quot;</span><span class="content">select &lt;columns&gt; from &lt;table&gt;</span><span class="delimiter">&quot;</span></span>)
      .define(<span class="string"><span class="delimiter">&quot;</span><span class="content">table</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">customers</span><span class="delimiter">&quot;</span></span>)
      .defineList(<span class="string"><span class="delimiter">&quot;</span><span class="content">columns</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)
      .mapToMap()
      .list() <span class="comment">// =&gt; &quot;select id, name from customers&quot;</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>defineList</code> method defines a list of elements as the comma-separated
splice of String values of the individual elements. In the above example,
the <code>columns</code> attribute is defined as <code>"id, name"</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any custom template engine can be used. Simply implement the <code>TemplateEngine</code>
interface, then call <code>setTemplateEngine()</code> on the <code>Jdbi</code>, <code>Handle</code>, or on a SQL
statement like <code>Update</code> or <code>Query</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">TemplateEngine templateEngine = (template, ctx) -&gt; {
  ...
};

jdbi.setTemplateEngine(templateEngine);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Jdbi also provides <code>StringTemplateEngine</code>,
which renders templates using the StringTemplate library. See
<a href="#_stringtemplate_4">StringTemplate 4</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_sqlparser"><a class="anchor" href="#_sqlparser"></a>6.8. SqlParser</h3>
<div class="paragraph">
<p>After the SQL template has been rendered, Jdbi uses a
<a href="./apidocs/org/jdbi/v3/core/statement/SqlParser.html" target="_blank">SqlParser</a> to parse out any named
parameters from the SQL statement. This Produces a <code>ParsedSql</code> object, which
contains all the information Jdbi needs to bind parameters and execute your SQL
statement.</p>
</div>
<div class="paragraph">
<p>Out of the box, Jdbi is configured to use <code>ColonPrefixSqlParser</code>, which
recognizes colon-prefixed named parameters, e.g. <code>:name</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into characters (id, name) values (:id, :name)</span><span class="delimiter">&quot;</span></span>)
      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">1</span>)
      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Dolores Abernathy</span><span class="delimiter">&quot;</span></span>)
      .execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Jdbi also provides <code>HashPrefixSqlParser</code>, which recognizes hash-prefixed
parameters, e.g. <code>#hashtag</code>. Use this parser by calling <code>setSqlParser()</code> on the
<code>Jdbi</code>, <code>Handle</code>, or any SQL statement such as <code>Query</code> or <code>Update</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">handle.setSqlParser(<span class="keyword">new</span> HashPrefixSqlParser());
handle.createUpdate(<span class="string"><span class="delimiter">&quot;</span><span class="content">insert into characters (id, name) values (#id, #name)</span><span class="delimiter">&quot;</span></span>)
      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>)
      .bind(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Teddy Flood</span><span class="delimiter">&quot;</span></span>)
      .execute();</code></pre>
</div>
</div>
<div class="paragraph">
<p>For you fearless adventurers who have read the
<a href="https://www.amazon.com/Compilers-Principles-Techniques-Tools-2nd/dp/0321486811" target="_blank">Dragon book</a>,
any custom SQL parser can be used. Simply implement the <code>SqlParser</code> interface,
then set it on the Jdbi, Handle, or SQL statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SqlParser parser = (sql, ctx) -&gt; {
  ...
};

jdbi.setParser(parser);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_timingcollector"><a class="anchor" href="#_timingcollector"></a>6.9. TimingCollector</h3>
<div class="paragraph">
<p>The <strong>TimingCollector</strong> interface is called after executing each statement
and given the statement context and duration of execution in nanoseconds.</p>
</div>
<div class="paragraph">
<p>This interface isn&#8217;t completely thought out yet; the developers welcome
feedback on how to improve timing collection.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resultproducer"><a class="anchor" href="#_resultproducer"></a>6.10. ResultProducer</h3>
<div class="paragraph">
<p>A <strong>ResultProducer</strong> takes a lazily supplied <strong>PreparedStatement</strong> and
produces a result.  The most common producer path, <strong>execute()</strong>,
retrieves the <strong>ResultSet</strong> over the query results and then uses a
<strong>ResultSetScanner</strong> or higher level mapper to produce results.</p>
</div>
<div class="paragraph">
<p>An example alternate use is to just return the number of rows modified,
as in an UPDATE or INSERT statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">static</span> ResultProducer&lt;<span class="predefined-type">Integer</span>&gt; returningUpdateCount() {
    <span class="keyword">return</span> (statementSupplier, ctx) -&gt; {
        <span class="keyword">try</span> {
            <span class="keyword">return</span> statementSupplier.get().getUpdateCount();
        } <span class="keyword">finally</span> {
            ctx.close();
        }
    };
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you acquire the lazy statement, you are responsible for ensuring
that the context is closed eventually to release database resources.</p>
</div>
<div class="paragraph">
<p>Most users will not need to implement the <strong>ResultProducer</strong> interface.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix"><a class="anchor" href="#_appendix"></a>7. Appendix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_best_practices"><a class="anchor" href="#_best_practices"></a>7.1. Best Practices</h3>
<div class="ulist">
<ul>
<li>
<p>Test your SQL Objects (DAOs) against real databases when possible.
Jdbi tries to be defensive and fail eagerly when you hold it wrong.</p>
</li>
<li>
<p>Use the <code>-parameters</code> compiler flag to avoid all those
<code>@Bind("foo") String foo</code> redundant qualifiers in SQL Object method
parameters.  See <a href="#_compiling_with_parameter_names">Compiling with Parameter Names</a>.</p>
</li>
<li>
<p>Use a profiler! The true root cause of performance problems can often be a
surprise. Measure first, <em>then</em> tune for performance. And then measure again
to be sure it made a difference.</p>
</li>
<li>
<p>Don&#8217;t forget to bring a towel!</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_api_reference"><a class="anchor" href="#_api_reference"></a>7.2. API Reference</h3>
<div class="ulist">
<ul>
<li>
<p><a href="apidocs/index.html" target="_blank">Javadoc</a></p>
</li>
<li>
<p><a href="apidocs-kotlin/jdbi3-kotlin/index.html" target="_blank">jdbi3-kotlin</a></p>
</li>
<li>
<p><a href="apidocs-kotlin/jdbi3-kotlin-sqlobject/index.html" target="_blank">jdbi3-kotlin-sqlobject</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_related_projects"><a class="anchor" href="#_related_projects"></a>7.3. Related Projects</h3>
<div class="paragraph">
<p><a href="https://github.com/opentable/otj-pg-embedded" target="_blank">Embedded Postgres</a>
makes testing against a real database quick and easy.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/arteam/dropwizard-jdbi3" target="_blank">dropwizard-jdbi3</a>
provides integration with DropWizard.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/arteam/metrics-jdbi3" target="_blank">metrics-jdbi3</a>
instruments using DropWizard-Metrics to emit statement timing statistics.</p>
</div>
<div class="paragraph">
<p>Do you know of a project related to Jdbi? Send us an issue and we&#8217;ll add a link
here!</p>
</div>
</div>
<div class="sect2">
<h3 id="_contributing"><a class="anchor" href="#_contributing"></a>7.4. Contributing</h3>
<div class="paragraph">
<p><strong>jdbi</strong> uses GitHub for collaboration. Please check out the
<a href="https://github.com/jdbi/jdbi" target="_blank">project page</a> for more information.</p>
</div>
<div class="paragraph">
<p>If you have a question, we have a
<a href="https://groups.google.com/group/jdbi" target="_blank">Google Group mailing list</a></p>
</div>
<div class="paragraph">
<p>Users sometimes hang out on
<a href="irc://irc.freenode.net/#jdbi" target="_blank">IRC in #jdbi on Freenode</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_upgrading_from_v2_to_v3"><a class="anchor" href="#_upgrading_from_v2_to_v3"></a>7.5. Upgrading from v2 to v3</h3>
<div class="paragraph">
<p>Already using Jdbi v2?</p>
</div>
<div class="paragraph">
<p>Here&#8217;s a quick summary of differences to help you upgrade:</p>
</div>
<div class="paragraph">
<p>General:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Maven artifacts renamed and split out:</p>
</li>
<li>
<p>Old: <code>org.jdbi:jdbi</code></p>
</li>
<li>
<p>New: <code>org.jdbi:jdbi3-core</code>, <code>org.jdbi:jdbi3-sqlobject</code>, etc.</p>
</li>
<li>
<p>Root package renamed: <code>org.skife.jdbi.v2</code> &#8594; <code>org.jdbi.v3</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Core API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DBI</code>, <code>IDBI</code> &#8594; <code>Jdbi</code></p>
<div class="ulist">
<ul>
<li>
<p>Instantiate with <code>Jdbi.create()</code> factory methods instead of constructors.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>DBIException</code> &#8594; <code>JdbiException</code></p>
</li>
<li>
<p><code>Handle.select(String, &#8230;&#8203;)</code> now returns a <code>Query</code> for further method
chaining, instead of a <code>List&lt;Map&lt;String, Object&gt;&gt;</code>. Call
<code>Handle.select(sql, &#8230;&#8203;).mapToMap().list()</code> for the same effect as v2.</p>
</li>
<li>
<p><code>Handle.insert()</code> and <code>Handle.update()</code> have been coalesced into
<code>Handle.execute()</code>.</p>
</li>
<li>
<p><code>Handle.bindFromMap()</code> &#8594; <code>Handle.bindMap()</code></p>
</li>
<li>
<p><code>ArgumentFactory</code> is no longer generic.</p>
</li>
<li>
<p><code>AbstractArgumentFactory</code> is a generic implementation of <code>ArgumentFactory</code>
for factories that handle a single argument type.</p>
</li>
<li>
<p>Argument and mapper factories now operate in terms of
<code>java.lang.reflect.Type</code> instead of <code>java.lang.Class</code>. This allows Jdbi to
handle arguments and mappers for generic types.</p>
</li>
<li>
<p>Argument and mapper factories now have a single <code>build()</code> method that returns
an <code>Optional</code>, instead of separate <code>accepts()</code> and <code>build()</code> methods.</p>
</li>
<li>
<p><code>ResultSetMapper</code> &#8594; <code>RowMapper</code>. The row index parameter was also removed
from <code>RowMapper</code>--the current row number can be retrieved directly from the
<code>ResultSet</code>.</p>
</li>
<li>
<p><code>ResultColumnMapper</code> &#8594; <code>ColumnMapper</code></p>
</li>
<li>
<p><code>ResultSetMapperFactory</code> &#8594; <code>RowMapperFactory</code></p>
</li>
<li>
<p><code>ResultColumnMapperFactory</code> &#8594; <code>ColumnMapperFactory</code></p>
</li>
<li>
<p><code>Query</code> no longer maps to <code>Map&lt;String, Object&gt;</code> by default. Call
<code>Query.mapToMap()</code>, <code>.mapToBean(type)</code>, <code>.map(mapper)</code> or <code>.mapTo(type)</code>.</p>
</li>
<li>
<p><code>ResultBearing&lt;T&gt;</code> was refactored into <code>ResultBearing</code> (no generic parameter)
and <code>ResultIterable&lt;T&gt;</code>. Call <code>.mapTo(type)</code> to get a <code>ResultIterable&lt;T&gt;</code>.</p>
</li>
<li>
<p><code>TransactionConsumer</code> and <code>TransactionCallback</code> only take a <code>Handle</code> now&#8212;&#8203;the
<code>TransactionStatus</code> argument is removed. Just rollback the handle now.</p>
</li>
<li>
<p><code>TransactionStatus</code> class removed.</p>
</li>
<li>
<p><code>CallbackFailedException</code> class removed. The functional interfaces like
<code>HandleConsumer</code>, <code>HandleCallback</code>, <code>TransactionCallback</code>, etc can now throw
any exception type. Methods like <code>Jdbi.inTransaction</code> that take these
callbacks use exception transparency to throw only the exception thrown by
the callback. If your callback throws no checked exceptions, you don&#8217;t need
a try/catch block.</p>
</li>
<li>
<p><code>StatementLocator</code> interface removed from core. All core statements expect to
receive the actual SQL string now. A similar concept, <code>SqlLocator</code> was added
but is specific to SQL Object.</p>
</li>
<li>
<p><code>StatementRewriter</code> refactored into <code>TemplateEngine</code>, and <code>SqlParser</code>.</p>
</li>
<li>
<p>StringTemplate no longer required to process <code>&lt;name&gt;</code>-style tokens in SQL.</p>
</li>
<li>
<p>Custom SqlParser implementations must now provide a way to transform raw
parameter names to names that will be properly parsed out as named params.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>SQL Object API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SQL Object support is not installed by default. It must be added as a
separate dependency, and the plugin installed into the <code>Jdbi</code> object:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Jdbi jdbi = Jdbi.create(...);
jdbi.installPlugin(<span class="keyword">new</span> SqlObjectPlugin());</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>SQL Object types in v3 must be public interfaces&#8212;&#8203;no classes. Method return
types must likewise be public. This is due to SQL Object implementation
switching from CGLIB to <code>java.lang.reflect.Proxy</code>, which only supports
interfaces.</p>
</li>
<li>
<p><code>GetHandle</code> &#8594; <code>SqlObject</code></p>
</li>
<li>
<p><code>SqlLocator</code> replaces <code>StatementLocator</code>, and only applies to SQL Objects.</p>
</li>
<li>
<p><code>@RegisterMapper</code> divided into <code>@RegisterRowMapper</code> and
<code>@RegisterColumnMapper</code>.</p>
</li>
<li>
<p><code>@Bind</code> annotations on SQL Object method parameters can be made optional,
by compiling your code with the <code>-parameters</code> compiler flag enabled.</p>
</li>
<li>
<p><code>@BindIn</code> &#8594; <code>@BindList</code>, and no longer requires StringTemplate</p>
</li>
<li>
<p>On-demand SQL objects don&#8217;t play well with methods that return <code>Iterable</code>
or <code>FluentIterable</code>. On-demand objects strictly close the handle after each
method call, and no longer "hold the door open" for you to finish consuming
the interable as they did in v2. This forecloses a major source of connection
leaks.</p>
</li>
<li>
<p>SQL Objects are no longer closeable&#8201;&#8212;&#8201;they are either on-demand, or their
lifecycle is tied to the lifecycle of the <code>Handle</code> they are attached to.</p>
</li>
<li>
<p><code>@BindAnnotation</code> meta-annotation removed. Use
<code>@SqlStatementCustomizingAnnotation</code> instead.</p>
</li>
<li>
<p><code>@SingleValueResult</code> &#8594; <code>@SingleValue</code>. The annotation may be used for method
return types, or on <code>@SqlBatch</code> parameters.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-02-28 21:23:53 MST
</div>
</div>
</body>
</html>
